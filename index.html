<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêæ Controle de Medica√ß√£o Animal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>   
        :root {
            --primary: #4a90e2;
            --secondary: #7ed321;
            --warning: #f5a623;
            --danger: #d0021b;
            --info: #50e3c2;
            --light: #f8f9fa;
            --dark: #333;
            --morning: #ff9800;
            --night: #673ab7;
            --success: #27ae60;
            --bg-color: #f5f7fa;
            --card-color: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;
        }
        
        [data-theme="dark"] {
            --primary: #64b5f6;
            --secondary: #81c784;
            --warning: #ffb74d;
            --danger: #e57373;
            --info: #4db6ac;
            --light: #424242;
            --dark: #f5f5f5;
            --morning: #ff9800;
            --night: #9575cd;
            --success: #66bb6a;
            --bg-color: #121212;
            --card-color: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #424242;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body {
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 15px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--card-color);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .time-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .time-box {
            background: var(--light);
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: bold;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        
        .current-time {
            background-color: var(--light);
            color: var(--primary);
        }
        
        .cache-indicator {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
            min-width: 150px;
            padding: 10px;
            background: var(--light);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        
        .cache-meter {
            background: var(--border-color);
            border-radius: 10px;
            width: 100%;
            height: 15px;
            overflow: hidden;
            position: relative;
        }
        
        .cache-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--info));
            width: 0%;
            transition: width 0.5s;
            border-radius: 10px;
        }
        
        .cache-text {
            font-size: 0.8rem;
            color: var(--text-color);
            white-space: nowrap;
        }
        
        .cache-warning {
            color: var(--warning);
            font-weight: bold;
        }
        
        .theme-toggle {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .upcoming-medications {
            background: var(--card-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }
        
        .upcoming-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .upcoming-item {
            background: var(--light);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }
        
        .upcoming-item.urgent {
            border-left: 4px solid var(--danger);
            animation: pulse 2s infinite;
        }
        
        .upcoming-item.overdue {
            border-left: 4px solid var(--warning);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(208, 2, 27, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(208, 2, 27, 0); }
            100% { box-shadow: 0 0 0 0 rgba(208, 2, 27, 0); }
        }
        
        .countdown-timer {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            color: var(--primary);
        }
        
        .overdue-timer {
            color: var(--warning);
        }
        
        .progress-bar-container {
            margin-top: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--info));
            width: 0%;
            transition: width 0.5s;
            border-radius: 5px;
        }
        
        .animal-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .animal-card {
            background: var(--card-color);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }
        
        .animal-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .animal-icon {
            font-size: 2rem;
            margin-right: 15px;
        }
        
        .animal-name {
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .animal-weight {
            background: var(--light);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-left: 10px;
            border: 1px solid var(--border-color);
        }
        
        .medication-list {
            margin-top: 15px;
        }
        
        .medication-item {
            background: var(--light);
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
        }
        
        .medication-info h4 {
            color: var(--text-color);
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .medication-details {
            font-size: 0.85rem;
            color: var(--text-color);
            opacity: 0.8;
        }
        
        .medication-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .medication-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            min-width: 90px;
            text-align: center;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-done {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-skipped {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status-upcoming {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status-overdue {
            background-color: #f5a623;
            color: white;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            white-space: nowrap;
            position: relative;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 0.75rem;
        }
        
        .btn-mark {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-unmark {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-skip {
            background-color: #95a5a6;
            color: white;
        }
        
        .btn-edit {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-delete {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-add {
            background-color: var(--success);
            color: white;
        }
        
        .btn-pdf {
            background-color: #f44336;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }
        
        .btn-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--dark);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 1000;
            margin-bottom: 5px;
        }
        
        .btn:hover .btn-tooltip {
            opacity: 1;
            visibility: visible;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
            position: sticky;
            bottom: 0;
            background: var(--card-color);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1);
            margin: 15px -15px -15px;
        }
        
        .calendar-section {
            background: var(--card-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
            overflow-x: auto;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .calendar-nav {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            min-width: 700px;
        }
        
        .calendar-day {
            background: var(--light);
            border-radius: 8px;
            padding: 8px;
            min-height: 120px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .calendar-day:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 8px;
            background: var(--light);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .day-pdf-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.8rem;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .day-pdf-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .today {
            background-color: rgba(100, 181, 246, 0.2);
            border: 2px solid var(--primary);
        }
        
        .calendar-medication {
            font-size: 0.65rem;
            padding: 2px 4px;
            margin-bottom: 2px;
            border-radius: 3px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
            position: relative;
        }
        
        .calendar-medication:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 0;
            background: var(--dark);
            color: white;
            padding: 8px;
            border-radius: 5px;
            font-size: 0.8rem;
            white-space: normal;
            width: 250px;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-align: left;
            line-height: 1.4;
        }
        
        .medication-morning {
            background-color: rgba(255, 235, 59, 0.3);
            border-left: 2px solid var(--morning);
        }
        
        .medication-night {
            background-color: rgba(103, 58, 183, 0.3);
            border-left: 2px solid var(--night);
        }
        
        .medication-overdue {
            background-color: rgba(245, 166, 35, 0.3);
            border-left: 2px solid var(--warning);
        }
        
        .management-section {
            background: var(--card-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color);
            font-size: 0.9rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 0.9rem;
            background: var(--light);
            color: var(--text-color);
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .animals-list {
            margin-top: 15px;
            max-height: 250px;
            overflow-y: auto;
        }
        
        .animal-manage-item {
            background: var(--light);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
        }
        
        .cache-controls {
            margin-top: 15px;
        }
        
        .notification {
            position: fixed;
            bottom: 15px;
            right: 15px;
            padding: 12px 20px;
            background: var(--primary);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            max-width: 300px;
            font-size: 0.9rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        
        .modal-content {
            background: var(--card-color);
            padding: 20px;
            border-radius: 15px;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            color: var(--text-color);
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .developer-info {
            margin-top: 10px;
            padding: 10px;
            background: var(--light);
            border-radius: 10px;
            display: inline-block;
            border: 1px solid var(--border-color);
        }
        
        .tab-container {
            margin-top: 20px;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 15px;
        }
        
        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .tab-button.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Estilos para o modal de sele√ß√£o de medicamentos */
        .medication-select-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background: var(--light);
        }
        
        .medication-select-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .medication-select-item:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .medication-select-item.selected {
            background-color: var(--primary);
            color: white;
        }
        
        .medication-select-item:last-child {
            border-bottom: none;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .search-box input {
            flex: 1;
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .animal-cards {
                grid-template-columns: 1fr;
            }
            
            .header-top {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .header-controls {
                justify-content: center;
            }
            
            .time-display {
                flex-direction: column;
                gap: 10px;
            }
            
            .cache-indicator {
                min-width: 100%;
            }
            
            .calendar-grid {
                min-width: 100%;
                font-size: 0.8rem;
            }
            
            .calendar-day {
                min-height: 100px;
            }
            
            .calendar-medication:hover::after {
                width: 200px;
                font-size: 0.7rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .animal-name {
                font-size: 1.4rem;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            header, .animal-card, .calendar-section, .management-section, .upcoming-medications {
                padding: 15px;
            }
            
            .calendar-grid {
                gap: 5px;
            }
            
            .calendar-day {
                min-height: 90px;
                padding: 5px;
            }
            
            .day-number {
                font-size: 0.8rem;
            }
            
            .calendar-medication {
                font-size: 0.6rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 15px;
            }
        }
        
        /* Estilos para o tema escuro */
        body[data-theme="dark"] .status-pending {
            background-color: #5d4037;
            color: #ffcc80;
        }
        
        body[data-theme="dark"] .status-done {
            background-color: #1b5e20;
            color: #a5d6a7;
        }
        
        body[data-theme="dark"] .status-skipped {
            background-color: #b71c1c;
            color: #ef9a9a;
        }
        
        body[data-theme="dark"] .status-upcoming {
            background-color: #004d40;
            color: #80cbc4;
        }
        
        body[data-theme="dark"] .status-overdue {
            background-color: #ff6f00;
            color: #ffe0b2;
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary);
        }
        
        /* Utilit√°rios */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mt-10 {
            margin-top: 10px;
        }
        
        .mb-10 {
            margin-bottom: 10px;
        }
        
        .flex {
            display: flex;
        }
        
        .flex-wrap {
            flex-wrap: wrap;
        }
        
        .items-center {
            align-items: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .gap-10 {
            gap: 10px;
        }
        
        .error-message {
            color: var(--danger);
            font-size: 0.8rem;
            margin-top: 3px;
            display: none;
        }
        
        .input-error {
            border-color: var(--danger) !important;
        }
    </style>
</head>
<body data-theme="light">
    <div class="container">
        <header>
            <div class="header-top">
                <div>
                    <h1><i class="fas fa-paw"></i> Controle de Medica√ß√£o Animal</h1>
                    <p>Sistema para gerenciamento de medicamentos para animais</p>
                </div>
                
                <div class="cache-indicator">
                    <div class="cache-text">Cache App: <span id="cache-percentage">0%</span></div>
                    <div class="cache-meter">
                        <div class="cache-fill" id="cache-fill"></div>
                    </div>
                    <div class="cache-text">Cache Total: <span id="total-cache-percentage">0%</span></div>
                </div>
                
                <div class="header-controls">
                    <button class="theme-toggle" id="theme-toggle" title="Alternar tema">
                        <i class="fas fa-moon"></i>
                        <span class="btn-tooltip">Alternar entre tema claro e escuro</span>
                    </button>
                    <button class="btn btn-warning btn-small" onclick="clearAppCache()">
                        <i class="fas fa-trash-alt"></i> Limpar Cache App
                        <span class="btn-tooltip">Limpar todos os dados armazenados localmente</span>
                    </button>
                    <button class="btn btn-pdf btn-small" onclick="exportMonthToPDF()">
                        <i class="fas fa-file-pdf"></i> Exportar M√™s
                        <span class="btn-tooltip">Exportar calend√°rio do m√™s atual em PDF</span>
                    </button>
                </div>
            </div>
            
            <div class="time-display">
                <div class="time-box current-time">
                    <i class="fas fa-clock"></i> 
                    <div>
                        <div>Hor√°rio Local: <span id="local-time">--:--</span></div>
                        <div id="current-date" style="font-size: 0.85rem; font-weight: normal;">--/--/----</div>
                    </div>
                </div>
                <div class="time-box">
                    <i class="fas fa-syringe"></i>
                    <div id="next-medication-count">Pr√≥ximas: 0</div>
                </div>
                <div class="time-box" id="overdue-medication-count" style="background-color: rgba(245, 166, 35, 0.2); display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>Atrasadas: <span id="overdue-count">0</span></div>
                </div>
            </div>
        </header>
        
        <!-- Pr√≥ximas Medica√ß√µes com Timer -->
        <div class="upcoming-medications">
            <h2><i class="fas fa-hourglass-half"></i> Pr√≥ximas Medica√ß√µes</h2>
            <div class="upcoming-grid" id="upcoming-medications-list">
                <!-- Preenchido por JavaScript -->
            </div>
        </div>
        
        <!-- Cards dos Animais -->
        <div class="animal-cards" id="animal-cards-container">
            <!-- Preenchido por JavaScript -->
        </div>
        
        <!-- Calend√°rio -->
        <div class="calendar-section">
            <div class="calendar-header">
                <h2><i class="fas fa-calendar"></i> Calend√°rio de Medica√ß√µes</h2>
                <div class="calendar-nav">
                    <button class="btn btn-edit" onclick="changeMonth(-1)">
                        <i class="fas fa-chevron-left"></i> Anterior
                        <span class="btn-tooltip">M√™s anterior</span>
                    </button>
                    <h3 id="current-month">M√™s Atual</h3>
                    <button class="btn btn-edit" onclick="changeMonth(1)">
                        Pr√≥ximo <i class="fas fa-chevron-right"></i>
                        <span class="btn-tooltip">Pr√≥ximo m√™s</span>
                    </button>
                    <button class="btn btn-pdf" onclick="exportMonthRangeToPDF()">
                        <i class="fas fa-file-pdf"></i> Exportar Per√≠odo
                        <span class="btn-tooltip">Exportar um per√≠odo espec√≠fico em PDF</span>
                    </button>
                </div>
            </div>
            
            <div class="calendar-grid" id="calendar-days-header">
                <!-- Cabe√ßalhos dos dias -->
            </div>
            <div class="calendar-grid" id="calendar-days">
                <!-- Dias ser√£o gerados por JavaScript -->
            </div>
        </div>
        
        <!-- Modal para Detalhes do Dia -->
        <div class="modal" id="dayModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalDayTitle">Detalhes do Dia</h3>
                    <button class="close-modal" onclick="closeDayModal()">&times;</button>
                </div>
                <div id="modalDayContent">
                    <!-- Conte√∫do do modal ser√° preenchido por JavaScript -->
                </div>
                <div class="modal-actions">
                    <button class="btn btn-pdf" onclick="exportDayToPDF()">
                        <i class="fas fa-file-pdf"></i> Exportar PDF do Dia
                        <span class="btn-tooltip">Exportar medica√ß√µes do dia em PDF</span>
                    </button>
                    <button class="btn btn-edit" onclick="closeDayModal()">
                        <i class="fas fa-times"></i> Fechar
                        <span class="btn-tooltip">Fechar janela</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Modal para Exporta√ß√£o de Per√≠odo -->
        <div class="modal" id="exportModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Exportar Per√≠odo</h3>
                    <button class="close-modal" onclick="closeExportModal()">&times;</button>
                </div>
                <div id="exportModalContent">
                    <div class="form-group">
                        <label for="export-start-date">Data Inicial:</label>
                        <input type="date" id="export-start-date">
                    </div>
                    <div class="form-group">
                        <label for="export-end-date">Data Final:</label>
                        <input type="date" id="export-end-date">
                    </div>
                    <div class="form-group">
                        <label for="export-animal-select">Animal (opcional):</label>
                        <select id="export-animal-select">
                            <option value="all">Todos os animais</option>
                            <!-- Preenchido por JavaScript -->
                        </select>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-pdf" onclick="exportSelectedRangeToPDF()">
                        <i class="fas fa-file-pdf"></i> Exportar PDF
                        <span class="btn-tooltip">Gerar PDF do per√≠odo selecionado</span>
                    </button>
                    <button class="btn btn-edit" onclick="closeExportModal()">
                        <i class="fas fa-times"></i> Cancelar
                        <span class="btn-tooltip">Cancelar exporta√ß√£o</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Modal para Sele√ß√£o de Medicamentos -->
        <div class="modal" id="medicationSelectModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Selecionar Medicamento</h3>
                    <button class="close-modal" onclick="closeMedicationSelectModal()">&times;</button>
                </div>
                <div class="search-box">
                    <input type="text" id="search-medication" placeholder="Buscar medicamento..." onkeyup="searchMedications()">
                    <button class="btn btn-edit" onclick="searchMedications()">
                        <i class="fas fa-search"></i>
                        <span class="btn-tooltip">Buscar medicamento</span>
                    </button>
                </div>
                <div class="medication-select-list" id="medication-select-list">
                    <!-- Preenchido por JavaScript -->
                </div>
                <div class="modal-actions">
                    <button class="btn btn-add" onclick="useSelectedMedication()">
                        <i class="fas fa-check"></i> Usar Medicamento
                        <span class="btn-tooltip">Usar medicamento selecionado</span>
                    </button>
                    <button class="btn btn-edit" onclick="closeMedicationSelectModal()">
                        <i class="fas fa-times"></i> Cancelar
                        <span class="btn-tooltip">Cancelar sele√ß√£o</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Gerenciamento -->
        <div class="management-section">
            <h2><i class="fas fa-cogs"></i> Gerenciamento do Sistema</h2>
            
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="openTab(event, 'tab-animals')">Animais</button>
                    <button class="tab-button" onclick="openTab(event, 'tab-medications')">Medicamentos</button>
                    <button class="tab-button" onclick="openTab(event, 'tab-cache')">Cache</button>
                </div>
                
                <!-- Tab Animais -->
                <div id="tab-animals" class="tab-content active">
                    <div class="form-grid">
                        <div>
                            <h3><i class="fas fa-plus-circle"></i> Adicionar Novo Animal</h3>
                            <div class="form-group">
                                <label for="new-animal-name">Nome do Animal:</label>
                                <input type="text" id="new-animal-name" placeholder="Ex: Tom" maxlength="30">
                                <div class="error-message" id="animal-name-error"></div>
                            </div>
                            <div class="form-group">
                                <label for="new-animal-weight">Peso (kg):</label>
                                <input type="number" id="new-animal-weight" placeholder="Ex: 5.2" min="0.1" max="200" step="0.1">
                                <div class="error-message" id="animal-weight-error"></div>
                            </div>
                            <div class="form-group">
                                <label for="new-animal-breed">Ra√ßa:</label>
                                <input type="text" id="new-animal-breed" placeholder="Ex: SRD, Persa, etc." maxlength="30">
                            </div>
                            <div class="form-group">
                                <label for="new-animal-type">Tipo:</label>
                                <select id="new-animal-type">
                                    <option value="cat">üê± Gato</option>
                                    <option value="dog">üê∂ Cachorro</option>
                                    <option value="rabbit">üê∞ Coelho</option>
                                    <option value="hamster">üêπ Hamster</option>
                                    <option value="bird">üê¶ P√°ssaro</option>
                                    <option value="turtle">üê¢ Tartaruga</option>
                                    <option value="other">‚ùì Outro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="new-animal-icon">√çcone:</label>
                                <select id="new-animal-icon">
                                    <option value="üê±">üê± Gato</option>
                                    <option value="üê∂">üê∂ Cachorro</option>
                                    <option value="üê∞">üê∞ Coelho</option>
                                    <option value="üêπ">üêπ Hamster</option>
                                    <option value="üê¶">üê¶ P√°ssaro</option>
                                    <option value="üê¢">üê¢ Tartaruga</option>
                                    <option value="‚ùì">‚ùì Outro</option>
                                </select>
                            </div>
                            <button class="btn btn-add" onclick="addNewAnimal()">
                                <i class="fas fa-plus"></i> Adicionar Animal
                                <span class="btn-tooltip">Adicionar novo animal ao sistema</span>
                            </button>
                        </div>
                        
                        <div>
                            <h3><i class="fas fa-list"></i> Animais Cadastrados</h3>
                            <div class="animals-list" id="animals-management-list">
                                <!-- Preenchido por JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Medicamentos -->
                <div id="tab-medications" class="tab-content">
                    <div class="form-grid">
                        <div>
                            <h3><i class="fas fa-pills"></i> Adicionar Medicamento</h3>
                            <div class="form-group">
                                <label for="med-animal-select">Animal:</label>
                                <select id="med-animal-select">
                                    <!-- Preenchido por JavaScript -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="new-med-name">Nome do Medicamento:</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" id="new-med-name" placeholder="Ex: Antibi√≥tico" maxlength="50" style="flex: 1;">
                                    <button class="btn btn-edit btn-small" onclick="openMedicationSelectModal()">
                                        <i class="fas fa-search"></i>
                                        <span class="btn-tooltip">Buscar medicamentos cadastrados</span>
                                    </button>
                                </div>
                                <div class="error-message" id="med-name-error"></div>
                            </div>
                            <div class="form-group">
                                <label for="new-med-dosage">Dosagem:</label>
                                <input type="text" id="new-med-dosage" placeholder="Ex: 1 comprimido" maxlength="30">
                                <div class="error-message" id="med-dosage-error"></div>
                            </div>
                            <div class="form-group">
                                <label for="new-med-frequency">Frequ√™ncia:</label>
                                <select id="new-med-frequency" onchange="toggleCustomFrequency()">
                                    <option value="hourly">A cada hora</option>
                                    <option value="2h">A cada 2 horas</option>
                                    <option value="3h">A cada 3 horas</option>
                                    <option value="4h">A cada 4 horas</option>
                                    <option value="6h">A cada 6 horas</option>
                                    <option value="8h">A cada 8 horas</option>
                                    <option value="12h">12/12h</option>
                                    <option value="daily">1x ao dia</option>
                                    <option value="2xday">2x ao dia</option>
                                    <option value="3xday">3x ao dia</option>
                                    <option value="4xday">4x ao dia</option>
                                    <option value="24h">A cada 24 horas</option>
                                    <option value="48h">A cada 48h</option>
                                    <option value="72h">A cada 72h</option>
                                    <option value="weekly">1x por semana</option>
                                    <option value="biweekly">2x por semana</option>
                                    <option value="monthly">1x por m√™s</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </div>
                            
                            <!-- Campos para frequ√™ncia personalizada -->
                            <div id="custom-frequency-fields" class="hidden">
                                <div class="form-group">
                                    <label for="custom-frequency-value">Intervalo (horas):</label>
                                    <input type="number" id="custom-frequency-value" min="1" max="720" value="24">
                                    <div class="error-message" id="custom-frequency-error"></div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="new-med-schedule">Hor√°rio:</label>
                                <select id="new-med-schedule">
                                    <option value="morning">Manh√£ (07:30-08:00)</option>
                                    <option value="noon">Meio-dia (12:00-12:30)</option>
                                    <option value="afternoon">Tarde (16:00-16:30)</option>
                                    <option value="night">Noite (19:30-21:00)</option>
                                    <option value="both">Manh√£ e Noite</option>
                                    <option value="multiple">M√∫ltiplos hor√°rios</option>
                                </select>
                            </div>
                            
                            <!-- Campos para m√∫ltiplos hor√°rios -->
                            <div id="multiple-schedule-fields" class="hidden">
                                <div class="form-group">
                                    <label>Hor√°rios Personalizados:</label>
                                    <div id="multiple-schedule-list">
                                        <!-- Preenchido por JavaScript -->
                                    </div>
                                    <button class="btn btn-add btn-small" onclick="addScheduleTime()">
                                        <i class="fas fa-plus"></i> Adicionar Hor√°rio
                                        <span class="btn-tooltip">Adicionar novo hor√°rio</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="new-med-start-date">Data de In√≠cio:</label>
                                <input type="date" id="new-med-start-date">
                            </div>
                            <div class="form-group">
                                <label for="new-med-duration-type">Dura√ß√£o:</label>
                                <select id="new-med-duration-type" onchange="toggleDurationFields()">
                                    <option value="days">N√∫mero de dias</option>
                                    <option value="weeks">N√∫mero de semanas</option>
                                    <option value="months">N√∫mero de meses</option>
                                    <option value="end_date">Data de t√©rmino</option>
                                    <option value="continuous">Cont√≠nuo</option>
                                </select>
                            </div>
                            <div class="form-group" id="duration-days-container">
                                <label for="new-med-duration-days">N√∫mero de dias:</label>
                                <input type="number" id="new-med-duration-days" min="1" max="365" value="7">
                                <div class="error-message" id="duration-days-error"></div>
                            </div>
                            <div class="form-group hidden" id="duration-weeks-container">
                                <label for="new-med-duration-weeks">N√∫mero de semanas:</label>
                                <input type="number" id="new-med-duration-weeks" min="1" max="52" value="1">
                                <div class="error-message" id="duration-weeks-error"></div>
                            </div>
                            <div class="form-group hidden" id="duration-months-container">
                                <label for="new-med-duration-months">N√∫mero de meses:</label>
                                <input type="number" id="new-med-duration-months" min="1" max="12" value="1">
                                <div class="error-message" id="duration-months-error"></div>
                            </div>
                            <div class="form-group hidden" id="end-date-container">
                                <label for="new-med-end-date">Data de T√©rmino:</label>
                                <input type="date" id="new-med-end-date">
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="save-medication-cache"> Salvar medicamento no cache
                                </label>
                            </div>
                            <button class="btn btn-add" onclick="addNewMedication()">
                                <i class="fas fa-plus"></i> Adicionar Medicamento
                                <span class="btn-tooltip">Adicionar medicamento ao animal selecionado</span>
                            </button>
                        </div>
                        
                        <div>
                            <h3><i class="fas fa-prescription"></i> Medicamentos Pr√©-cadastrados</h3>
                            <div class="controls" style="margin-bottom: 15px;">
                                <button class="btn btn-edit btn-small" onclick="addPreloadedMedication('frajola', 'Vetmax Plus', '¬Ω comprimido', 'daily', 'morning', 3)">
                                    <i class="fas fa-plus"></i> Vetmax Plus (Frajola)
                                    <span class="btn-tooltip">Adicionar medicamento ao Frajola</span>
                                </button>
                                <button class="btn btn-edit btn-small" onclick="addPreloadedMedication('frajola', 'Omegablue Esqualeno', '1 c√°psula', '48h', 'night', null)">
                                    <i class="fas fa-plus"></i> Omegablue (Frajola)
                                    <span class="btn-tooltip">Adicionar medicamento ao Frajola</span>
                                </button>
                            </div>
                            <div id="preloaded-medications-list">
                                <!-- Preenchido por JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Cache -->
                <div id="tab-cache" class="tab-content">
                    <h3><i class="fas fa-database"></i> Controle de Cache</h3>
                    <div class="controls">
                        <button class="btn btn-warning" onclick="clearAppCache()">
                            <i class="fas fa-trash-alt"></i> Limpar Cache do App
                            <span class="btn-tooltip">Limpar todos os dados armazenados localmente</span>
                        </button>
                        <button class="btn btn-edit" onclick="exportData()">
                            <i class="fas fa-download"></i> Exportar Dados
                            <span class="btn-tooltip">Exportar todos os dados em formato JSON</span>
                        </button>
                        <button class="btn btn-edit" onclick="importData()">
                            <i class="fas fa-upload"></i> Importar Dados
                            <span class="btn-tooltip">Importar dados de um arquivo JSON</span>
                        </button>
                        <button class="btn btn-danger" onclick="resetAllData()">
                            <i class="fas fa-exclamation-triangle"></i> Resetar Tudo
                            <span class="btn-tooltip">Resetar todos os dados para o padr√£o</span>
                        </button>
                        <button class="btn btn-add" onclick="vetSystem.loadDefaultData()">
                            <i class="fas fa-cat"></i> Carregar Dados dos Gatos
                            <span class="btn-tooltip">Carregar dados pr√©-definidos dos gatos</span>
                        </button>
                        <button class="btn btn-add" onclick="vetSystem.loadJSONFromFile()">
                            <i class="fas fa-file-code"></i> Carregar Arquivo JSON
                            <span class="btn-tooltip">Carregar dados do arquivo importacao_gatos.json</span>
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4>Cache de Medicamentos</h4>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                            <button class="btn btn-add btn-small" onclick="addAllPreloadedMedications()">
                                <i class="fas fa-vial"></i> Carregar Todos Medicamentos Exemplo
                                <span class="btn-tooltip">Carregar todos os medicamentos de exemplo</span>
                            </button>
                            <button class="btn btn-edit btn-small" onclick="saveMedicationsToCache()">
                                <i class="fas fa-save"></i> Salvar Medicamentos em Cache
                                <span class="btn-tooltip">Salvar medicamentos no cache local</span>
                            </button>
                            <button class="btn btn-warning btn-small" onclick="clearMedicationsCache()">
                                <i class="fas fa-trash"></i> Limpar Medicamentos do Cache
                                <span class="btn-tooltip">Limpar medicamentos do cache local</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notifica√ß√£o -->
        <div class="notification" id="notification">
            Medica√ß√£o registrada com sucesso!
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p>Sistema de controle de medica√ß√£o animal | Desenvolvido por Marcos Guimar√£es Duailibi Filho</p>
            <div class="developer-info">
                <p><i class="fas fa-phone"></i> Contato: +55 (95) 98111-4983</p>
                <p><i class="fas fa-envelope"></i> Email: marcosduailibi12345@hotmail.com</p>
            </div>
            <p style="margin-top: 15px;">¬© 2025 - Todos os direitos reservados.</p>
        </div>
    </div>

    <script>
        // Dados pr√©-configurados dos gatos (atualizado)
        const DEFAULT_DATA = {
            "animals": {
                "frajola": {
                    "id": "frajola",
                    "name": "Frajola",
                    "weight": "4,5 kg",
                    "breed": "SRD",
                    "type": "cat",
                    "icon": "üê±",
                    "medications": {
                        "vetmaxplus_123456": {
                            "id": "vetmaxplus_123456",
                            "name": "Vetmax Plus",
                            "dosage": "¬Ω comprimido",
                            "frequency": "daily",
                            "schedule": "morning",
                            "startDate": "2025-12-14",
                            "duration": 3,
                            "durationType": "days",
                            "history": [],
                            "scheduledDates": [
                                "2025-12-14",
                                "2025-12-15",
                                "2025-12-16",
                                "2025-12-29",
                                "2025-12-30",
                                "2025-12-31",
                                "2026-01-13",
                                "2026-01-14",
                                "2026-01-15"
                            ]
                        },
                        "omegablue_123457": {
                            "id": "omegablue_123457",
                            "name": "Omegablue Esqualeno",
                            "dosage": "1 c√°psula",
                            "frequency": "48h",
                            "schedule": "night",
                            "startDate": "2025-12-14",
                            "duration": null,
                            "durationType": "continuous",
                            "history": [],
                            "scheduledDates": [
                                "2025-12-14",
                                "2025-12-16",
                                "2025-12-18",
                                "2025-12-20",
                                "2025-12-22",
                                "2025-12-24",
                                "2025-12-26",
                                "2025-12-28",
                                "2025-12-30",
                                "2026-01-01",
                                "2026-01-03",
                                "2026-01-05",
                                "2026-01-07",
                                "2026-01-09",
                                "2026-01-11",
                                "2026-01-13",
                                "2026-01-15"
                            ]
                        }
                    }
                },
                "nenem": {
                    "id": "nenem",
                    "name": "Nen√©m",
                    "weight": "3,8 kg",
                    "breed": "SRD",
                    "type": "cat",
                    "icon": "üê±",
                    "medications": {
                        "petsporin_123458": {
                            "id": "petsporin_123458",
                            "name": "Petsporin 75 mg",
                            "dosage": "¬Ω comprimido",
                            "frequency": "12h",
                            "schedule": "both",
                            "startDate": "2025-12-14",
                            "duration": 7,
                            "durationType": "days",
                            "history": [],
                            "scheduledDates": [
                                "2025-12-14_morning",
                                "2025-12-14_night",
                                "2025-12-15_morning",
                                "2025-12-15_night",
                                "2025-12-16_morning",
                                "2025-12-16_night",
                                "2025-12-17_morning",
                                "2025-12-17_night",
                                "2025-12-18_morning",
                                "2025-12-18_night",
                                "2025-12-19_morning",
                                "2025-12-19_night",
                                "2025-12-20_morning",
                                "2025-12-20_night"
                            ]
                        },
                        "mellisvet_123459": {
                            "id": "mellisvet_123459",
                            "name": "Mellis Vet 0,5 mg",
                            "dosage": "1 comprimido",
                            "frequency": "daily",
                            "schedule": "morning",
                            "startDate": "2025-12-14",
                            "duration": 5,
                            "durationType": "days",
                            "history": [],
                            "scheduledDates": [
                                "2025-12-14",
                                "2025-12-15",
                                "2025-12-16",
                                "2025-12-17",
                                "2025-12-18"
                            ]
                        },
                        "hemocare_123460": {
                            "id": "hemocare_123460",
                            "name": "Hemocare",
                            "dosage": "0,4 ml",
                            "frequency": "daily",
                            "schedule": "morning",
                            "startDate": "2025-12-14",
                            "duration": 30,
                            "durationType": "days",
                            "history": [],
                            "scheduledDates": [
                                "2025-12-14",
                                "2025-12-15",
                                "2025-12-16",
                                "2025-12-17",
                                "2025-12-18",
                                "2025-12-19",
                                "2025-12-20",
                                "2025-12-21",
                                "2025-12-22",
                                "2025-12-23",
                                "2025-12-24",
                                "2025-12-25",
                                "2025-12-26",
                                "2025-12-27",
                                "2025-12-28",
                                "2025-12-29",
                                "2025-12-30",
                                "2025-12-31",
                                "2026-01-01",
                                "2026-01-02",
                                "2026-01-03",
                                "2026-01-04",
                                "2026-01-05",
                                "2026-01-06",
                                "2026-01-07",
                                "2026-01-08",
                                "2026-01-09",
                                "2026-01-10",
                                "2026-01-11",
                                "2026-01-12"
                            ]
                        },
                        "promuncat_123461": {
                            "id": "promuncat_123461",
                            "name": "Promun Cat Pasta",
                            "dosage": "2 ml",
                            "frequency": "daily",
                            "schedule": "morning",
                            "startDate": "2025-12-14",
                            "duration": null,
                            "durationType": "continuous",
                            "history": [],
                            "scheduledDates": [
                                "2025-12-14",
                                "2025-12-15",
                                "2025-12-16",
                                "2025-12-17",
                                "2025-12-18",
                                "2025-12-19",
                                "2025-12-20",
                                "2025-12-21",
                                "2025-12-22",
                                "2025-12-23",
                                "2025-12-24",
                                "2025-12-25",
                                "2025-12-26",
                                "2025-12-27",
                                "2025-12-28",
                                "2025-12-29",
                                "2025-12-30",
                                "2025-12-31",
                                "2026-01-01",
                                "2026-01-02",
                                "2026-01-03",
                                "2026-01-04",
                                "2026-01-05",
                                "2026-01-06",
                                "2026-01-07",
                                "2026-01-08",
                                "2026-01-09",
                                "2026-01-10",
                                "2026-01-11",
                                "2026-01-12",
                                "2026-01-13",
                                "2026-01-14",
                                "2026-01-15",
                                "2026-01-16",
                                "2026-01-17",
                                "2026-01-18",
                                "2026-01-19",
                                "2026-01-20",
                                "2026-01-21",
                                "2026-01-22",
                                "2026-01-23",
                                "2026-01-24",
                                "2026-01-25",
                                "2026-01-26",
                                "2026-01-27",
                                "2026-01-28",
                                "2026-01-29",
                                "2026-01-30",
                                "2026-01-31",
                                "2026-02-01",
                                "2026-02-02",
                                "2026-02-03",
                                "2026-02-04",
                                "2026-02-05",
                                "2026-02-06",
                                "2026-02-07",
                                "2026-02-08",
                                "2026-02-09",
                                "2026-02-10",
                                "2026-02-11",
                                "2026-02-12"
                            ]
                        },
                        "dipirona_123462": {
                            "id": "dipirona_123462",
                            "name": "Dipirona gotas",
                            "dosage": "3 gotas",
                            "frequency": "12h",
                            "schedule": "both",
                            "startDate": "2025-12-14",
                            "duration": 5,
                            "durationType": "days",
                            "conditional": true,
                            "history": [],
                            "scheduledDates": [
                                "2025-12-14_morning",
                                "2025-12-14_night",
                                "2025-12-15_morning",
                                "2025-12-15_night",
                                "2025-12-16_morning",
                                "2025-12-16_night",
                                "2025-12-17_morning",
                                "2025-12-17_night",
                                "2025-12-18_morning",
                                "2025-12-18_night"
                            ]
                        },
                        "vetaglos_123463": {
                            "id": "vetaglos_123463",
                            "name": "Vetagl√≥s pomada",
                            "dosage": "Aplica√ß√£o t√≥pica",
                            "frequency": "12h",
                            "schedule": "both",
                            "startDate": "2025-12-14",
                            "duration": null,
                            "durationType": "continuous",
                            "history": [],
                            "scheduledDates": [
                                "2025-12-14_morning",
                                "2025-12-14_night",
                                "2025-12-15_morning",
                                "2025-12-15_night",
                                "2025-12-16_morning",
                                "2025-12-16_night",
                                "2025-12-17_morning",
                                "2025-12-17_night",
                                "2025-12-18_morning",
                                "2025-12-18_night",
                                "2025-12-19_morning",
                                "2025-12-19_night",
                                "2025-12-20_morning",
                                "2025-12-20_night",
                                "2025-12-21_morning",
                                "2025-12-21_night",
                                "2025-12-22_morning",
                                "2025-12-22_night",
                                "2025-12-23_morning",
                                "2025-12-23_night",
                                "2025-12-24_morning",
                                "2025-12-24_night",
                                "2025-12-25_morning",
                                "2025-12-25_night",
                                "2025-12-26_morning",
                                "2025-12-26_night",
                                "2025-12-27_morning",
                                "2025-12-27_night",
                                "2025-12-28_morning",
                                "2025-12-28_night",
                                "2025-12-29_morning",
                                "2025-12-29_night",
                                "2025-12-30_morning",
                                "2025-12-30_night",
                                "2025-12-31_morning",
                                "2025-12-31_night",
                                "2026-01-01_morning",
                                "2026-01-01_night",
                                "2026-01-02_morning",
                                "2026-01-02_night",
                                "2026-01-03_morning",
                                "2026-01-03_night",
                                "2026-01-04_morning",
                                "2026-01-04_night",
                                "2026-01-05_morning",
                                "2026-01-05_night",
                                "2026-01-06_morning",
                                "2026-01-06_night",
                                "2026-01-07_morning",
                                "2026-01-07_night",
                                "2026-01-08_morning",
                                "2026-01-08_night",
                                "2026-01-09_morning",
                                "2026-01-09_night",
                                "2026-01-10_morning",
                                "2026-01-10_night",
                                "2026-01-11_morning",
                                "2026-01-11_night",
                                "2026-01-12_morning",
                                "2026-01-12_night"
                            ]
                        }
                    }
                }
            },
            "calendarMonth": 11,
            "calendarYear": 2025,
            "lastUpdated": "2025-12-14T10:30:00.000Z",
            "version": "3.0"
        };

        // Medicamentos pr√©-cadastrados para cache
        const PRELOADED_MEDICATIONS = {
            "vetmax_plus": {
                "id": "vetmax_plus",
                "name": "Vetmax Plus",
                "common_dosage": "¬Ω comprimido",
                "type": "antibi√≥tico",
                "category": "comprimido"
            },
            "omegablue_esqualeno": {
                "id": "omegablue_esqualeno",
                "name": "Omegablue Esqualeno",
                "common_dosage": "1 c√°psula",
                "type": "suplemento",
                "category": "c√°psula"
            },
            "petsporin_75mg": {
                "id": "petsporin_75mg",
                "name": "Petsporin 75 mg",
                "common_dosage": "¬Ω comprimido",
                "type": "antibi√≥tico",
                "category": "comprimido"
            },
            "mellis_vet_05mg": {
                "id": "mellis_vet_05mg",
                "name": "Mellis Vet 0,5 mg",
                "common_dosage": "1 comprimido",
                "type": "analg√©sico",
                "category": "comprimido"
            },
            "hemocare": {
                "id": "hemocare",
                "name": "Hemocare",
                "common_dosage": "0,4 ml",
                "type": "suplemento",
                "category": "l√≠quido"
            },
            "promun_cat_pasta": {
                "id": "promun_cat_pasta",
                "name": "Promun Cat Pasta",
                "common_dosage": "2 ml",
                "type": "suplemento",
                "category": "pasta"
            },
            "dipirona_gotas": {
                "id": "dipirona_gotas",
                "name": "Dipirona gotas",
                "common_dosage": "3 gotas",
                "type": "analg√©sico",
                "category": "l√≠quido"
            },
            "vetaglos_pomada": {
                "id": "vetaglos_pomada",
                "name": "Vetagl√≥s pomada",
                "common_dosage": "Aplica√ß√£o t√≥pica",
                "type": "pomada",
                "category": "t√≥pico"
            }
        };

        // Sistema de cache avan√ßado
        class CacheManager {
            constructor() {
                this.appCacheKey = 'vetmed_app_data';
                this.medicationsCacheKey = 'vetmed_medications_cache';
                this.appCacheLimit = 0.3; // 30% do storage dispon√≠vel
            }
            
            getAppCacheSize() {
                const appData = localStorage.getItem(this.appCacheKey);
                return appData ? appData.length * 2 : 0; // em bytes
            }
            
            getTotalCacheSize() {
                let total = 0;
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        total += localStorage[key].length * 2;
                    }
                }
                return total;
            }
            
            getAppCachePercentage() {
                const appSize = this.getAppCacheSize();
                const totalLimit = 5 * 1024 * 1024; // 5MB em bytes
                return (appSize / totalLimit) * 100;
            }
            
            getTotalCachePercentage() {
                const totalSize = this.getTotalCacheSize();
                const totalLimit = 5 * 1024 * 1024; // 5MB em bytes
                return (totalSize / totalLimit) * 100;
            }
            
            clearAppCache() {
                localStorage.removeItem(this.appCacheKey);
                this.updateCacheDisplay();
                showNotification('Cache da aplica√ß√£o limpo com sucesso!');
            }
            
            clearMedicationsCache() {
                localStorage.removeItem(this.medicationsCacheKey);
                this.updateCacheDisplay();
                showNotification('Cache de medicamentos limpo com sucesso!', 'info');
            }
            
            saveMedicationsToCache(medications) {
                try {
                    localStorage.setItem(this.medicationsCacheKey, JSON.stringify(medications));
                    this.updateCacheDisplay();
                    return true;
                } catch (e) {
                    console.error('Erro ao salvar medicamentos no cache:', e);
                    return false;
                }
            }
            
            getMedicationsFromCache() {
                try {
                    const cached = localStorage.getItem(this.medicationsCacheKey);
                    return cached ? JSON.parse(cached) : null;
                } catch (e) {
                    console.error('Erro ao carregar medicamentos do cache:', e);
                    return null;
                }
            }
            
            updateCacheDisplay() {
                const appPercentage = this.getAppCachePercentage();
                const totalPercentage = this.getTotalCachePercentage();
                
                const fillElement = document.getElementById('cache-fill');
                const appTextElement = document.getElementById('cache-percentage');
                const totalTextElement = document.getElementById('total-cache-percentage');
                
                fillElement.style.width = `${appPercentage}%`;
                appTextElement.textContent = `${appPercentage.toFixed(1)}%`;
                totalTextElement.textContent = `${totalPercentage.toFixed(1)}%`;
                
                // Altera a cor conforme o uso
                if (appPercentage > 25) {
                    fillElement.style.background = 'linear-gradient(90deg, #f5a623, #d0021b)';
                } else if (appPercentage > 15) {
                    fillElement.style.background = 'linear-gradient(90deg, #f5a623, #f5a623)';
                } else {
                    fillElement.style.background = 'linear-gradient(90deg, var(--secondary), var(--info))';
                }
            }
        }

        // Sistema principal
        class VeterinarySystem {
            constructor() {
                this.cacheManager = new CacheManager();
                this.timezone = null;
                this.currentDate = new Date();
                this.calendarMonth = new Date().getMonth();
                this.calendarYear = new Date().getFullYear();
                this.selectedDay = null;
                this.upcomingTimers = [];
                this.selectedMedicationId = null;
                this.scheduleTimes = [];
                
                // Dados iniciais em cache
                this.preloadedMedications = {
                    'frajola': [
                        {
                            name: 'Vetmax Plus',
                            dosage: '¬Ω comprimido',
                            frequency: 'daily',
                            schedule: 'morning',
                            startDate: this.getCurrentDate(),
                            duration: 3,
                            durationType: 'days'
                        },
                        {
                            name: 'Omegablue Esqualeno',
                            dosage: '1 c√°psula',
                            frequency: '48h',
                            schedule: 'night',
                            startDate: this.getCurrentDate(),
                            duration: null,
                            durationType: 'continuous'
                        }
                    ],
                    'nenem': [
                        {
                            name: 'Petsporin 75 mg',
                            dosage: '¬Ω comprimido',
                            frequency: '12h',
                            schedule: 'both',
                            startDate: this.getCurrentDate(),
                            duration: 7,
                            durationType: 'days'
                        },
                        {
                            name: 'Mellis Vet 0,5 mg',
                            dosage: '1 comprimido',
                            frequency: 'daily',
                            schedule: 'morning',
                            startDate: this.getCurrentDate(),
                            duration: 5,
                            durationType: 'days'
                        },
                        {
                            name: 'Hemocare',
                            dosage: '0,4 ml',
                            frequency: 'daily',
                            schedule: 'morning',
                            startDate: this.getCurrentDate(),
                            duration: 30,
                            durationType: 'days'
                        },
                        {
                            name: 'Promun Cat Pasta',
                            dosage: '2 ml',
                            frequency: 'daily',
                            schedule: 'morning',
                            startDate: this.getCurrentDate(),
                            duration: null,
                            durationType: 'continuous'
                        },
                        {
                            name: 'Dipirona gotas',
                            dosage: '3 gotas',
                            frequency: '12h',
                            schedule: 'both',
                            startDate: this.getCurrentDate(),
                            duration: 5,
                            durationType: 'days'
                        },
                        {
                            name: 'Vetagl√≥s pomada',
                            dosage: 'Aplica√ß√£o t√≥pica',
                            frequency: '12h',
                            schedule: 'both',
                            startDate: this.getCurrentDate(),
                            duration: null,
                            durationType: 'continuous'
                        }
                    ]
                };
                
                // Estado inicial dos animais - come√ßamos com dados vazios, ser√£o carregados do cache ou padr√£o
                this.animals = {};
                this.medicationsCache = {};
            }
            
            init() {
                this.loadFromCache();
                this.loadMedicationsCache();
                this.setupEventListeners();
                this.setupTheme();
                this.updateTime();
                this.updateCacheDisplay();
                this.renderAll();
                this.startTimers();
                this.renderPreloadedMedications();
                setInterval(() => this.updateTime(), 1000);
                setInterval(() => this.updateCacheDisplay(), 5000);
                setInterval(() => this.updateUpcomingMedications(), 1000);
            }
            
            loadDefaultData() {
                if (confirm('Isso ir√° carregar os dados dos seus gatos (Frajola e Nen√©m) com todos os medicamentos. Deseja continuar?')) {
                    const data = DEFAULT_DATA;
                    this.animals = data.animals || {};
                    this.calendarMonth = data.calendarMonth || new Date().getMonth();
                    this.calendarYear = data.calendarYear || new Date().getFullYear();
                    
                    this.saveToCache();
                    this.populateAnimalSelect();
                    this.populateExportAnimalSelect();
                    this.renderAll();
                    this.updateUpcomingMedications();
                    showNotification('Dados dos seus gatos carregados com sucesso!');
                }
            }
            
            async loadJSONFromFile() {
                try {
                    const response = await fetch('src/importacao_gatos.json');
                    const data = await response.json();
                    
                    if (data.animals) {
                        this.animals = data.animals;
                        this.calendarMonth = data.calendarMonth || new Date().getMonth();
                        this.calendarYear = data.calendarYear || new Date().getFullYear();
                        
                        this.saveToCache();
                        this.populateAnimalSelect();
                        this.populateExportAnimalSelect();
                        this.renderAll();
                        this.updateUpcomingMedications();
                        showNotification('Dados do arquivo JSON carregados com sucesso!');
                    } else {
                        showNotification('Formato de arquivo inv√°lido!', 'danger');
                    }
                } catch (error) {
                    console.error('Erro ao carregar arquivo JSON:', error);
                    showNotification('Erro ao carregar arquivo JSON!', 'danger');
                }
            }
            
            setupTheme() {
                const themeToggle = document.getElementById('theme-toggle');
                const savedTheme = localStorage.getItem('vetmed_theme') || 'light';
                document.body.setAttribute('data-theme', savedTheme);
                
                themeToggle.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                
                themeToggle.addEventListener('click', () => {
                    const currentTheme = document.body.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    document.body.setAttribute('data-theme', newTheme);
                    themeToggle.innerHTML = newTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                    
                    localStorage.setItem('vetmed_theme', newTheme);
                });
            }
            
            setupEventListeners() {
                // Toggle de tipo de dura√ß√£o
                const durationTypeSelect = document.getElementById('new-med-duration-type');
                durationTypeSelect.addEventListener('change', () => this.toggleDurationFields());
                
                // Toggle de hor√°rios
                const scheduleSelect = document.getElementById('new-med-schedule');
                scheduleSelect.addEventListener('change', () => this.toggleScheduleFields());
                
                // Configura datas padr√£o
                const startDateInput = document.getElementById('new-med-start-date');
                const today = new Date();
                startDateInput.value = this.formatDate(today);
                
                const exportStartDate = document.getElementById('export-start-date');
                const exportEndDate = document.getElementById('export-end-date');
                exportStartDate.value = this.formatDate(today);
                exportEndDate.value = this.formatDate(new Date(today.getFullYear(), today.getMonth() + 1, 0));
                
                // Valida√ß√£o em tempo real
                this.setupValidation();
            }
            
            toggleDurationFields() {
                const durationTypeSelect = document.getElementById('new-med-duration-type');
                const daysContainer = document.getElementById('duration-days-container');
                const weeksContainer = document.getElementById('duration-weeks-container');
                const monthsContainer = document.getElementById('duration-months-container');
                const endDateContainer = document.getElementById('end-date-container');
                
                // Esconde todos os containers primeiro
                daysContainer.classList.add('hidden');
                weeksContainer.classList.add('hidden');
                monthsContainer.classList.add('hidden');
                endDateContainer.classList.add('hidden');
                
                if (durationTypeSelect.value === 'days') {
                    daysContainer.classList.remove('hidden');
                } else if (durationTypeSelect.value === 'weeks') {
                    weeksContainer.classList.remove('hidden');
                } else if (durationTypeSelect.value === 'months') {
                    monthsContainer.classList.remove('hidden');
                } else if (durationTypeSelect.value === 'end_date') {
                    endDateContainer.classList.remove('hidden');
                    
                    // Define data de t√©rmino padr√£o (7 dias ap√≥s hoje)
                    const endDateInput = document.getElementById('new-med-end-date');
                    const today = new Date();
                    const endDate = new Date(today);
                    endDate.setDate(today.getDate() + 7);
                    endDateInput.value = endDate.toISOString().split('T')[0];
                }
            }
            
            toggleScheduleFields() {
                const scheduleSelect = document.getElementById('new-med-schedule');
                const multipleScheduleFields = document.getElementById('multiple-schedule-fields');
                
                if (scheduleSelect.value === 'multiple') {
                    multipleScheduleFields.classList.remove('hidden');
                    this.renderScheduleTimes();
                } else {
                    multipleScheduleFields.classList.add('hidden');
                }
            }
            
            renderScheduleTimes() {
                const container = document.getElementById('multiple-schedule-list');
                container.innerHTML = '';
                
                this.scheduleTimes.forEach((time, index) => {
                    const timeItem = document.createElement('div');
                    timeItem.className = 'form-group';
                    timeItem.innerHTML = `
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="time" value="${time}" id="schedule-time-${index}" style="flex: 1;">
                            <button class="btn btn-danger btn-small" onclick="vetSystem.removeScheduleTime(${index})">
                                <i class="fas fa-trash"></i>
                                <span class="btn-tooltip">Remover hor√°rio</span>
                            </button>
                        </div>
                    `;
                    container.appendChild(timeItem);
                });
                
                if (this.scheduleTimes.length === 0) {
                    container.innerHTML = '<p style="text-align: center; opacity: 0.7;">Nenhum hor√°rio adicionado</p>';
                }
            }
            
            addScheduleTime() {
                this.scheduleTimes.push('12:00');
                this.renderScheduleTimes();
            }
            
            removeScheduleTime(index) {
                this.scheduleTimes.splice(index, 1);
                this.renderScheduleTimes();
            }
            
            toggleCustomFrequency() {
                const frequencySelect = document.getElementById('new-med-frequency');
                const customFields = document.getElementById('custom-frequency-fields');
                
                if (frequencySelect.value === 'custom') {
                    customFields.classList.remove('hidden');
                } else {
                    customFields.classList.add('hidden');
                }
            }
            
            setupValidation() {
                // Valida√ß√£o do peso do animal
                const weightInput = document.getElementById('new-animal-weight');
                weightInput.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    const errorElement = document.getElementById('animal-weight-error');
                    
                    if (value < 0.1 || value > 200) {
                        e.target.classList.add('input-error');
                        errorElement.textContent = 'Peso deve estar entre 0.1kg e 200kg';
                        errorElement.style.display = 'block';
                    } else {
                        e.target.classList.remove('input-error');
                        errorElement.style.display = 'none';
                    }
                });
                
                // Valida√ß√£o da dosagem
                const dosageInput = document.getElementById('new-med-dosage');
                dosageInput.addEventListener('input', (e) => {
                    const value = e.target.value.trim();
                    const errorElement = document.getElementById('med-dosage-error');
                    
                    if (value.length === 0) {
                        e.target.classList.add('input-error');
                        errorElement.textContent = 'A dosagem √© obrigat√≥ria';
                        errorElement.style.display = 'block';
                    } else {
                        e.target.classList.remove('input-error');
                        errorElement.style.display = 'none';
                    }
                });
                
                // Valida√ß√£o dos dias de dura√ß√£o
                const durationDaysInput = document.getElementById('new-med-duration-days');
                durationDaysInput.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    const errorElement = document.getElementById('duration-days-error');
                    
                    if (value < 1 || value > 365) {
                        e.target.classList.add('input-error');
                        errorElement.textContent = 'Dura√ß√£o deve estar entre 1 e 365 dias';
                        errorElement.style.display = 'block';
                    } else {
                        e.target.classList.remove('input-error');
                        errorElement.style.display = 'none';
                    }
                });
            }
            
            getCurrentDate() {
                return this.formatDate(new Date());
            }
            
            formatDate(date) {
                return date.toISOString().split('T')[0];
            }
            
            generateScheduledDates(frequency, startDate, duration, durationType, customHours = 24, scheduleTimes = []) {
                const scheduledDates = [];
                const start = new Date(startDate);
                
                if (durationType === 'continuous') {
                    // Para medicamentos cont√≠nuos, gerar para os pr√≥ximos 90 dias
                    for (let i = 0; i < 90; i++) {
                        const date = new Date(start);
                        date.setDate(start.getDate() + i);
                        this.addDateBasedOnFrequency(date, frequency, scheduledDates, customHours, scheduleTimes);
                    }
                } else {
                    // Para medicamentos com dura√ß√£o definida
                    let endDate;
                    
                    if (durationType === 'days') {
                        endDate = new Date(start.getTime() + (duration * 24 * 60 * 60 * 1000));
                    } else if (durationType === 'weeks') {
                        endDate = new Date(start.getTime() + (duration * 7 * 24 * 60 * 60 * 1000));
                    } else if (durationType === 'months') {
                        endDate = new Date(start);
                        endDate.setMonth(endDate.getMonth() + duration);
                    } else {
                        endDate = new Date(duration);
                    }
                    
                    let currentDate = new Date(start);
                    let dayCount = 0;
                    
                    while (currentDate <= endDate && dayCount < 365) {
                        this.addDateBasedOnFrequency(currentDate, frequency, scheduledDates, customHours, scheduleTimes);
                        currentDate.setDate(currentDate.getDate() + 1);
                        dayCount++;
                    }
                }
                
                return scheduledDates;
            }
            
            addDateBasedOnFrequency(date, frequency, scheduledDates, customHours = 24, scheduleTimes = []) {
                const dateStr = date.toISOString().split('T')[0];
                
                if (frequency === 'hourly') {
                    scheduledDates.push(dateStr + '_00:00');
                } else if (frequency === '2h') {
                    for (let hour = 0; hour < 24; hour += 2) {
                        scheduledDates.push(dateStr + `_${hour.toString().padStart(2, '0')}:00`);
                    }
                } else if (frequency === '3h') {
                    for (let hour = 0; hour < 24; hour += 3) {
                        scheduledDates.push(dateStr + `_${hour.toString().padStart(2, '0')}:00`);
                    }
                } else if (frequency === '4h') {
                    for (let hour = 0; hour < 24; hour += 4) {
                        scheduledDates.push(dateStr + `_${hour.toString().padStart(2, '0')}:00`);
                    }
                } else if (frequency === '6h') {
                    for (let hour = 0; hour < 24; hour += 6) {
                        scheduledDates.push(dateStr + `_${hour.toString().padStart(2, '0')}:00`);
                    }
                } else if (frequency === '8h') {
                    for (let hour = 0; hour < 24; hour += 8) {
                        scheduledDates.push(dateStr + `_${hour.toString().padStart(2, '0')}:00`);
                    }
                } else if (frequency === '12h') {
                    scheduledDates.push(dateStr + '_morning');
                    scheduledDates.push(dateStr + '_night');
                } else if (frequency === 'daily') {
                    scheduledDates.push(dateStr);
                } else if (frequency === '2xday') {
                    scheduledDates.push(dateStr + '_morning');
                    scheduledDates.push(dateStr + '_night');
                } else if (frequency === '3xday') {
                    scheduledDates.push(dateStr + '_morning');
                    scheduledDates.push(dateStr + '_noon');
                    scheduledDates.push(dateStr + '_night');
                } else if (frequency === '4xday') {
                    scheduledDates.push(dateStr + '_morning');
                    scheduledDates.push(dateStr + '_noon');
                    scheduledDates.push(dateStr + '_afternoon');
                    scheduledDates.push(dateStr + '_night');
                } else if (frequency === '24h') {
                    scheduledDates.push(dateStr);
                } else if (frequency === '48h') {
                    const daysSinceStart = Math.floor((date - new Date()) / (1000 * 60 * 60 * 24));
                    if (daysSinceStart % 2 === 0) {
                        scheduledDates.push(dateStr);
                    }
                } else if (frequency === '72h') {
                    const daysSinceStart = Math.floor((date - new Date()) / (1000 * 60 * 60 * 24));
                    if (daysSinceStart % 3 === 0) {
                        scheduledDates.push(dateStr);
                    }
                } else if (frequency === 'weekly') {
                    if (date.getDay() === 0) { // Domingo
                        scheduledDates.push(dateStr);
                    }
                } else if (frequency === 'biweekly') {
                    if (date.getDay() === 0 || date.getDay() === 3) { // Domingo e Quarta
                        scheduledDates.push(dateStr);
                    }
                } else if (frequency === 'monthly') {
                    if (date.getDate() === 1) { // Primeiro dia do m√™s
                        scheduledDates.push(dateStr);
                    }
                } else if (frequency === 'custom') {
                    const hoursSinceStart = Math.floor((date - new Date()) / (1000 * 60 * 60));
                    if (hoursSinceStart % customHours === 0) {
                        scheduledDates.push(dateStr);
                    }
                }
                
                // Adiciona hor√°rios personalizados se houver
                if (scheduleTimes && scheduleTimes.length > 0) {
                    scheduleTimes.forEach(time => {
                        scheduledDates.push(dateStr + `_${time}`);
                    });
                }
            }
            
            async updateTime() {
                try {
                    const response = await fetch('https://worldtimeapi.org/api/ip');
                    const data = await response.json();
                    
                    this.timezone = data.timezone;
                    const now = new Date(data.datetime);
                    
                    document.getElementById('local-time').textContent = 
                        now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                    
                    document.getElementById('current-date').textContent = 
                        now.toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    
                } catch (error) {
                    const now = new Date();
                    document.getElementById('local-time').textContent = 
                        now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                    document.getElementById('current-date').textContent = 
                        now.toLocaleDateString('pt-BR');
                }
            }
            
            updateUpcomingMedications() {
                const container = document.getElementById('upcoming-medications-list');
                const countElement = document.getElementById('next-medication-count');
                const overdueContainer = document.getElementById('overdue-medication-count');
                const overdueCountElement = document.getElementById('overdue-count');
                
                const upcoming = this.getUpcomingMedications();
                const overdueCount = upcoming.filter(m => m.isOverdue).length;
                
                container.innerHTML = '';
                
                if (upcoming.length === 0) {
                    container.innerHTML = '<p class="text-center" style="width: 100%;">Nenhuma medica√ß√£o pr√≥xima no momento.</p>';
                    countElement.textContent = 'Pr√≥ximas: 0';
                    overdueContainer.style.display = 'none';
                    return;
                }
                
                countElement.textContent = `Pr√≥ximas: ${upcoming.length - overdueCount}`;
                overdueCountElement.textContent = overdueCount;
                
                if (overdueCount > 0) {
                    overdueContainer.style.display = 'flex';
                } else {
                    overdueContainer.style.display = 'none';
                }
                
                upcoming.forEach(med => {
                    const item = document.createElement('div');
                    item.className = `upcoming-item ${med.urgent ? 'urgent' : ''} ${med.isOverdue ? 'overdue' : ''}`;
                    
                    const timeLeft = med.isOverdue ? 
                        `Atrasada: ${med.timeLeft}` : 
                        `Faltam: ${med.timeLeft}`;
                    
                    const progress = med.isOverdue ? 100 : this.calculateProgress(med.nextTime);
                    
                    item.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="font-size: 1.5rem;">${med.animalIcon}</div>
                                <div>
                                    <h4 style="margin: 0;">${med.medicationName}</h4>
                                    <p style="margin: 0; font-size: 0.9rem;">${med.animalName} - ${med.dosage}</p>
                                </div>
                            </div>
                            <div style="font-size: 1.2rem; color: ${med.isOverdue ? 'var(--warning)' : (med.urgent ? 'var(--danger)' : 'var(--primary)')}">
                                ${this.getTimeIcon(med.timeOfDay)}
                            </div>
                        </div>
                        
                        <div class="countdown-timer ${med.isOverdue ? 'overdue-timer' : ''}">${timeLeft}</div>
                        
                        <div style="font-size: 0.85rem; margin-bottom: 5px;">
                            Pr√≥xima: ${med.nextDateTime}
                        </div>
                        
                        <div class="progress-bar-container">
                            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 5px;">
                                <span>${med.isOverdue ? 'Atrasado' : 'Progresso'}</span>
                                <span>${progress.toFixed(2)}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%; background: ${med.isOverdue ? 'linear-gradient(90deg, var(--warning), var(--danger))' : 'linear-gradient(90deg, var(--secondary), var(--info))'}"></div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 10px; display: flex; gap: 5px;">
                            <button class="btn btn-mark btn-small" style="flex: 1;" onclick="vetSystem.markMedicationFromUpcoming('${med.animalId}', '${med.medicationId}', '${med.timeOfDay}', '${med.scheduledDate}')">
                                <i class="fas fa-check"></i> Marcar como Administrado
                                <span class="btn-tooltip">Marcar medicamento como administrado</span>
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(item);
                });
            }
            
            getTimeIcon(timeOfDay) {
                if (timeOfDay === 'morning') return '‚òÄÔ∏è';
                if (timeOfDay === 'noon') return 'üåû';
                if (timeOfDay === 'afternoon') return 'üå§Ô∏è';
                if (timeOfDay === 'night') return 'üåô';
                
                // Se for um hor√°rio espec√≠fico
                if (timeOfDay && timeOfDay.includes(':')) {
                    const hour = parseInt(timeOfDay.split(':')[0]);
                    if (hour >= 6 && hour < 12) return '‚òÄÔ∏è';
                    if (hour >= 12 && hour < 18) return 'üåû';
                    return 'üåô';
                }
                
                return '‚è∞';
            }
            
            getUpcomingMedications() {
                const upcoming = [];
                const now = new Date();
                const currentTime = now.getHours() * 60 + now.getMinutes();
                const today = this.getCurrentDate();
                
                // Verifica medica√ß√µes para hoje e amanh√£
                for (let dayOffset = 0; dayOffset < 2; dayOffset++) {
                    const date = new Date();
                    date.setDate(date.getDate() + dayOffset);
                    const dateStr = this.formatDate(date);
                    
                    Object.entries(this.animals).forEach(([animalId, animal]) => {
                        Object.entries(animal.medications).forEach(([medId, med]) => {
                            // Verifica se a medica√ß√£o est√° agendada para hoje/amanh√£
                            const isScheduled = med.scheduledDates.some(scheduledDate => {
                                if (scheduledDate.includes('_')) {
                                    return scheduledDate.startsWith(dateStr);
                                }
                                return scheduledDate === dateStr;
                            });
                            
                            if (!isScheduled) return;
                            
                            // Para cada hor√°rio
                            const times = [];
                            
                            if (med.schedule === 'morning' || med.schedule === 'both') {
                                times.push({ timeOfDay: 'morning', targetTime: 7 * 60 + 30, scheduledDate: dateStr + '_morning' });
                            }
                            
                            if (med.schedule === 'noon') {
                                times.push({ timeOfDay: 'noon', targetTime: 12 * 60, scheduledDate: dateStr + '_noon' });
                            }
                            
                            if (med.schedule === 'afternoon') {
                                times.push({ timeOfDay: 'afternoon', targetTime: 16 * 60, scheduledDate: dateStr + '_afternoon' });
                            }
                            
                            if (med.schedule === 'night' || med.schedule === 'both') {
                                times.push({ timeOfDay: 'night', targetTime: 19 * 60 + 30, scheduledDate: dateStr + '_night' });
                            }
                            
                            // Se for m√∫ltiplos hor√°rios
                            if (med.schedule === 'multiple' && med.scheduleTimes) {
                                med.scheduleTimes.forEach(time => {
                                    const [hour, minute] = time.split(':').map(Number);
                                    times.push({ 
                                        timeOfDay: time, 
                                        targetTime: hour * 60 + minute, 
                                        scheduledDate: dateStr + `_${time}` 
                                    });
                                });
                            }
                            
                            // Se for frequ√™ncias espec√≠ficas com hor√°rios
                            if (med.frequency === 'hourly' || 
                                med.frequency === '2h' || 
                                med.frequency === '3h' || 
                                med.frequency === '4h' || 
                                med.frequency === '6h' || 
                                med.frequency === '8h') {
                                
                                // Encontra todos os hor√°rios para este dia
                                med.scheduledDates.forEach(scheduledDate => {
                                    if (scheduledDate.startsWith(dateStr) && scheduledDate.includes('_')) {
                                        const timePart = scheduledDate.split('_')[1];
                                        const [hour, minute] = timePart.split(':').map(Number);
                                        times.push({ 
                                            timeOfDay: timePart, 
                                            targetTime: hour * 60 + minute, 
                                            scheduledDate: scheduledDate 
                                        });
                                    }
                                });
                            }
                            
                            times.forEach(({ timeOfDay, targetTime, scheduledDate }) => {
                                // Verifica se j√° foi administrada
                                const historyRecord = med.history.find(record => 
                                    record.date === scheduledDate
                                );
                                
                                if (historyRecord) return; // J√° administrada
                                
                                // Calcula o tempo at√© a medica√ß√£o
                                const targetDateTime = new Date(date);
                                targetDateTime.setHours(Math.floor(targetTime / 60), targetTime % 60, 0, 0);
                                
                                let timeUntil = targetDateTime - now;
                                let isOverdue = false;
                                
                                if (timeUntil < 0) {
                                    // J√° passou do hor√°rio -> atrasada
                                    isOverdue = true;
                                    timeUntil = Math.abs(timeUntil);
                                }
                                
                                // Converte para horas e minutos
                                const hoursUntil = Math.floor(timeUntil / (1000 * 60 * 60));
                                const minutesUntil = Math.floor((timeUntil % (1000 * 60 * 60)) / (1000 * 60));
                                
                                // S√≥ mostra se for hoje (atrasada ou dentro de 2 horas) ou amanh√£ (dentro de 24 horas)
                                const shouldShow = (dayOffset === 0 && (isOverdue || hoursUntil < 2)) || 
                                                 (dayOffset === 1 && hoursUntil < 24);
                                
                                if (shouldShow) {
                                    const timeLeft = isOverdue ? 
                                        `${hoursUntil}h ${minutesUntil}m atrasado` : 
                                        `${hoursUntil}h ${minutesUntil}m`;
                                    
                                    upcoming.push({
                                        animalId: animalId,
                                        animalName: animal.name,
                                        animalIcon: animal.icon,
                                        medicationId: medId,
                                        medicationName: med.name,
                                        dosage: med.dosage,
                                        timeOfDay: timeOfDay,
                                        date: dateStr,
                                        nextTime: `${Math.floor(targetTime / 60)}:${(targetTime % 60).toString().padStart(2, '0')}`,
                                        nextDateTime: `${dateStr} ${Math.floor(targetTime / 60)}:${(targetTime % 60).toString().padStart(2, '0')}`,
                                        isOverdue: isOverdue,
                                        urgent: !isOverdue && hoursUntil === 0 && minutesUntil < 30,
                                        timeLeft: timeLeft,
                                        scheduledDate: scheduledDate
                                    });
                                }
                            });
                        });
                    });
                }
                
                // Ordena: primeiro as atrasadas, depois as urgentes, depois as normais
                upcoming.sort((a, b) => {
                    if (a.isOverdue && !b.isOverdue) return -1;
                    if (!a.isOverdue && b.isOverdue) return 1;
                    if (a.urgent && !b.urgent) return -1;
                    if (!a.urgent && b.urgent) return 1;
                    return 0;
                });
                
                return upcoming.slice(0, 6); // Limita a 6
            }
            
            calculateProgress(nextTime) {
                const now = new Date();
                const [hours, minutes] = nextTime.split(':').map(Number);
                const targetTime = new Date(now);
                targetTime.setHours(hours, minutes, 0, 0);
                
                if (targetTime < now) {
                    targetTime.setDate(targetTime.getDate() + 1);
                }
                
                const twoHoursBefore = new Date(targetTime);
                twoHoursBefore.setHours(targetTime.getHours() - 2);
                
                if (now < twoHoursBefore) return 0;
                if (now > targetTime) return 100;
                
                const totalWindow = targetTime - twoHoursBefore;
                const elapsed = now - twoHoursBefore;
                return (elapsed / totalWindow) * 100;
            }
            
            markMedicationFromUpcoming(animalId, medicationId, timeOfDay, scheduledDate) {
                const animal = this.animals[animalId];
                const med = animal.medications[medicationId];
                
                // Adiciona ao hist√≥rico
                med.history.push({
                    date: scheduledDate,
                    timeOfDay: timeOfDay,
                    administered: true,
                    timestamp: new Date().toISOString()
                });
                
                this.saveToCache();
                this.renderAll();
                this.updateUpcomingMedications();
                showNotification(`${med.name} marcado como administrado!`);
            }
            
            startTimers() {
                // Atualiza a cada minuto
                setInterval(() => {
                    this.updateUpcomingMedications();
                }, 60000);
            }
            
            renderAll() {
                this.renderAnimalCards();
                this.renderCalendar();
                this.populateAnimalSelect();
                this.populateExportAnimalSelect();
                this.renderAnimalsManagementList();
            }
            
            renderAnimalCards() {
                const container = document.getElementById('animal-cards-container');
                container.innerHTML = '';
                
                if (Object.keys(this.animals).length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; background: var(--card-color); border-radius: 15px; border: 2px dashed var(--border-color);">
                            <h3 style="margin-bottom: 20px;">Nenhum animal cadastrado</h3>
                            <p style="margin-bottom: 20px;">Voc√™ pode adicionar animais manualmente ou carregar os dados dos seus gatos.</p>
                            <div class="controls">
                                <button class="btn btn-add" onclick="openTab(null, 'tab-animals')">
                                    <i class="fas fa-plus"></i> Adicionar Animal
                                    <span class="btn-tooltip">Abrir formul√°rio para adicionar novo animal</span>
                                </button>
                                <button class="btn btn-edit" onclick="vetSystem.loadDefaultData()">
                                    <i class="fas fa-cat"></i> Carregar Dados dos Gatos
                                    <span class="btn-tooltip">Carregar dados pr√©-definidos dos gatos</span>
                                </button>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                Object.values(this.animals).forEach(animal => {
                    const card = document.createElement('div');
                    card.className = 'animal-card';
                    
                    let medicationsHTML = '';
                    Object.values(animal.medications).forEach(med => {
                        const status = this.getMedicationStatus(animal.id, med.id);
                        const statusText = this.getStatusText(animal.id, med.id);
                        const isOverdue = this.isMedicationOverdue(animal.id, med.id);
                        
                        medicationsHTML += `
                            <div class="medication-item ${isOverdue ? 'medication-overdue' : ''}">
                                <div class="medication-info">
                                    <h4>${med.name}</h4>
                                    <div class="medication-details">${med.dosage} - ${this.getFrequencyText(med.frequency)}</div>
                                    ${isOverdue ? '<div class="medication-details" style="color: var(--warning);"><i class="fas fa-exclamation-triangle"></i> Atrasado</div>' : ''}
                                </div>
                                <div class="medication-actions">
                                    <div class="medication-status ${status} ${isOverdue ? 'status-overdue' : ''}">${statusText}</div>
                                    ${med.schedule === 'both' ? `
                                        <button class="btn btn-mark btn-small" onclick="vetSystem.toggleMedication('${animal.id}', '${med.id}', 'morning')">
                                            <i class="fas fa-sun"></i>
                                            <span class="btn-tooltip">Marcar medica√ß√£o da manh√£</span>
                                        </button>
                                        <button class="btn btn-mark btn-small" onclick="vetSystem.toggleMedication('${animal.id}', '${med.id}', 'night')">
                                            <i class="fas fa-moon"></i>
                                            <span class="btn-tooltip">Marcar medica√ß√£o da noite</span>
                                        </button>
                                    ` : med.schedule === 'multiple' ? `
                                        <button class="btn btn-mark btn-small" onclick="vetSystem.openMultipleScheduleModal('${animal.id}', '${med.id}')">
                                            <i class="fas fa-clock"></i>
                                            <span class="btn-tooltip">Marcar hor√°rios espec√≠ficos</span>
                                        </button>
                                    ` : `
                                        <button class="btn btn-mark btn-small" onclick="vetSystem.toggleMedication('${animal.id}', '${med.id}', '${med.schedule}')">
                                            <i class="fas fa-check"></i>
                                            <span class="btn-tooltip">Marcar medica√ß√£o como administrada</span>
                                        </button>
                                    `}
                                    <button class="btn btn-unmark btn-small" onclick="vetSystem.unmarkMedication('${animal.id}', '${med.id}')">
                                        <i class="fas fa-undo"></i>
                                        <span class="btn-tooltip">Desmarcar medica√ß√£o</span>
                                    </button>
                                    <button class="btn btn-edit btn-small" onclick="vetSystem.editMedication('${animal.id}', '${med.id}')">
                                        <i class="fas fa-edit"></i>
                                        <span class="btn-tooltip">Editar medicamento</span>
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    card.innerHTML = `
                        <div class="animal-header">
                            <div class="animal-icon">${animal.icon}</div>
                            <div>
                                <div class="animal-name">${animal.name}</div>
                                <span class="animal-weight">${animal.weight}</span>
                                <div style="font-size: 0.8rem; margin-top: 5px; color: var(--text-color); opacity: 0.7;">
                                    ${animal.breed || 'N√£o informada'} ‚Ä¢ ${this.getAnimalTypeText(animal.type)}
                                </div>
                            </div>
                            <div style="margin-left: auto;">
                                <button class="btn btn-edit btn-small" onclick="vetSystem.editAnimal('${animal.id}')">
                                    <i class="fas fa-edit"></i>
                                    <span class="btn-tooltip">Editar dados do animal</span>
                                </button>
                                <button class="btn btn-pdf btn-small" onclick="vetSystem.exportAnimalPDF('${animal.id}')">
                                    <i class="fas fa-file-pdf"></i>
                                    <span class="btn-tooltip">Exportar medicamentos do animal em PDF</span>
                                </button>
                            </div>
                        </div>
                        <div class="medication-list">
                            ${medicationsHTML || '<p style="text-align: center; color: var(--text-color); opacity: 0.7;">Nenhum medicamento cadastrado</p>'}
                        </div>
                        <div class="controls">
                            <button class="btn btn-add btn-small" onclick="vetSystem.openAddMedicationModal('${animal.id}')">
                                <i class="fas fa-plus"></i> Adicionar Medicamento
                                <span class="btn-tooltip">Adicionar novo medicamento para este animal</span>
                            </button>
                            <button class="btn btn-mark" onclick="vetSystem.markAll('${animal.id}', 'morning')">
                                <i class="fas fa-sun"></i> Marcar Manh√£
                                <span class="btn-tooltip">Marcar todos os medicamentos da manh√£ como administrados</span>
                            </button>
                            <button class="btn btn-mark" onclick="vetSystem.markAll('${animal.id}', 'night')">
                                <i class="fas fa-moon"></i> Marcar Noite
                                <span class="btn-tooltip">Marcar todos os medicamentos da noite como administrados</span>
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(card);
                });
            }
            
            getAnimalTypeText(type) {
                const types = {
                    'cat': 'Gato',
                    'dog': 'Cachorro',
                    'rabbit': 'Coelho',
                    'hamster': 'Hamster',
                    'bird': 'P√°ssaro',
                    'turtle': 'Tartaruga',
                    'other': 'Outro'
                };
                return types[type] || type;
            }
            
            openAddMedicationModal(animalId) {
                document.getElementById('med-animal-select').value = animalId;
                openTab(null, 'tab-medications');
                document.getElementById('new-med-name').focus();
            }
            
            openMultipleScheduleModal(animalId, medicationId) {
                const animal = this.animals[animalId];
                const med = animal.medications[medicationId];
                const today = this.getCurrentDate();
                
                // Encontra todos os hor√°rios para hoje
                const todaySchedules = med.scheduledDates.filter(date => date.startsWith(today));
                
                if (todaySchedules.length === 0) {
                    showNotification('Nenhum hor√°rio agendado para hoje!', 'warning');
                    return;
                }
                
                // Cria modal para selecionar hor√°rios
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'flex';
                
                const content = document.createElement('div');
                content.className = 'modal-content';
                
                const header = document.createElement('div');
                header.className = 'modal-header';
                header.innerHTML = `
                    <h3>Marcar Hor√°rios - ${med.name}</h3>
                    <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
                `;
                
                const body = document.createElement('div');
                body.innerHTML = '<h4>Selecione os hor√°rios a marcar como administrados:</h4>';
                
                const schedulesList = document.createElement('div');
                schedulesList.style.maxHeight = '300px';
                schedulesList.style.overflowY = 'auto';
                
                todaySchedules.forEach(schedule => {
                    const timeOfDay = schedule.includes('_') ? schedule.split('_')[1] : schedule;
                    const historyRecord = med.history.find(record => record.date === schedule);
                    
                    const item = document.createElement('div');
                    item.className = 'form-group';
                    item.innerHTML = `
                        <label>
                            <input type="checkbox" value="${schedule}" ${historyRecord ? 'checked disabled' : ''} 
                                   onchange="this.disabled = this.checked">
                            ${this.formatScheduleTime(timeOfDay)}
                        </label>
                    `;
                    schedulesList.appendChild(item);
                });
                
                body.appendChild(schedulesList);
                
                const actions = document.createElement('div');
                actions.className = 'modal-actions';
                actions.innerHTML = `
                    <button class="btn btn-add" onclick="vetSystem.markMultipleSchedules('${animalId}', '${medicationId}')">
                        <i class="fas fa-check"></i> Marcar Selecionados
                        <span class="btn-tooltip">Marcar hor√°rios selecionados como administrados</span>
                    </button>
                    <button class="btn btn-edit" onclick="this.closest('.modal').remove()">
                        <i class="fas fa-times"></i> Cancelar
                        <span class="btn-tooltip">Cancelar opera√ß√£o</span>
                    </button>
                `;
                
                content.appendChild(header);
                content.appendChild(body);
                content.appendChild(actions);
                modal.appendChild(content);
                
                document.body.appendChild(modal);
            }
            
            formatScheduleTime(timeOfDay) {
                if (timeOfDay === 'morning') return 'Manh√£ (07:30-08:00)';
                if (timeOfDay === 'noon') return 'Meio-dia (12:00-12:30)';
                if (timeOfDay === 'afternoon') return 'Tarde (16:00-16:30)';
                if (timeOfDay === 'night') return 'Noite (19:30-21:00)';
                
                // Se for um hor√°rio espec√≠fico
                if (timeOfDay && timeOfDay.includes(':')) {
                    return timeOfDay;
                }
                
                return timeOfDay;
            }
            
            markMultipleSchedules(animalId, medicationId) {
                const animal = this.animals[animalId];
                const med = animal.medications[medicationId];
                const today = this.getCurrentDate();
                
                // Encontra todos os checkboxes marcados
                const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
                let count = 0;
                
                checkboxes.forEach(checkbox => {
                    const scheduledDate = checkbox.value;
                    
                    // Verifica se j√° n√£o est√° no hist√≥rico
                    const existingRecord = med.history.find(record => record.date === scheduledDate);
                    if (!existingRecord) {
                        // Adiciona ao hist√≥rico
                        const timeOfDay = scheduledDate.includes('_') ? scheduledDate.split('_')[1] : scheduledDate;
                        
                        med.history.push({
                            date: scheduledDate,
                            timeOfDay: timeOfDay,
                            administered: true,
                            timestamp: new Date().toISOString()
                        });
                        
                        count++;
                    }
                });
                
                this.saveToCache();
                this.renderAll();
                this.updateUpcomingMedications();
                
                // Fecha o modal
                document.querySelector('.modal').remove();
                
                showNotification(`${count} hor√°rio(s) marcado(s) como administrado(s)!`);
            }
            
            renderAnimalsManagementList() {
                const container = document.getElementById('animals-management-list');
                container.innerHTML = '';
                
                Object.values(this.animals).forEach(animal => {
                    const item = document.createElement('div');
                    item.className = 'animal-manage-item';
                    
                    item.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 1.5rem;">${animal.icon}</div>
                            <div>
                                <div>${animal.name}</div>
                                <div style="font-size: 0.85rem; color: var(--text-color); opacity: 0.7;">${animal.weight} ‚Ä¢ ${Object.keys(animal.medications).length} medicamentos</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn btn-edit btn-small" onclick="vetSystem.editAnimal('${animal.id}')">
                                <i class="fas fa-edit"></i>
                                <span class="btn-tooltip">Editar dados do animal</span>
                            </button>
                            <button class="btn btn-danger btn-small" onclick="vetSystem.deleteAnimal('${animal.id}')">
                                <i class="fas fa-trash"></i>
                                <span class="btn-tooltip">Excluir animal</span>
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(item);
                });
            }
            
            renderPreloadedMedications() {
                const container = document.getElementById('preloaded-medications-list');
                container.innerHTML = '';
                
                const medications = [
                    { name: 'Vetmax Plus', dosage: '¬Ω comprimido', frequency: 'daily', schedule: 'morning', duration: 3 },
                    { name: 'Omegablue Esqualeno', dosage: '1 c√°psula', frequency: '48h', schedule: 'night', duration: null },
                    { name: 'Petsporin 75 mg', dosage: '¬Ω comprimido', frequency: '12h', schedule: 'both', duration: 7 },
                    { name: 'Mellis Vet 0,5 mg', dosage: '1 comprimido', frequency: 'daily', schedule: 'morning', duration: 5 },
                    { name: 'Hemocare', dosage: '0,4 ml', frequency: 'daily', schedule: 'morning', duration: 30 },
                    { name: 'Promun Cat Pasta', dosage: '2 ml', frequency: 'daily', schedule: 'morning', duration: null },
                    { name: 'Dipirona gotas', dosage: '3 gotas', frequency: '12h', schedule: 'both', duration: 5 },
                    { name: 'Vetagl√≥s pomada', dosage: 'Aplica√ß√£o t√≥pica', frequency: '12h', schedule: 'both', duration: null }
                ];
                
                medications.forEach(med => {
                    const item = document.createElement('div');
                    item.className = 'medication-item';
                    item.style.cursor = 'pointer';
                    item.onclick = () => {
                        const animalId = document.getElementById('med-animal-select').value;
                        if (animalId) {
                            this.addPreloadedMedication(animalId, med.name, med.dosage, med.frequency, med.schedule, med.duration);
                        } else {
                            showNotification('Selecione um animal primeiro!', 'warning');
                        }
                    };
                    
                    item.innerHTML = `
                        <div class="medication-info">
                            <h4>${med.name}</h4>
                            <div class="medication-details">${med.dosage} - ${this.getFrequencyText(med.frequency)}</div>
                            <div class="medication-details">${this.getScheduleText(med.schedule)}${med.duration ? ` - ${med.duration} dias` : ' - Cont√≠nuo'}</div>
                        </div>
                        <div class="medication-actions">
                            <button class="btn btn-add btn-small" title="Adicionar ao animal selecionado">
                                <i class="fas fa-plus"></i> Adicionar
                                <span class="btn-tooltip">Adicionar medicamento ao animal selecionado</span>
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(item);
                });
            }
            
            getScheduleText(schedule) {
                const schedules = {
                    'morning': 'Manh√£',
                    'noon': 'Meio-dia',
                    'afternoon': 'Tarde',
                    'night': 'Noite',
                    'both': 'Manh√£ e Noite',
                    'multiple': 'M√∫ltiplos Hor√°rios'
                };
                return schedules[schedule] || schedule;
            }
            
            getFrequencyText(frequency) {
                const texts = {
                    'hourly': 'A cada hora',
                    '2h': 'A cada 2 horas',
                    '3h': 'A cada 3 horas',
                    '4h': 'A cada 4 horas',
                    '6h': 'A cada 6 horas',
                    '8h': 'A cada 8 horas',
                    '12h': '12/12h',
                    'daily': '1x ao dia',
                    '2xday': '2x ao dia',
                    '3xday': '3x ao dia',
                    '4xday': '4x ao dia',
                    '24h': 'A cada 24 horas',
                    '48h': 'A cada 48h',
                    '72h': 'A cada 72h',
                    'weekly': '1x por semana',
                    'biweekly': '2x por semana',
                    'monthly': '1x por m√™s',
                    'custom': 'Personalizado'
                };
                return texts[frequency] || frequency;
            }
            
            getMedicationStatus(animalId, medId) {
                const animal = this.animals[animalId];
                const med = animal.medications[medId];
                const today = this.getCurrentDate();
                const todayRecords = med.history.filter(record => 
                    record.date.startsWith(today)
                );
                
                if (med.schedule === 'both') {
                    const morningDone = todayRecords.some(r => r.timeOfDay === 'morning');
                    const nightDone = todayRecords.some(r => r.timeOfDay === 'night');
                    if (morningDone && nightDone) return 'status-done';
                    if (morningDone || nightDone) return 'status-upcoming';
                } else if (med.schedule === 'multiple') {
                    // Para m√∫ltiplos hor√°rios, verifica se todos foram marcados
                    const todaySchedules = med.scheduledDates.filter(date => date.startsWith(today));
                    const markedCount = todayRecords.length;
                    
                    if (markedCount === todaySchedules.length) return 'status-done';
                    if (markedCount > 0) return 'status-upcoming';
                } else if (todayRecords.length > 0) {
                    return 'status-done';
                }
                return 'status-pending';
            }
            
            getStatusText(animalId, medId) {
                const animal = this.animals[animalId];
                const med = animal.medications[medId];
                const today = this.getCurrentDate();
                const todayRecords = med.history.filter(record => 
                    record.date.startsWith(today)
                );
                
                if (med.schedule === 'both') {
                    const morningDone = todayRecords.some(r => r.timeOfDay === 'morning');
                    const nightDone = todayRecords.some(r => r.timeOfDay === 'night');
                    if (morningDone && nightDone) return 'Completo';
                    if (morningDone) return 'Manh√£ OK';
                    if (nightDone) return 'Noite OK';
                } else if (med.schedule === 'multiple') {
                    // Para m√∫ltiplos hor√°rios, mostra quantos foram marcados
                    const todaySchedules = med.scheduledDates.filter(date => date.startsWith(today));
                    const markedCount = todayRecords.length;
                    
                    if (markedCount === todaySchedules.length) return 'Completo';
                    return `${markedCount}/${todaySchedules.length} marcados`;
                } else if (todayRecords.length > 0) {
                    return 'Administrado';
                }
                return 'Pendente';
            }
            
            isMedicationOverdue(animalId, medId) {
                const animal = this.animals[animalId];
                const med = animal.medications[medId];
                const now = new Date();
                const currentTime = now.getHours() * 60 + now.getMinutes();
                const today = this.getCurrentDate();
                
                // Hor√°rios de medica√ß√£o
                const morningDeadline = 8 * 60; // 08:00
                const noonDeadline = 12 * 60 + 30; // 12:30
                const afternoonDeadline = 16 * 60 + 30; // 16:30
                const nightDeadline = 21 * 60; // 21:00
                
                // Verifica se h√° registros para hoje
                const todayRecords = med.history.filter(record => 
                    record.date.startsWith(today)
                );
                
                // Para medicamentos da manh√£
                if ((med.schedule === 'morning' || med.schedule === 'both') && currentTime > morningDeadline) {
                    const morningDone = todayRecords.some(r => r.timeOfDay === 'morning');
                    if (!morningDone) return true;
                }
                
                // Para medicamentos do meio-dia
                if (med.schedule === 'noon' && currentTime > noonDeadline) {
                    const noonDone = todayRecords.some(r => r.timeOfDay === 'noon');
                    if (!noonDone) return true;
                }
                
                // Para medicamentos da tarde
                if (med.schedule === 'afternoon' && currentTime > afternoonDeadline) {
                    const afternoonDone = todayRecords.some(r => r.timeOfDay === 'afternoon');
                    if (!afternoonDone) return true;
                }
                
                // Para medicamentos da noite (s√≥ verifica se j√° passou das 21h)
                if ((med.schedule === 'night' || med.schedule === 'both') && currentTime > nightDeadline) {
                    const nightDone = todayRecords.some(r => r.timeOfDay === 'night');
                    if (!nightDone) return true;
                }
                
                // Para m√∫ltiplos hor√°rios
                if (med.schedule === 'multiple') {
                    const todaySchedules = med.scheduledDates.filter(date => date.startsWith(today));
                    
                    for (const schedule of todaySchedules) {
                        const timeOfDay = schedule.includes('_') ? schedule.split('_')[1] : schedule;
                        
                        // Verifica se j√° passou do hor√°rio
                        let deadline;
                        if (timeOfDay.includes(':')) {
                            const [hour, minute] = timeOfDay.split(':').map(Number);
                            deadline = hour * 60 + minute;
                        } else {
                            // Usa os hor√°rios padr√£o
                            if (timeOfDay === 'morning') deadline = morningDeadline;
                            else if (timeOfDay === 'noon') deadline = noonDeadline;
                            else if (timeOfDay === 'afternoon') deadline = afternoonDeadline;
                            else if (timeOfDay === 'night') deadline = nightDeadline;
                        }
                        
                        if (currentTime > deadline) {
                            const done = todayRecords.some(r => r.date === schedule);
                            if (!done) return true;
                        }
                    }
                }
                
                return false;
            }
            
            toggleMedication(animalId, medId, timeOfDay) {
                const animal = this.animals[animalId];
                const med = animal.medications[medId];
                const today = this.getCurrentDate();
                const recordKey = med.schedule === 'both' ? `${today}_${timeOfDay}` : today;
                
                const existingIndex = med.history.findIndex(record => 
                    record.date === recordKey
                );
                
                if (existingIndex > -1) {
                    med.history.splice(existingIndex, 1);
                    showNotification(`${med.name} desmarcado!`, 'info');
                } else {
                    med.history.push({
                        date: recordKey,
                        timeOfDay: timeOfDay,
                        administered: true,
                        timestamp: new Date().toISOString()
                    });
                    showNotification(`${med.name} marcado como administrado!`);
                }
                
                this.saveToCache();
                this.renderAll();
                this.updateUpcomingMedications();
            }
            
            unmarkMedication(animalId, medId) {
                const animal = this.animals[animalId];
                const med = animal.medications[medId];
                const today = this.getCurrentDate();
                
                med.history = med.history.filter(record => 
                    !record.date.startsWith(today)
                );
                
                this.saveToCache();
                this.renderAll();
                this.updateUpcomingMedications();
                showNotification(`${med.name} desmarcado!`, 'info');
            }
            
            markAll(animalId, timeOfDay) {
                const animal = this.animals[animalId];
                const today = this.getCurrentDate();
                let count = 0;
                
                Object.keys(animal.medications).forEach(medId => {
                    const med = animal.medications[medId];
                    
                    if (med.schedule === timeOfDay || med.schedule === 'both' || 
                        (timeOfDay === 'morning' && med.schedule === 'morning') ||
                        (timeOfDay === 'night' && med.schedule === 'night')) {
                        
                        const recordKey = med.schedule === 'both' ? 
                            `${today}_${timeOfDay}` : today;
                        
                        // Remove registro existente se houver
                        med.history = med.history.filter(record => 
                            record.date !== recordKey
                        );
                        
                        // Adiciona novo registro
                        med.history.push({
                            date: recordKey,
                            timeOfDay: timeOfDay,
                            administered: true,
                            timestamp: new Date().toISOString()
                        });
                        
                        count++;
                    }
                });
                
                this.saveToCache();
                this.renderAll();
                this.updateUpcomingMedications();
                showNotification(`${count} medica√ß√£o(√µes) de ${timeOfDay === 'morning' ? 'manh√£' : 'noite'} marcadas!`);
            }
            
            renderCalendar() {
                this.renderCalendarHeaders();
                this.renderCalendarDays();
            }
            
            renderCalendarHeaders() {
                const headerContainer = document.getElementById('calendar-days-header');
                headerContainer.innerHTML = '';
                const weekdays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
                weekdays.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'calendar-day-header';
                    dayHeader.textContent = day;
                    headerContainer.appendChild(dayHeader);
                });
            }
            
            renderCalendarDays() {
                const daysContainer = document.getElementById('calendar-days');
                daysContainer.innerHTML = '';
                
                const firstDay = new Date(this.calendarYear, this.calendarMonth, 1);
                const lastDay = new Date(this.calendarYear, this.calendarMonth + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDay = firstDay.getDay();
                
                // Dias em branco no in√≠cio
                for (let i = 0; i < startingDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day';
                    daysContainer.appendChild(emptyDay);
                }
                
                // Dias do m√™s
                const today = new Date();
                const isCurrentMonth = today.getMonth() === this.calendarMonth && 
                                      today.getFullYear() === this.calendarYear;
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    
                    if (isCurrentMonth && day === today.getDate()) {
                        dayElement.classList.add('today');
                    }
                    
                    const dateStr = `${this.calendarYear}-${String(this.calendarMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    dayElement.setAttribute('data-date', dateStr);
                    dayElement.onclick = () => this.openDayModal(dateStr);
                    
                    const dayNumber = document.createElement('div');
                    dayNumber.className = 'day-number';
                    dayNumber.innerHTML = `
                        <span>${day}</span>
                        <button class="day-pdf-btn" onclick="event.stopPropagation(); vetSystem.exportDayToPDF('${dateStr}')" title="Exportar PDF do dia">
                            <i class="fas fa-file-pdf"></i>
                        </button>
                    `;
                    dayElement.appendChild(dayNumber);
                    
                    // Adiciona medica√ß√µes deste dia
                    this.addMedicationsToDay(dayElement, dateStr);
                    
                    daysContainer.appendChild(dayElement);
                }
                
                // Atualiza t√≠tulo do m√™s
                const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                                  'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                document.getElementById('current-month').textContent = 
                    `${monthNames[this.calendarMonth]} ${this.calendarYear}`;
            }
            
            addMedicationsToDay(dayElement, dateStr) {
                const dayMedications = [];
                const now = new Date();
                const today = this.getCurrentDate();
                const isToday = dateStr === today;
                const currentTime = now.getHours() * 60 + now.getMinutes();
                
                Object.values(this.animals).forEach(animal => {
                    Object.values(animal.medications).forEach(med => {
                        const isScheduled = med.scheduledDates.some(scheduledDate => {
                            if (scheduledDate.includes('_')) {
                                return scheduledDate.startsWith(dateStr);
                            }
                            return scheduledDate === dateStr;
                        });
                        
                        if (isScheduled) {
                            const historyRecord = med.history.find(record => 
                                record.date.startsWith(dateStr)
                            );
                            
                            // Se for m√∫ltiplos hor√°rios, processa cada um
                            if (med.schedule === 'multiple') {
                                const todaySchedules = med.scheduledDates.filter(date => date.startsWith(dateStr));
                                
                                todaySchedules.forEach(schedule => {
                                    const timeOfDay = schedule.includes('_') ? schedule.split('_')[1] : schedule;
                                    
                                    let isOverdue = false;
                                    if (isToday && timeOfDay.includes(':')) {
                                        const [hour, minute] = timeOfDay.split(':').map(Number);
                                        const deadline = hour * 60 + minute;
                                        if (currentTime > deadline) {
                                            const done = historyRecord && historyRecord.date === schedule;
                                            if (!done) isOverdue = true;
                                        }
                                    } else if (isToday) {
                                        // Usa os hor√°rios padr√£o
                                        let deadline;
                                        if (timeOfDay === 'morning') deadline = 8 * 60;
                                        else if (timeOfDay === 'noon') deadline = 12 * 60 + 30;
                                        else if (timeOfDay === 'afternoon') deadline = 16 * 60 + 30;
                                        else if (timeOfDay === 'night') deadline = 21 * 60;
                                        
                                        if (currentTime > deadline) {
                                            const done = historyRecord && historyRecord.timeOfDay === timeOfDay;
                                            if (!done) isOverdue = true;
                                        }
                                    }
                                    
                                    dayMedications.push({
                                        animal: animal.name,
                                        animalIcon: animal.icon,
                                        medication: med.name,
                                        dosage: med.dosage,
                                        timeOfDay: timeOfDay,
                                        administered: historyRecord && historyRecord.date === schedule,
                                        overdue: isOverdue
                                    });
                                });
                            } else if (med.schedule === 'both') {
                                // Manh√£
                                let isOverdueMorning = false;
                                if (isToday && currentTime > 8 * 60) {
                                    const morningDone = historyRecord && historyRecord.timeOfDay === 'morning';
                                    if (!morningDone) isOverdueMorning = true;
                                }
                                
                                dayMedications.push({
                                    animal: animal.name,
                                    animalIcon: animal.icon,
                                    medication: med.name,
                                    dosage: med.dosage,
                                    timeOfDay: 'morning',
                                    administered: historyRecord && historyRecord.timeOfDay === 'morning',
                                    overdue: isOverdueMorning
                                });
                                
                                // Noite
                                let isOverdueNight = false;
                                if (isToday && currentTime > 21 * 60) {
                                    const nightDone = historyRecord && historyRecord.timeOfDay === 'night';
                                    if (!nightDone) isOverdueNight = true;
                                }
                                
                                dayMedications.push({
                                    animal: animal.name,
                                    animalIcon: animal.icon,
                                    medication: med.name,
                                    dosage: med.dosage,
                                    timeOfDay: 'night',
                                    administered: historyRecord && historyRecord.timeOfDay === 'night',
                                    overdue: isOverdueNight
                                });
                            } else {
                                let isOverdue = false;
                                if (isToday) {
                                    let deadline;
                                    if (med.schedule === 'morning') deadline = 8 * 60;
                                    else if (med.schedule === 'noon') deadline = 12 * 60 + 30;
                                    else if (med.schedule === 'afternoon') deadline = 16 * 60 + 30;
                                    else if (med.schedule === 'night') deadline = 21 * 60;
                                    
                                    if (currentTime > deadline && !historyRecord) {
                                        isOverdue = true;
                                    }
                                }
                                
                                dayMedications.push({
                                    animal: animal.name,
                                    animalIcon: animal.icon,
                                    medication: med.name,
                                    dosage: med.dosage,
                                    timeOfDay: med.schedule,
                                    administered: !!historyRecord,
                                    overdue: isOverdue
                                });
                            }
                        }
                    });
                });
                
                // Agrupa por animal
                const groupedByAnimal = {};
                dayMedications.forEach(med => {
                    if (!groupedByAnimal[med.animal]) {
                        groupedByAnimal[med.animal] = [];
                    }
                    groupedByAnimal[med.animal].push(med);
                });
                
                // Adiciona ao calend√°rio (m√°ximo 4 medica√ß√µes por dia)
                let medCount = 0;
                for (const animalName in groupedByAnimal) {
                    if (medCount >= 4) break;
                    
                    const animalMeds = groupedByAnimal[animalName];
                    const animalIcon = animalMeds[0].animalIcon;
                    
                    animalMeds.forEach(med => {
                        if (medCount >= 4) return;
                        
                        const medElement = document.createElement('div');
                        const className = med.overdue ? 'calendar-medication medication-overdue' : 
                                          `calendar-medication medication-${med.timeOfDay}`;
                        medElement.className = className;
                        
                        // Tooltip com informa√ß√µes detalhadas
                        const timeText = this.formatScheduleTime(med.timeOfDay);
                        const statusText = med.administered ? '‚úÖ Administrado' : 
                                         med.overdue ? '‚ö†Ô∏è Atrasado' : '‚è∞ Pendente';
                        medElement.setAttribute('data-tooltip', 
                            `${animalIcon} ${animalName}\nüíä ${med.medication}\nüìã ${med.dosage}\n‚è∞ ${timeText}\n${statusText}`);
                        
                        const statusIcon = med.administered ? '‚úÖ' : (med.overdue ? '‚ö†Ô∏è' : '‚è∞');
                        medElement.textContent = `${animalIcon} ${statusIcon} ${med.medication.substring(0, 10)}`;
                        
                        dayElement.appendChild(medElement);
                        medCount++;
                    });
                }
                
                // Se houver mais medica√ß√µes, mostra indicador
                if (dayMedications.length > 4) {
                    const moreElement = document.createElement('div');
                    moreElement.className = 'calendar-medication';
                    moreElement.textContent = `+${dayMedications.length - 4} mais`;
                    moreElement.style.fontSize = '0.6rem';
                    moreElement.style.opacity = '0.7';
                    dayElement.appendChild(moreElement);
                }
            }
            
            openDayModal(dateStr) {
                this.selectedDay = dateStr;
                const modal = document.getElementById('dayModal');
                const date = new Date(dateStr);
                document.getElementById('modalDayTitle').textContent = 
                    `Medica√ß√µes para ${date.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}`;
                
                const dayMedications = [];
                Object.values(this.animals).forEach(animal => {
                    Object.values(animal.medications).forEach(med => {
                        const isScheduled = med.scheduledDates.some(scheduledDate => {
                            if (scheduledDate.includes('_')) {
                                return scheduledDate.startsWith(dateStr);
                            }
                            return scheduledDate === dateStr;
                        });
                        
                        if (isScheduled) {
                            const historyRecord = med.history.find(record => 
                                record.date.startsWith(dateStr)
                            );
                            
                            // Se for m√∫ltiplos hor√°rios, processa cada um
                            if (med.schedule === 'multiple') {
                                const todaySchedules = med.scheduledDates.filter(date => date.startsWith(dateStr));
                                
                                todaySchedules.forEach(schedule => {
                                    const timeOfDay = schedule.includes('_') ? schedule.split('_')[1] : schedule;
                                    
                                    dayMedications.push({
                                        animalId: animal.id,
                                        animal: animal.name,
                                        animalIcon: animal.icon,
                                        medication: med.name,
                                        medicationId: med.id,
                                        dosage: med.dosage,
                                        frequency: med.frequency,
                                        timeOfDay: timeOfDay,
                                        administered: historyRecord && historyRecord.date === schedule,
                                        history: med.history.filter(record => record.date === schedule),
                                        scheduledDate: schedule
                                    });
                                });
                            } else if (med.schedule === 'both') {
                                // Manh√£
                                dayMedications.push({
                                    animalId: animal.id,
                                    animal: animal.name,
                                    animalIcon: animal.icon,
                                    medication: med.name,
                                    medicationId: med.id,
                                    dosage: med.dosage,
                                    frequency: med.frequency,
                                    timeOfDay: 'morning',
                                    administered: historyRecord && historyRecord.timeOfDay === 'morning',
                                    history: med.history.filter(record => record.timeOfDay === 'morning'),
                                    scheduledDate: dateStr + '_morning'
                                });
                                
                                // Noite
                                dayMedications.push({
                                    animalId: animal.id,
                                    animal: animal.name,
                                    animalIcon: animal.icon,
                                    medication: med.name,
                                    medicationId: med.id,
                                    dosage: med.dosage,
                                    frequency: med.frequency,
                                    timeOfDay: 'night',
                                    administered: historyRecord && historyRecord.timeOfDay === 'night',
                                    history: med.history.filter(record => record.timeOfDay === 'night'),
                                    scheduledDate: dateStr + '_night'
                                });
                            } else {
                                dayMedications.push({
                                    animalId: animal.id,
                                    animal: animal.name,
                                    animalIcon: animal.icon,
                                    medication: med.name,
                                    medicationId: med.id,
                                    dosage: med.dosage,
                                    frequency: med.frequency,
                                    timeOfDay: med.schedule,
                                    administered: !!historyRecord,
                                    history: med.history.filter(record => record.date.startsWith(dateStr)),
                                    scheduledDate: dateStr
                                });
                            }
                        }
                    });
                });
                
                const modalContent = document.getElementById('modalDayContent');
                modalContent.innerHTML = '';
                
                if (dayMedications.length === 0) {
                    modalContent.innerHTML = '<p class="text-center">Nenhuma medica√ß√£o agendada para este dia.</p>';
                } else {
                    // Tabela para mostrar medicamentos
                    const table = document.createElement('table');
                    table.style.width = '100%';
                    table.style.borderCollapse = 'collapse';
                    table.innerHTML = `
                        <thead>
                            <tr style="background: var(--light);">
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--border-color);">Animal</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--border-color);">Medica√ß√£o</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--border-color);">Dosagem</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--border-color);">Hor√°rio</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--border-color);">Status</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--border-color);">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="modalDayTableBody">
                        </tbody>
                    `;
                    modalContent.appendChild(table);
                    
                    const tbody = document.getElementById('modalDayTableBody');
                    
                    dayMedications.forEach(med => {
                        const row = document.createElement('tr');
                        row.style.borderBottom = '1px solid var(--border-color)';
                        
                        let actionsHTML = '';
                        if (med.schedule === 'both') {
                            const morningDone = med.history.some(h => h.timeOfDay === 'morning');
                            const nightDone = med.history.some(h => h.timeOfDay === 'night');
                            
                            actionsHTML = `
                                <button class="btn btn-mark btn-small" onclick="vetSystem.toggleMedicationFromModal('${dateStr}', '${med.animalId}', '${med.medicationId}', 'morning')" ${morningDone ? 'disabled' : ''}>
                                    <i class="fas fa-sun"></i> Manh√£
                                    <span class="btn-tooltip">Marcar medica√ß√£o da manh√£</span>
                                </button>
                                <button class="btn btn-mark btn-small" onclick="vetSystem.toggleMedicationFromModal('${dateStr}', '${med.animalId}', '${med.medicationId}', 'night')" ${nightDone ? 'disabled' : ''}>
                                    <i class="fas fa-moon"></i> Noite
                                    <span class="btn-tooltip">Marcar medica√ß√£o da noite</span>
                                </button>
                            `;
                        } else {
                            actionsHTML = `
                                <button class="btn btn-mark btn-small" onclick="vetSystem.toggleMedicationFromModal('${dateStr}', '${med.animalId}', '${med.medicationId}', '${med.timeOfDay}')" ${med.administered ? 'disabled' : ''}>
                                    <i class="fas fa-check"></i> Marcar
                                    <span class="btn-tooltip">Marcar medica√ß√£o como administrada</span>
                                </button>
                            `;
                        }
                        
                        row.innerHTML = `
                            <td style="padding: 10px;">${med.animalIcon} ${med.animal}</td>
                            <td style="padding: 10px;">${med.medication}</td>
                            <td style="padding: 10px;">${med.dosage}</td>
                            <td style="padding: 10px;">${this.formatScheduleTime(med.timeOfDay)}</td>
                            <td style="padding: 10px;">
                                <span class="medication-status ${med.administered ? 'status-done' : 'status-pending'}">
                                    ${med.administered ? 'Administrado' : 'Pendente'}
                                </span>
                            </td>
                            <td style="padding: 10px;">
                                <div style="display: flex; gap: 5px;">
                                    ${actionsHTML}
                                </div>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                }
                
                modal.style.display = 'flex';
            }
            
            toggleMedicationFromModal(dateStr, animalId, medicationId, timeOfDay) {
                const animal = this.animals[animalId];
                const med = animal.medications[medicationId];
                
                // Determina a chave do registro
                let recordKey;
                if (med.schedule === 'both') {
                    recordKey = `${dateStr}_${timeOfDay}`;
                } else if (med.schedule === 'multiple') {
                    // Para m√∫ltiplos hor√°rios, usa a data completa
                    recordKey = dateStr + (timeOfDay.includes(':') ? `_${timeOfDay}` : `_${timeOfDay}`);
                } else {
                    recordKey = dateStr;
                }
                
                const existingIndex = med.history.findIndex(record => 
                    record.date === recordKey
                );
                
                if (existingIndex > -1) {
                    med.history.splice(existingIndex, 1);
                    showNotification(`${med.name} desmarcado!`, 'info');
                } else {
                    med.history.push({
                        date: recordKey,
                        timeOfDay: timeOfDay,
                        administered: true,
                        timestamp: new Date().toISOString()
                    });
                    showNotification(`${med.name} marcado como administrado!`);
                }
                
                this.saveToCache();
                this.openDayModal(dateStr);
                this.renderAll();
                this.updateUpcomingMedications();
            }
            
            closeDayModal() {
                document.getElementById('dayModal').style.display = 'none';
            }
            
            openExportModal() {
                document.getElementById('exportModal').style.display = 'flex';
            }
            
            closeExportModal() {
                document.getElementById('exportModal').style.display = 'none';
            }
            
            changeMonth(delta) {
                this.calendarMonth += delta;
                
                if (this.calendarMonth > 11) {
                    this.calendarMonth = 0;
                    this.calendarYear++;
                } else if (this.calendarMonth < 0) {
                    this.calendarMonth = 11;
                    this.calendarYear--;
                }
                
                this.renderCalendar();
            }
            
            populateAnimalSelect() {
                const select = document.getElementById('med-animal-select');
                select.innerHTML = '';
                
                Object.values(this.animals).forEach(animal => {
                    const option = document.createElement('option');
                    option.value = animal.id;
                    option.textContent = `${animal.icon} ${animal.name} (${animal.weight})`;
                    select.appendChild(option);
                });
            }
            
            populateExportAnimalSelect() {
                const select = document.getElementById('export-animal-select');
                select.innerHTML = '<option value="all">Todos os animais</option>';
                
                Object.values(this.animals).forEach(animal => {
                    const option = document.createElement('option');
                    option.value = animal.id;
                    option.textContent = `${animal.icon} ${animal.name}`;
                    select.appendChild(option);
                });
            }
            
            addNewAnimal() {
                const name = document.getElementById('new-animal-name').value.trim();
                const weight = document.getElementById('new-animal-weight').value;
                const breed = document.getElementById('new-animal-breed').value.trim();
                const type = document.getElementById('new-animal-type').value;
                const icon = document.getElementById('new-animal-icon').value;
                
                // Valida√ß√£o
                if (!name) {
                    showNotification('Por favor, informe o nome do animal!', 'warning');
                    document.getElementById('new-animal-name').classList.add('input-error');
                    return;
                }
                
                if (!weight || parseFloat(weight) <= 0) {
                    showNotification('Por favor, informe um peso v√°lido (maior que 0)!', 'warning');
                    document.getElementById('new-animal-weight').classList.add('input-error');
                    return;
                }
                
                const id = name.toLowerCase().replace(/[^a-z0-9]/g, '');
                
                if (this.animals[id]) {
                    showNotification('J√° existe um animal com este nome!', 'warning');
                    return;
                }
                
                this.animals[id] = {
                    id,
                    name,
                    weight: `${parseFloat(weight).toLocaleString('pt-BR')} kg`,
                    breed: breed || 'N√£o informada',
                    type: type,
                    icon,
                    medications: {}
                };
                
                this.saveToCache();
                this.populateAnimalSelect();
                this.populateExportAnimalSelect();
                this.renderAll();
                
                // Limpa campos
                document.getElementById('new-animal-name').value = '';
                document.getElementById('new-animal-weight').value = '';
                document.getElementById('new-animal-breed').value = '';
                document.getElementById('new-animal-name').classList.remove('input-error');
                document.getElementById('new-animal-weight').classList.remove('input-error');
                
                showNotification(`${name} adicionado com sucesso!`);
            }
            
            deleteAnimal(animalId) {
                if (confirm(`Tem certeza que deseja excluir o animal ${this.animals[animalId].name}? Todos os medicamentos tamb√©m ser√£o exclu√≠dos.`)) {
                    delete this.animals[animalId];
                    this.saveToCache();
                    this.populateAnimalSelect();
                    this.populateExportAnimalSelect();
                    this.renderAll();
                    showNotification('Animal exclu√≠do com sucesso!', 'info');
                }
            }
            
            editAnimal(animalId) {
                const animal = this.animals[animalId];
                if (!animal) return;
                
                const newName = prompt('Novo nome do animal:', animal.name);
                if (newName && newName.trim()) {
                    const newWeight = prompt('Novo peso (kg):', animal.weight.replace(' kg', ''));
                    const newBreed = prompt('Nova ra√ßa:', animal.breed);
                    
                    if (newWeight && parseFloat(newWeight) > 0) {
                        // Atualiza o ID se o nome mudou
                        const newId = newName.toLowerCase().replace(/[^a-z0-9]/g, '');
                        
                        if (newId !== animalId && this.animals[newId]) {
                            showNotification('J√° existe um animal com este nome!', 'warning');
                            return;
                        }
                        
                        // Remove o animal antigo e adiciona com novo ID
                        delete this.animals[animalId];
                        
                        this.animals[newId] = {
                            id: newId,
                            name: newName.trim(),
                            weight: `${parseFloat(newWeight).toLocaleString('pt-BR')} kg`,
                            breed: newBreed || animal.breed,
                            type: animal.type,
                            icon: animal.icon,
                            medications: animal.medications
                        };
                        
                        this.saveToCache();
                        this.populateAnimalSelect();
                        this.populateExportAnimalSelect();
                        this.renderAll();
                        showNotification('Animal atualizado com sucesso!');
                    }
                }
            }
            
            editMedication(animalId, medicationId) {
                const animal = this.animals[animalId];
                const med = animal.medications[medicationId];
                if (!animal || !med) return;
                
                const newName = prompt('Novo nome do medicamento:', med.name);
                if (newName && newName.trim()) {
                    const newDosage = prompt('Nova dosagem:', med.dosage);
                    
                    if (newDosage && newDosage.trim()) {
                        med.name = newName.trim();
                        med.dosage = newDosage.trim();
                        
                        this.saveToCache();
                        this.renderAll();
                        showNotification('Medicamento atualizado com sucesso!');
                    }
                }
            }
            
            addNewMedication() {
                const animalId = document.getElementById('med-animal-select').value;
                const name = document.getElementById('new-med-name').value.trim();
                const dosage = document.getElementById('new-med-dosage').value.trim();
                const frequency = document.getElementById('new-med-frequency').value;
                const schedule = document.getElementById('new-med-schedule').value;
                const startDate = document.getElementById('new-med-start-date').value;
                const durationType = document.getElementById('new-med-duration-type').value;
                const saveToCache = document.getElementById('save-medication-cache').checked;
                
                // Valida√ß√£o
                if (!animalId) {
                    showNotification('Por favor, selecione um animal!', 'warning');
                    return;
                }
                
                if (!name) {
                    showNotification('Por favor, informe o nome do medicamento!', 'warning');
                    document.getElementById('new-med-name').classList.add('input-error');
                    return;
                }
                
                if (!dosage) {
                    showNotification('Por favor, informe a dosagem!', 'warning');
                    document.getElementById('new-med-dosage').classList.add('input-error');
                    return;
                }
                
                if (!startDate) {
                    showNotification('Por favor, informe a data de in√≠cio!', 'warning');
                    return;
                }
                
                const animal = this.animals[animalId];
                if (!animal) {
                    showNotification('Animal n√£o encontrado!', 'warning');
                    return;
                }
                
                let duration = null;
                let endDate = null;
                let customHours = 24;
                let scheduleTimes = [];
                
                if (frequency === 'custom') {
                    customHours = parseInt(document.getElementById('custom-frequency-value').value) || 24;
                    if (customHours < 1 || customHours > 720) {
                        showNotification('Intervalo personalizado deve estar entre 1 e 720 horas!', 'warning');
                        return;
                    }
                }
                
                if (schedule === 'multiple') {
                    // Coleta os hor√°rios personalizados
                    const timeInputs = document.querySelectorAll('[id^="schedule-time-"]');
                    scheduleTimes = Array.from(timeInputs).map(input => input.value);
                    
                    if (scheduleTimes.length === 0) {
                        showNotification('Adicione pelo menos um hor√°rio!', 'warning');
                        return;
                    }
                }
                
                if (durationType === 'days') {
                    duration = parseInt(document.getElementById('new-med-duration-days').value) || 7;
                    if (duration < 1 || duration > 365) {
                        showNotification('Dura√ß√£o deve estar entre 1 e 365 dias!', 'warning');
                        return;
                    }
                } else if (durationType === 'weeks') {
                    duration = parseInt(document.getElementById('new-med-duration-weeks').value) || 1;
                    if (duration < 1 || duration > 52) {
                        showNotification('Dura√ß√£o deve estar entre 1 e 52 semanas!', 'warning');
                        return;
                    }
                } else if (durationType === 'months') {
                    duration = parseInt(document.getElementById('new-med-duration-months').value) || 1;
                    if (duration < 1 || duration > 12) {
                        showNotification('Dura√ß√£o deve estar entre 1 e 12 meses!', 'warning');
                        return;
                    }
                } else if (durationType === 'end_date') {
                    endDate = document.getElementById('new-med-end-date').value;
                    if (!endDate) {
                        showNotification('Por favor, informe a data de t√©rmino!', 'warning');
                        return;
                    }
                }
                
                const medId = name.toLowerCase().replace(/[^a-z0-9]/g, '') + '_' + Date.now().toString().slice(-6);
                
                const scheduledDates = this.generateScheduledDates(
                    frequency, 
                    startDate, 
                    duration || endDate, 
                    durationType, 
                    customHours, 
                    scheduleTimes
                );
                
                animal.medications[medId] = {
                    id: medId,
                    name,
                    dosage,
                    frequency,
                    schedule,
                    scheduleTimes: scheduleTimes.length > 0 ? scheduleTimes : null,
                    startDate,
                    duration: durationType !== 'continuous' ? duration : null,
                    durationType,
                    endDate: durationType === 'end_date' ? endDate : null,
                    customHours: frequency === 'custom' ? customHours : null,
                    history: [],
                    scheduledDates
                };
                
                // Salva medicamento no cache se solicitado
                if (saveToCache) {
                    this.saveMedicationToCache({
                        id: medId,
                        name,
                        common_dosage: dosage,
                        type: 'medicamento',
                        category: 'geral'
                    });
                }
                
                this.saveToCache();
                
                // Limpa campos
                document.getElementById('new-med-name').value = '';
                document.getElementById('new-med-dosage').value = '';
                document.getElementById('new-med-name').classList.remove('input-error');
                document.getElementById('new-med-dosage').classList.remove('input-error');
                document.getElementById('save-medication-cache').checked = false;
                
                // Limpa hor√°rios personalizados
                this.scheduleTimes = [];
                
                showNotification(`${name} adicionado para ${animal.name}!`);
                
                this.renderAll();
            }
            
            saveMedicationToCache(medication) {
                if (!medication.id) {
                    medication.id = medication.name.toLowerCase().replace(/[^a-z0-9]/g, '') + '_' + Date.now().toString().slice(-6);
                }
                
                this.medicationsCache[medication.id] = medication;
                this.cacheManager.saveMedicationsToCache(this.medicationsCache);
            }
            
            loadMedicationsCache() {
                const cached = this.cacheManager.getMedicationsFromCache();
                if (cached) {
                    this.medicationsCache = cached;
                } else {
                    // Carrega medicamentos pr√©-cadastrados
                    this.medicationsCache = { ...PRELOADED_MEDICATIONS };
                }
            }
            
            openMedicationSelectModal() {
                this.selectedMedicationId = null;
                const modal = document.getElementById('medicationSelectModal');
                modal.style.display = 'flex';
                this.renderMedicationSelectList();
            }
            
            closeMedicationSelectModal() {
                document.getElementById('medicationSelectModal').style.display = 'none';
            }
            
            renderMedicationSelectList(searchTerm = '') {
                const container = document.getElementById('medication-select-list');
                container.innerHTML = '';
                
                let medications = Object.values(this.medicationsCache);
                
                if (searchTerm) {
                    medications = medications.filter(med => 
                        med.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                        (med.type && med.type.toLowerCase().includes(searchTerm.toLowerCase())) ||
                        (med.category && med.category.toLowerCase().includes(searchTerm.toLowerCase()))
                    );
                }
                
                if (medications.length === 0) {
                    container.innerHTML = '<p class="text-center">Nenhum medicamento encontrado.</p>';
                    return;
                }
                
                medications.forEach(med => {
                    const medElement = document.createElement('div');
                    medElement.className = 'medication-select-item';
                    medElement.onclick = () => {
                        // Remove sele√ß√£o anterior
                        document.querySelectorAll('.medication-select-item').forEach(item => {
                            item.classList.remove('selected');
                        });
                        // Seleciona este
                        medElement.classList.add('selected');
                        this.selectedMedicationId = med.id;
                    };
                    
                    medElement.innerHTML = `
                        <div>
                            <h4>${med.name}</h4>
                            <div style="font-size: 0.85rem;">Dosagem comum: ${med.common_dosage}</div>
                            ${med.type ? `<div style="font-size: 0.85rem;">Tipo: ${med.type}</div>` : ''}
                            ${med.category ? `<div style="font-size: 0.85rem;">Categoria: ${med.category}</div>` : ''}
                        </div>
                    `;
                    
                    container.appendChild(medElement);
                });
            }
            
            searchMedications() {
                const searchTerm = document.getElementById('search-medication').value;
                this.renderMedicationSelectList(searchTerm);
            }
            
            useSelectedMedication() {
                if (this.selectedMedicationId) {
                    const med = this.medicationsCache[this.selectedMedicationId];
                    document.getElementById('new-med-name').value = med.name;
                    document.getElementById('new-med-dosage').value = med.common_dosage;
                    this.closeMedicationSelectModal();
                } else {
                    showNotification('Selecione um medicamento da lista!', 'warning');
                }
            }
            
            addPreloadedMedication(animalId, name, dosage, frequency, schedule, duration) {
                if (!this.animals[animalId]) {
                    showNotification('Animal n√£o encontrado!', 'warning');
                    return;
                }
                
                const medId = name.toLowerCase().replace(/[^a-z0-9]/g, '') + '_' + Date.now().toString().slice(-6);
                const startDate = this.getCurrentDate();
                const durationType = duration ? 'days' : 'continuous';
                
                const scheduledDates = this.generateScheduledDates(frequency, startDate, duration, durationType);
                
                this.animals[animalId].medications[medId] = {
                    id: medId,
                    name,
                    dosage,
                    frequency,
                    schedule,
                    startDate,
                    duration: duration,
                    durationType: durationType,
                    history: [],
                    scheduledDates
                };
                
                this.saveToCache();
                this.renderAll();
                showNotification(`${name} adicionado para ${this.animals[animalId].name}!`);
            }
            
            addAllPreloadedMedications() {
                let count = 0;
                
                Object.entries(this.preloadedMedications).forEach(([animalId, meds]) => {
                    if (this.animals[animalId]) {
                        meds.forEach(med => {
                            const medId = med.name.toLowerCase().replace(/[^a-z0-9]/g, '') + '_' + Date.now().toString().slice(-6);
                            
                            this.animals[animalId].medications[medId] = {
                                id: medId,
                                name: med.name,
                                dosage: med.dosage,
                                frequency: med.frequency,
                                schedule: med.schedule,
                                startDate: med.startDate,
                                duration: med.duration,
                                durationType: med.durationType,
                                history: [],
                                scheduledDates: this.generateScheduledDates(med.frequency, med.startDate, med.duration, med.durationType)
                            };
                            
                            count++;
                        });
                    }
                });
                
                this.saveToCache();
                this.renderAll();
                showNotification(`${count} medicamentos exemplo carregados com sucesso!`);
            }
            
            loadFromCache() {
                try {
                    const cachedData = localStorage.getItem(this.cacheManager.appCacheKey);
                    
                    if (cachedData) {
                        const data = JSON.parse(cachedData);
                        this.animals = data.animals || {};
                        this.calendarMonth = data.calendarMonth || new Date().getMonth();
                        this.calendarYear = data.calendarYear || new Date().getFullYear();
                    }
                } catch (e) {
                    console.error('Erro ao carregar do cache:', e);
                }
            }
            
            saveMedicationsToCache() {
                // Adiciona os medicamentos pr√©-cadastrados
                Object.entries(PRELOADED_MEDICATIONS).forEach(([key, med]) => {
                    if (!this.medicationsCache[key]) {
                        this.medicationsCache[key] = med;
                    }
                });
                
                if (this.cacheManager.saveMedicationsToCache(this.medicationsCache)) {
                    showNotification('Medicamentos salvos em cache com sucesso!');
                } else {
                    showNotification('Erro ao salvar medicamentos em cache!', 'danger');
                }
            }
            
            saveToCache() {
                const data = {
                    animals: this.animals,
                    calendarMonth: this.calendarMonth,
                    calendarYear: this.calendarYear,
                    lastUpdated: new Date().toISOString()
                };
                
                try {
                    localStorage.setItem(this.cacheManager.appCacheKey, JSON.stringify(data));
                    this.cacheManager.updateCacheDisplay();
                } catch (e) {
                    console.error('Erro ao salvar no cache:', e);
                    showNotification('Erro ao salvar no cache! Limite de armazenamento pode ter sido atingido.', 'danger');
                }
            }
            
            updateCacheDisplay() {
                this.cacheManager.updateCacheDisplay();
            }
            
            // Fun√ß√µes de exporta√ß√£o PDF
            exportDayToPDF(dateStr) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const date = new Date(dateStr || this.selectedDay);
                const title = `Medica√ß√µes para ${date.toLocaleDateString('pt-BR')}`;
                
                // Configura√ß√£o para suporte a caracteres especiais
                doc.setLanguage('pt-BR');
                
                doc.setFontSize(18);
                doc.text(title, 14, 20);
                
                // Cria tabela
                const tableData = [];
                const dateForQuery = dateStr || this.selectedDay;
                
                Object.values(this.animals).forEach(animal => {
                    Object.values(animal.medications).forEach(med => {
                        const isScheduled = med.scheduledDates.some(scheduledDate => {
                            if (scheduledDate.includes('_')) {
                                return scheduledDate.startsWith(dateForQuery);
                            }
                            return scheduledDate === dateForQuery;
                        });
                        
                        if (isScheduled) {
                            const historyRecord = med.history.find(record => 
                                record.date.startsWith(dateForQuery)
                            );
                            
                            let scheduleText = '';
                            if (med.schedule === 'both') {
                                const morningDone = historyRecord && historyRecord.timeOfDay === 'morning';
                                const nightDone = historyRecord && historyRecord.timeOfDay === 'night';
                                scheduleText = `Manh√£: ${morningDone ? 'Sim' : 'N√£o'}, Noite: ${nightDone ? 'Sim' : 'N√£o'}`;
                            } else if (med.schedule === 'multiple') {
                                const todaySchedules = med.scheduledDates.filter(date => date.startsWith(dateForQuery));
                                const markedCount = med.history.filter(record => record.date.startsWith(dateForQuery)).length;
                                scheduleText = `${markedCount}/${todaySchedules.length} hor√°rios marcados`;
                            } else {
                                scheduleText = this.formatScheduleText(med.schedule);
                            }
                            
                            tableData.push([
                                animal.name,
                                med.name,
                                med.dosage,
                                scheduleText,
                                historyRecord ? 'Administrado' : 'Pendente'
                            ]);
                        }
                    });
                });
                
                if (tableData.length > 0) {
                    doc.autoTable({
                        startY: 30,
                        head: [['Animal', 'Medica√ß√£o', 'Dosagem', 'Hor√°rio', 'Status']],
                        body: tableData,
                        theme: 'grid',
                        headStyles: { fillColor: [74, 144, 226] },
                        styles: { fontSize: 9 },
                        columnStyles: {
                            0: { cellWidth: 30 },
                            1: { cellWidth: 50 },
                            2: { cellWidth: 30 },
                            3: { cellWidth: 40 },
                            4: { cellWidth: 30 }
                        }
                    });
                } else {
                    doc.setFontSize(12);
                    doc.text('Nenhuma medica√ß√£o agendada para este dia.', 14, 40);
                }
                
                const filename = `medicacoes-${dateForQuery}.pdf`;
                doc.save(filename);
                showNotification(`PDF exportado: ${filename}`);
            }
            
            formatScheduleText(schedule) {
                if (schedule === 'morning') return 'Manh√£ (07:30-08:00)';
                if (schedule === 'noon') return 'Meio-dia (12:00-12:30)';
                if (schedule === 'afternoon') return 'Tarde (16:00-16:30)';
                if (schedule === 'night') return 'Noite (19:30-21:00)';
                if (schedule === 'both') return 'Manh√£ e Noite';
                if (schedule === 'multiple') return 'M√∫ltiplos Hor√°rios';
                
                // Se for um hor√°rio espec√≠fico
                if (schedule && schedule.includes(':')) {
                    return schedule;
                }
                
                return schedule;
            }
            
            exportAnimalPDF(animalId) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configura√ß√£o para suporte a caracteres especiais
                doc.setLanguage('pt-BR');
                
                const animal = this.animals[animalId];
                
                doc.setFontSize(18);
                doc.text(`Registro Completo - ${animal.name}`, 14, 20);
                
                doc.setFontSize(14);
                doc.text(`Peso: ${animal.weight}`, 14, 35);
                doc.text(`Ra√ßa: ${animal.breed || 'N√£o informada'}`, 14, 45);
                doc.text(`Tipo: ${this.getAnimalTypeText(animal.type)}`, 14, 55);
                
                let y = 70;
                Object.values(animal.medications).forEach(med => {
                    doc.setFontSize(12);
                    doc.text(`‚Ä¢ ${med.name}: ${med.dosage}`, 20, y);
                    y += 7;
                    
                    doc.setFontSize(10);
                    doc.text(`  Frequ√™ncia: ${this.getFrequencyText(med.frequency)}`, 25, y);
                    y += 5;
                    doc.text(`  Hor√°rio: ${this.formatScheduleText(med.schedule)}`, 25, y);
                    y += 5;
                    doc.text(`  In√≠cio: ${new Date(med.startDate).toLocaleDateString('pt-BR')}`, 25, y);
                    y += 5;
                    
                    if (med.durationType === 'days' && med.duration) {
                        doc.text(`  Dura√ß√£o: ${med.duration} dias`, 25, y);
                        y += 5;
                    } else if (med.durationType === 'weeks' && med.duration) {
                        doc.text(`  Dura√ß√£o: ${med.duration} semanas`, 25, y);
                        y += 5;
                    } else if (med.durationType === 'months' && med.duration) {
                        doc.text(`  Dura√ß√£o: ${med.duration} meses`, 25, y);
                        y += 5;
                    } else if (med.durationType === 'end_date' && med.endDate) {
                        doc.text(`  T√©rmino: ${new Date(med.endDate).toLocaleDateString('pt-BR')}`, 25, y);
                        y += 5;
                    } else if (med.durationType === 'continuous') {
                        doc.text(`  Dura√ß√£o: Cont√≠nuo`, 25, y);
                        y += 5;
                    }
                    
                    const historyCount = med.history.length;
                    doc.text(`  Registros: ${historyCount} administra√ß√µes`, 25, y);
                    y += 10;
                    
                    if (y > 280) {
                        doc.addPage();
                        y = 20;
                    }
                });
                
                const filename = `registro-${animal.name}.pdf`;
                doc.save(filename);
                showNotification(`PDF exportado: ${filename}`);
            }
            
            exportMonthToPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('landscape');
                
                // Configura√ß√£o para suporte a caracteres especiais
                doc.setLanguage('pt-BR');
                
                const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                                  'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                const title = `Calend√°rio de Medica√ß√µes - ${monthNames[this.calendarMonth]} ${this.calendarYear}`;
                
                doc.setFontSize(16);
                doc.text(title, 14, 20);
                
                // Gera uma tabela com todas as medica√ß√µes do m√™s
                const tableData = [];
                const firstDay = new Date(this.calendarYear, this.calendarMonth, 1);
                const lastDay = new Date(this.calendarYear, this.calendarMonth + 1, 0);
                const daysInMonth = lastDay.getDate();
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${this.calendarYear}-${String(this.calendarMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const date = new Date(dateStr);
                    
                    Object.values(this.animals).forEach(animal => {
                        Object.values(animal.medications).forEach(med => {
                            const isScheduled = med.scheduledDates.some(scheduledDate => {
                                if (scheduledDate.includes('_')) {
                                    return scheduledDate.startsWith(dateStr);
                                }
                                return scheduledDate === dateStr;
                            });
                            
                            if (isScheduled) {
                                const historyRecord = med.history.find(record => 
                                    record.date.startsWith(dateStr)
                                );
                                
                                let scheduleText = '';
                                if (med.schedule === 'both') {
                                    const morningDone = historyRecord && historyRecord.timeOfDay === 'morning';
                                    const nightDone = historyRecord && historyRecord.timeOfDay === 'night';
                                    scheduleText = `Manh√£: ${morningDone ? 'Sim' : 'N√£o'}, Noite: ${nightDone ? 'Sim' : 'N√£o'}`;
                                } else if (med.schedule === 'multiple') {
                                    const todaySchedules = med.scheduledDates.filter(date => date.startsWith(dateStr));
                                    const markedCount = med.history.filter(record => record.date.startsWith(dateStr)).length;
                                    scheduleText = `${markedCount}/${todaySchedules.length} marcados`;
                                } else {
                                    scheduleText = this.formatScheduleText(med.schedule);
                                }
                                
                                tableData.push([
                                    date.toLocaleDateString('pt-BR', { weekday: 'short', day: 'numeric' }),
                                    animal.name,
                                    med.name,
                                    med.dosage,
                                    scheduleText,
                                    historyRecord ? 'Administrado' : 'Pendente'
                                ]);
                            }
                        });
                    });
                }
                
                if (tableData.length > 0) {
                    doc.autoTable({
                        startY: 30,
                        head: [['Data', 'Animal', 'Medica√ß√£o', 'Dosagem', 'Hor√°rio', 'Status']],
                        body: tableData,
                        theme: 'grid',
                        styles: { fontSize: 8 },
                        headStyles: { fillColor: [74, 144, 226] },
                        margin: { left: 10, right: 10 }
                    });
                } else {
                    doc.setFontSize(12);
                    doc.text('Nenhuma medica√ß√£o agendada para este m√™s.', 14, 40);
                }
                
                const filename = `calendario-${monthNames[this.calendarMonth]}-${this.calendarYear}.pdf`;
                doc.save(filename);
                showNotification(`PDF exportado: ${filename}`);
            }
            
            exportMonthRangeToPDF() {
                this.openExportModal();
            }
            
            exportSelectedRangeToPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configura√ß√£o para suporte a caracteres especiais
                doc.setLanguage('pt-BR');
                
                const startDate = document.getElementById('export-start-date').value;
                const endDate = document.getElementById('export-end-date').value;
                const animalId = document.getElementById('export-animal-select').value;
                
                if (!startDate || !endDate) {
                    showNotification('Por favor, selecione as datas!', 'warning');
                    return;
                }
                
                const start = new Date(startDate);
                const end = new Date(endDate);
                const title = `Relat√≥rio de Medica√ß√µes - ${start.toLocaleDateString('pt-BR')} a ${end.toLocaleDateString('pt-BR')}`;
                
                doc.setFontSize(16);
                doc.text(title, 14, 20);
                
                const tableData = [];
                const currentDate = new Date(start);
                
                while (currentDate <= end) {
                    const dateStr = this.formatDate(currentDate);
                    
                    const animalsToProcess = animalId === 'all' 
                        ? Object.values(this.animals) 
                        : [this.animals[animalId]].filter(Boolean);
                    
                    animalsToProcess.forEach(animal => {
                        Object.values(animal.medications).forEach(med => {
                            const isScheduled = med.scheduledDates.some(scheduledDate => {
                                if (scheduledDate.includes('_')) {
                                    return scheduledDate.startsWith(dateStr);
                                }
                                return scheduledDate === dateStr;
                            });
                            
                            if (isScheduled) {
                                const historyRecord = med.history.find(record => 
                                    record.date.startsWith(dateStr)
                                );
                                
                                let scheduleText = '';
                                if (med.schedule === 'both') {
                                    const morningDone = historyRecord && historyRecord.timeOfDay === 'morning';
                                    const nightDone = historyRecord && historyRecord.timeOfDay === 'night';
                                    scheduleText = `Manh√£: ${morningDone ? 'Sim' : 'N√£o'}, Noite: ${nightDone ? 'Sim' : 'N√£o'}`;
                                } else if (med.schedule === 'multiple') {
                                    const todaySchedules = med.scheduledDates.filter(date => date.startsWith(dateStr));
                                    const markedCount = med.history.filter(record => record.date.startsWith(dateStr)).length;
                                    scheduleText = `${markedCount}/${todaySchedules.length} marcados`;
                                } else {
                                    scheduleText = this.formatScheduleText(med.schedule);
                                }
                                
                                tableData.push([
                                    currentDate.toLocaleDateString('pt-BR'),
                                    animal.name,
                                    med.name,
                                    med.dosage,
                                    scheduleText,
                                    historyRecord ? 'Administrado' : 'Pendente'
                                ]);
                            }
                        });
                    });
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                if (tableData.length === 0) {
                    doc.setFontSize(12);
                    doc.text('Nenhuma medica√ß√£o encontrada no per√≠odo selecionado.', 14, 40);
                } else {
                    doc.autoTable({
                        startY: 30,
                        head: [['Data', 'Animal', 'Medica√ß√£o', 'Dosagem', 'Hor√°rio', 'Status']],
                        body: tableData,
                        theme: 'grid',
                        styles: { fontSize: 8 },
                        headStyles: { fillColor: [74, 144, 226] }
                    });
                }
                
                const filename = `relatorio-${startDate}-a-${endDate}.pdf`;
                doc.save(filename);
                showNotification(`PDF exportado: ${filename}`);
                this.closeExportModal();
            }
            
            exportData() {
                const data = {
                    animals: this.animals,
                    medications: this.medicationsCache,
                    exportedAt: new Date().toISOString(),
                    version: '3.0'
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `backup-medicacao-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showNotification('Dados exportados com sucesso!');
            }
            
            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = e => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = event => {
                        try {
                            const data = JSON.parse(event.target.result);
                            
                            if (data.animals) {
                                this.animals = data.animals;
                            }
                            
                            if (data.medications) {
                                this.medicationsCache = data.medications;
                            }
                            
                            this.saveToCache();
                            this.cacheManager.saveMedicationsToCache(this.medicationsCache);
                            this.populateAnimalSelect();
                            this.populateExportAnimalSelect();
                            this.renderAll();
                            this.updateUpcomingMedications();
                            showNotification('Dados importados com sucesso!');
                        } catch (error) {
                            showNotification('Erro ao importar dados! Arquivo inv√°lido.', 'danger');
                        }
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            }
            
            resetAllData() {
                if (confirm('ATEN√á√ÉO: Isso ir√° resetar TODOS os dados para os valores padr√£o. Tem certeza?')) {
                    localStorage.clear();
                    location.reload();
                }
            }
        }

        // Fun√ß√µes globais
        const vetSystem = new VeterinarySystem();

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            if (type === 'warning') {
                notification.style.background = 'var(--warning)';
            } else if (type === 'danger') {
                notification.style.background = 'var(--danger)';
            } else if (type === 'info') {
                notification.style.background = 'var(--info)';
            } else {
                notification.style.background = 'var(--success)';
            }
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function clearAppCache() {
            vetSystem.cacheManager.clearAppCache();
            setTimeout(() => location.reload(), 1000);
        }

        function clearMedicationsCache() {
            vetSystem.cacheManager.clearMedicationsCache();
        }

        function saveMedicationsToCache() {
            vetSystem.saveMedicationsToCache();
        }

        function addAllPreloadedMedications() {
            vetSystem.addAllPreloadedMedications();
        }

        function closeDayModal() {
            vetSystem.closeDayModal();
        }

        function closeExportModal() {
            vetSystem.closeExportModal();
        }

        function closeMedicationSelectModal() {
            vetSystem.closeMedicationSelectModal();
        }

        function changeMonth(delta) {
            vetSystem.changeMonth(delta);
        }

        function exportMonthToPDF() {
            vetSystem.exportMonthToPDF();
        }

        function exportMonthRangeToPDF() {
            vetSystem.exportMonthRangeToPDF();
        }

        function exportDayToPDF(dateStr) {
            vetSystem.exportDayToPDF(dateStr);
        }

        function exportAllToPDF() {
            vetSystem.exportAllToPDF();
        }

        function addNewAnimal() {
            vetSystem.addNewAnimal();
        }

        function addNewMedication() {
            vetSystem.addNewMedication();
        }

        function addPreloadedMedication(animalId, name, dosage, frequency, schedule, duration) {
            vetSystem.addPreloadedMedication(animalId, name, dosage, frequency, schedule, duration);
        }

        function exportData() {
            vetSystem.exportData();
        }

        function importData() {
            vetSystem.importData();
        }

        function resetAllData() {
            vetSystem.resetAllData();
        }

        function toggleCustomFrequency() {
            vetSystem.toggleCustomFrequency();
        }

        function toggleDurationFields() {
            vetSystem.toggleDurationFields();
        }

        function toggleScheduleFields() {
            vetSystem.toggleScheduleFields();
        }

        function addScheduleTime() {
            vetSystem.addScheduleTime();
        }

        function removeScheduleTime(index) {
            vetSystem.removeScheduleTime(index);
        }

        function searchMedications() {
            vetSystem.searchMedications();
        }

        function useSelectedMedication() {
            vetSystem.useSelectedMedication();
        }

        function openTab(evt, tabName) {
            // Esconde todos os conte√∫dos das tabs
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Remove a classe active de todos os bot√µes
            const tabButtons = document.getElementsByClassName('tab-button');
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            
            // Mostra a tab atual e adiciona a classe active ao bot√£o
            document.getElementById(tabName).classList.add('active');
            if (evt) {
                evt.currentTarget.classList.add('active');
            } else {
                // Encontra o bot√£o correspondente √† tab
                for (let i = 0; i < tabButtons.length; i++) {
                    if (tabButtons[i].textContent.includes(tabName.replace('tab-', ''))) {
                        tabButtons[i].classList.add('active');
                        break;
                    }
                }
            }
        }

        // Inicializa o sistema quando a p√°gina carrega
        document.addEventListener('DOMContentLoaded', function() {
            vetSystem.init();
            
            // Tenta carregar o arquivo JSON externo se existir
            try {
                fetch('src/importacao_gatos.json')
                    .then(response => response.json())
                    .then(data => {
                        console.log('Arquivo JSON externo carregado com sucesso');
                    })
                    .catch(error => {
                        console.log('Usando dados padr√£o embutidos no HTML');
                    });
            } catch (error) {
                console.log('Erro ao carregar JSON externo, usando dados embutidos');
            }
        });
    </script>
</body>
</html>
