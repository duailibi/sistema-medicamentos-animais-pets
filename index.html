<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêæ Controle de Medica√ß√£o Animal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary: #4a90e2;
            --secondary: #7ed321;
            --warning: #f5a623;
            --danger: #d0021b;
            --info: #50e3c2;
            --light: #f8f9fa;
            --dark: #333;
            --morning: #ff9800;
            --night: #673ab7;
            --success: #27ae60;
            --bg-color: #f5f7fa;
            --card-color: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;
        }
        
        [data-theme="dark"] {
            --primary: #64b5f6;
            --secondary: #81c784;
            --warning: #ffb74d;
            --danger: #e57373;
            --info: #4db6ac;
            --light: #424242;
            --dark: #f5f5f5;
            --morning: #ff9800;
            --night: #9575cd;
            --success: #66bb6a;
            --bg-color: #121212;
            --card-color: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #424242;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body {
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 15px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--card-color);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .time-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .time-box {
            background: var(--light);
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: bold;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        
        .current-time {
            background-color: var(--light);
            color: var(--primary);
        }
        
        .cache-indicator {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
            min-width: 150px;
            padding: 10px;
            background: var(--light);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        
        .cache-meter {
            background: var(--border-color);
            border-radius: 10px;
            width: 100%;
            height: 15px;
            overflow: hidden;
            position: relative;
        }
        
        .cache-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--info));
            width: 0%;
            transition: width 0.5s;
            border-radius: 10px;
        }
        
        .cache-text {
            font-size: 0.8rem;
            color: var(--text-color);
            white-space: nowrap;
        }
        
        .cache-warning {
            color: var(--warning);
            font-weight: bold;
        }
        
        .theme-toggle {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .upcoming-medications {
            background: var(--card-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }
        
        .upcoming-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .upcoming-item {
            background: var(--light);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }
        
        .upcoming-item.urgent {
            border-left: 4px solid var(--danger);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(208, 2, 27, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(208, 2, 27, 0); }
            100% { box-shadow: 0 0 0 0 rgba(208, 2, 27, 0); }
        }
        
        .countdown-timer {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            color: var(--primary);
        }
        
        .progress-bar-container {
            margin-top: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--info));
            width: 0%;
            transition: width 0.5s;
            border-radius: 5px;
        }
        
        .animal-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .animal-card {
            background: var(--card-color);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }
        
        .animal-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .animal-icon {
            font-size: 2rem;
            margin-right: 15px;
        }
        
        .animal-name {
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .animal-weight {
            background: var(--light);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-left: 10px;
            border: 1px solid var(--border-color);
        }
        
        .medication-list {
            margin-top: 15px;
        }
        
        .medication-item {
            background: var(--light);
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
        }
        
        .medication-info h4 {
            color: var(--text-color);
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .medication-details {
            font-size: 0.85rem;
            color: var(--text-color);
            opacity: 0.8;
        }
        
        .medication-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .medication-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            min-width: 90px;
            text-align: center;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-done {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-skipped {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status-upcoming {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            white-space: nowrap;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 0.75rem;
        }
        
        .btn-mark {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-unmark {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-skip {
            background-color: #95a5a6;
            color: white;
        }
        
        .btn-edit {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-delete {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-add {
            background-color: var(--success);
            color: white;
        }
        
        .btn-pdf {
            background-color: #f44336;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .calendar-section {
            background: var(--card-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
            overflow-x: auto;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .calendar-nav {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            min-width: 700px;
        }
        
        .calendar-day {
            background: var(--light);
            border-radius: 8px;
            padding: 8px;
            min-height: 120px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .calendar-day:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 8px;
            background: var(--light);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .day-pdf-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.8rem;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .day-pdf-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .today {
            background-color: rgba(100, 181, 246, 0.2);
            border: 2px solid var(--primary);
        }
        
        .calendar-medication {
            font-size: 0.65rem;
            padding: 2px 4px;
            margin-bottom: 2px;
            border-radius: 3px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
            position: relative;
        }
        
        .calendar-medication:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 0;
            background: var(--dark);
            color: white;
            padding: 8px;
            border-radius: 5px;
            font-size: 0.8rem;
            white-space: normal;
            width: 250px;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-align: left;
            line-height: 1.4;
        }
        
        .medication-morning {
            background-color: rgba(255, 235, 59, 0.3);
            border-left: 2px solid var(--morning);
        }
        
        .medication-night {
            background-color: rgba(103, 58, 183, 0.3);
            border-left: 2px solid var(--night);
        }
        
        .management-section {
            background: var(--card-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color);
            font-size: 0.9rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 0.9rem;
            background: var(--light);
            color: var(--text-color);
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .animals-list {
            margin-top: 15px;
            max-height: 250px;
            overflow-y: auto;
        }
        
        .animal-manage-item {
            background: var(--light);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
        }
        
        .cache-controls {
            margin-top: 15px;
        }
        
        .notification {
            position: fixed;
            bottom: 15px;
            right: 15px;
            padding: 12px 20px;
            background: var(--primary);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            max-width: 300px;
            font-size: 0.9rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        
        .modal-content {
            background: var(--card-color);
            padding: 20px;
            border-radius: 15px;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            color: var(--text-color);
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .developer-info {
            margin-top: 10px;
            padding: 10px;
            background: var(--light);
            border-radius: 10px;
            display: inline-block;
            border: 1px solid var(--border-color);
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .animal-cards {
                grid-template-columns: 1fr;
            }
            
            .header-top {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .header-controls {
                justify-content: center;
            }
            
            .time-display {
                flex-direction: column;
                gap: 10px;
            }
            
            .cache-indicator {
                min-width: 100%;
            }
            
            .calendar-grid {
                min-width: 100%;
                font-size: 0.8rem;
            }
            
            .calendar-day {
                min-height: 100px;
            }
            
            .calendar-medication:hover::after {
                width: 200px;
                font-size: 0.7rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .animal-name {
                font-size: 1.4rem;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            header, .animal-card, .calendar-section, .management-section, .upcoming-medications {
                padding: 15px;
            }
            
            .calendar-grid {
                gap: 5px;
            }
            
            .calendar-day {
                min-height: 90px;
                padding: 5px;
            }
            
            .day-number {
                font-size: 0.8rem;
            }
            
            .calendar-medication {
                font-size: 0.6rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 15px;
            }
        }
        
        /* Estilos para o tema escuro */
        body[data-theme="dark"] .status-pending {
            background-color: #5d4037;
            color: #ffcc80;
        }
        
        body[data-theme="dark"] .status-done {
            background-color: #1b5e20;
            color: #a5d6a7;
        }
        
        body[data-theme="dark"] .status-skipped {
            background-color: #b71c1c;
            color: #ef9a9a;
        }
        
        body[data-theme="dark"] .status-upcoming {
            background-color: #004d40;
            color: #80cbc4;
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary);
        }
        
        /* Utilit√°rios */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mt-10 {
            margin-top: 10px;
        }
        
        .mb-10 {
            margin-bottom: 10px;
        }
        
        .flex {
            display: flex;
        }
        
        .flex-wrap {
            flex-wrap: wrap;
        }
        
        .items-center {
            align-items: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .gap-10 {
            gap: 10px;
        }
    </style>
</head>
<body data-theme="light">
    <div class="container">
        <header>
            <div class="header-top">
                <div>
                    <h1><i class="fas fa-paw"></i> Controle de Medica√ß√£o Animal</h1>
                    <p>Sistema para gerenciamento de medicamentos para animais</p>
                </div>
                
                <div class="cache-indicator">
                    <div class="cache-text">Cache App: <span id="cache-percentage">0%</span></div>
                    <div class="cache-meter">
                        <div class="cache-fill" id="cache-fill"></div>
                    </div>
                    <div class="cache-text">Cache Total: <span id="total-cache-percentage">0%</span></div>
                </div>
                
                <div class="header-controls">
                    <button class="theme-toggle" id="theme-toggle" title="Alternar tema">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="btn btn-warning btn-small" onclick="clearAppCache()">
                        <i class="fas fa-trash-alt"></i> Limpar Cache App
                    </button>
                    <button class="btn btn-pdf btn-small" onclick="exportMonthToPDF()">
                        <i class="fas fa-file-pdf"></i> Exportar M√™s
                    </button>
                </div>
            </div>
            
            <div class="time-display">
                <div class="time-box current-time">
                    <i class="fas fa-clock"></i> 
                    <div>
                        <div>Hor√°rio Local: <span id="local-time">--:--</span></div>
                        <div id="current-date" style="font-size: 0.85rem; font-weight: normal;">--/--/----</div>
                    </div>
                </div>
                <div class="time-box">
                    <i class="fas fa-syringe"></i>
                    <div id="next-medication-count">Pr√≥ximas: 0</div>
                </div>
            </div>
        </header>
        
        <!-- Pr√≥ximas Medica√ß√µes com Timer -->
        <div class="upcoming-medications">
            <h2><i class="fas fa-hourglass-half"></i> Pr√≥ximas Medica√ß√µes</h2>
            <div class="upcoming-grid" id="upcoming-medications-list">
                <!-- Preenchido por JavaScript -->
            </div>
        </div>
        
        <!-- Cards dos Animais -->
        <div class="animal-cards" id="animal-cards-container">
            <!-- Preenchido por JavaScript -->
        </div>
        
        <!-- Calend√°rio -->
        <div class="calendar-section">
            <div class="calendar-header">
                <h2><i class="fas fa-calendar"></i> Calend√°rio de Medica√ß√µes</h2>
                <div class="calendar-nav">
                    <button class="btn btn-edit" onclick="changeMonth(-1)">
                        <i class="fas fa-chevron-left"></i> Anterior
                    </button>
                    <h3 id="current-month">M√™s Atual</h3>
                    <button class="btn btn-edit" onclick="changeMonth(1)">
                        Pr√≥ximo <i class="fas fa-chevron-right"></i>
                    </button>
                    <button class="btn btn-pdf" onclick="exportMonthRangeToPDF()">
                        <i class="fas fa-file-pdf"></i> Exportar Per√≠odo
                    </button>
                </div>
            </div>
            
            <div class="calendar-grid" id="calendar-days-header">
                <!-- Cabe√ßalhos dos dias -->
            </div>
            <div class="calendar-grid" id="calendar-days">
                <!-- Dias ser√£o gerados por JavaScript -->
            </div>
        </div>
        
        <!-- Modal para Detalhes do Dia -->
        <div class="modal" id="dayModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalDayTitle">Detalhes do Dia</h3>
                    <button class="close-modal" onclick="closeDayModal()">&times;</button>
                </div>
                <div id="modalDayContent">
                    <!-- Conte√∫do do modal ser√° preenchido por JavaScript -->
                </div>
                <div class="modal-actions">
                    <button class="btn btn-pdf" onclick="exportDayToPDF()">
                        <i class="fas fa-file-pdf"></i> Exportar PDF do Dia
                    </button>
                    <button class="btn btn-edit" onclick="closeDayModal()">
                        <i class="fas fa-times"></i> Fechar
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Modal para Exporta√ß√£o de Per√≠odo -->
        <div class="modal" id="exportModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Exportar Per√≠odo</h3>
                    <button class="close-modal" onclick="closeExportModal()">&times;</button>
                </div>
                <div id="exportModalContent">
                    <div class="form-group">
                        <label for="export-start-date">Data Inicial:</label>
                        <input type="date" id="export-start-date">
                    </div>
                    <div class="form-group">
                        <label for="export-end-date">Data Final:</label>
                        <input type="date" id="export-end-date">
                    </div>
                    <div class="form-group">
                        <label for="export-animal-select">Animal (opcional):</label>
                        <select id="export-animal-select">
                            <option value="all">Todos os animais</option>
                            <!-- Preenchido por JavaScript -->
                        </select>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-pdf" onclick="exportSelectedRangeToPDF()">
                        <i class="fas fa-file-pdf"></i> Exportar PDF
                    </button>
                    <button class="btn btn-edit" onclick="closeExportModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Gerenciamento -->
        <div class="management-section">
            <h2><i class="fas fa-cogs"></i> Gerenciamento do Sistema</h2>
            
            <div class="form-grid">
                <div>
                    <h3><i class="fas fa-plus-circle"></i> Adicionar Novo Animal</h3>
                    <div class="form-group">
                        <label for="new-animal-name">Nome do Animal:</label>
                        <input type="text" id="new-animal-name" placeholder="Ex: Tom">
                    </div>
                    <div class="form-group">
                        <label for="new-animal-weight">Peso:</label>
                        <input type="text" id="new-animal-weight" placeholder="Ex: 5,2 kg">
                    </div>
                    <div class="form-group">
                        <label for="new-animal-icon">√çcone:</label>
                        <select id="new-animal-icon">
                            <option value="üê±">üê± Gato</option>
                            <option value="üê∂">üê∂ Cachorro</option>
                            <option value="üê∞">üê∞ Coelho</option>
                            <option value="üêπ">üêπ Hamster</option>
                        </select>
                    </div>
                    <button class="btn btn-add" onclick="addNewAnimal()">
                        <i class="fas fa-plus"></i> Adicionar Animal
                    </button>
                </div>
                
                <div>
                    <h3><i class="fas fa-pills"></i> Adicionar Medicamento</h3>
                    <div class="form-group">
                        <label for="med-animal-select">Animal:</label>
                        <select id="med-animal-select">
                            <!-- Preenchido por JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="new-med-name">Nome do Medicamento:</label>
                        <input type="text" id="new-med-name" placeholder="Ex: Antibi√≥tico">
                    </div>
                    <div class="form-group">
                        <label for="new-med-dosage">Dosagem:</label>
                        <input type="text" id="new-med-dosage" placeholder="Ex: 1 comprimido">
                    </div>
                    <div class="form-group">
                        <label for="new-med-frequency">Frequ√™ncia:</label>
                        <select id="new-med-frequency">
                            <option value="daily">1x ao dia</option>
                            <option value="12h">12/12h</option>
                            <option value="48h">A cada 48h</option>
                            <option value="weekly">1x por semana</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="new-med-start-date">Data de In√≠cio:</label>
                        <input type="date" id="new-med-start-date">
                    </div>
                    <div class="form-group">
                        <label for="new-med-duration-type">Dura√ß√£o:</label>
                        <select id="new-med-duration-type">
                            <option value="days">N√∫mero de dias</option>
                            <option value="end_date">Data de t√©rmino</option>
                            <option value="continuous">Cont√≠nuo</option>
                        </select>
                    </div>
                    <div class="form-group" id="duration-days-container">
                        <label for="new-med-duration-days">N√∫mero de dias:</label>
                        <input type="number" id="new-med-duration-days" min="1" value="7">
                    </div>
                    <div class="form-group hidden" id="end-date-container">
                        <label for="new-med-end-date">Data de T√©rmino:</label>
                        <input type="date" id="new-med-end-date">
                    </div>
                    <button class="btn btn-add" onclick="addNewMedication()">
                        <i class="fas fa-plus"></i> Adicionar Medicamento
                    </button>
                </div>
            </div>
            
            <div class="cache-controls">
                <h3 style="margin-top: 20px;"><i class="fas fa-database"></i> Controle de Cache</h3>
                <div class="controls">
                    <button class="btn btn-warning" onclick="clearAppCache()">
                        <i class="fas fa-trash-alt"></i> Limpar Cache do App
                    </button>
                    <button class="btn btn-edit" onclick="exportData()">
                        <i class="fas fa-download"></i> Exportar Dados
                    </button>
                    <button class="btn btn-edit" onclick="importData()">
                        <i class="fas fa-upload"></i> Importar Dados
                    </button>
                    <button class="btn btn-danger" onclick="resetAllData()">
                        <i class="fas fa-exclamation-triangle"></i> Resetar Tudo
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Notifica√ß√£o -->
        <div class="notification" id="notification">
            Medica√ß√£o registrada com sucesso!
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p>Sistema de controle de medica√ß√£o animal | Desenvolvido por Marcos Guimar√£es Duailibi Filho</p>
            <div class="developer-info">
                <p><i class="fas fa-phone"></i> Contato: +55 (95) 98111-4983</p>
                <p><i class="fas fa-envelope"></i> Email: marcosduailibi12345@hotmail.com</p>
            </div>
            <p style="margin-top: 15px;">¬© 2025 - Todos os direitos reservados.</p>
        </div>
    </div>

    <script>
        // Sistema de cache avan√ßado
        class CacheManager {
            constructor() {
                this.appCacheKey = 'vetmed_app_data';
                this.appCacheLimit = 0.3; // 30% do storage dispon√≠vel
            }
            
            getAppCacheSize() {
                const appData = localStorage.getItem(this.appCacheKey);
                return appData ? appData.length * 2 : 0; // em bytes
            }
            
            getTotalCacheSize() {
                let total = 0;
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        total += localStorage[key].length * 2;
                    }
                }
                return total;
            }
            
            getAppCachePercentage() {
                const appSize = this.getAppCacheSize();
                const totalLimit = 5 * 1024 * 1024; // 5MB em bytes
                return (appSize / totalLimit) * 100;
            }
            
            getTotalCachePercentage() {
                const totalSize = this.getTotalCacheSize();
                const totalLimit = 5 * 1024 * 1024; // 5MB em bytes
                return (totalSize / totalLimit) * 100;
            }
            
            clearAppCache() {
                localStorage.removeItem(this.appCacheKey);
                this.updateCacheDisplay();
                showNotification('Cache da aplica√ß√£o limpo com sucesso!');
            }
            
            clearAllCache() {
                localStorage.clear();
                this.updateCacheDisplay();
                showNotification('Todo o cache limpo com sucesso!');
            }
            
            updateCacheDisplay() {
                const appPercentage = this.getAppCachePercentage();
                const totalPercentage = this.getTotalCachePercentage();
                
                const fillElement = document.getElementById('cache-fill');
                const appTextElement = document.getElementById('cache-percentage');
                const totalTextElement = document.getElementById('total-cache-percentage');
                
                fillElement.style.width = `${appPercentage}%`;
                appTextElement.textContent = `${appPercentage.toFixed(1)}%`;
                totalTextElement.textContent = `${totalPercentage.toFixed(1)}%`;
                
                // Altera a cor conforme o uso
                if (appPercentage > 25) {
                    fillElement.style.background = 'linear-gradient(90deg, #f5a623, #d0021b)';
                } else if (appPercentage > 15) {
                    fillElement.style.background = 'linear-gradient(90deg, #f5a623, #f5a623)';
                } else {
                    fillElement.style.background = 'linear-gradient(90deg, var(--secondary), var(--info))';
                }
            }
        }

        // Sistema principal
        class VeterinarySystem {
            constructor() {
                this.cacheManager = new CacheManager();
                this.timezone = null;
                this.currentDate = new Date();
                this.calendarMonth = new Date().getMonth();
                this.calendarYear = new Date().getFullYear();
                this.selectedDay = null;
                this.upcomingTimers = [];
                
                // Estado inicial dos animais
                this.animals = {
                    'frajo la': {
                        id: 'frajo la',
                        name: 'Frajola',
                        weight: '4,5 kg',
                        icon: 'üê±',
                        medications: {
                            'vetmax': {
                                id: 'vetmax',
                                name: 'Vetmax Plus',
                                dosage: '¬Ω comprimido',
                                frequency: 'daily',
                                schedule: 'morning',
                                startDate: this.getCurrentDate(),
                                duration: 3,
                                durationType: 'days',
                                repeatAfter: 15,
                                history: [],
                                scheduledDates: this.generateScheduledDates('daily', this.getCurrentDate(), 3, 'days')
                            },
                            'omegablue': {
                                id: 'omegablue',
                                name: 'Omegablue Esqualeno',
                                dosage: '1 c√°psula',
                                frequency: '48h',
                                schedule: 'night',
                                startDate: this.getCurrentDate(),
                                duration: null,
                                durationType: 'continuous',
                                history: [],
                                scheduledDates: this.generateScheduledDates('48h', this.getCurrentDate(), null, 'continuous')
                            }
                        }
                    },
                    'nenem': {
                        id: 'nenem',
                        name: 'Nen√©m',
                        weight: '3,8 kg',
                        icon: 'üê±',
                        medications: {
                            'petsporin': {
                                id: 'petsporin',
                                name: 'Petsporin 75 mg',
                                dosage: '¬Ω comprimido',
                                frequency: '12h',
                                schedule: 'both',
                                startDate: this.getCurrentDate(),
                                duration: 7,
                                durationType: 'days',
                                history: [],
                                scheduledDates: this.generateScheduledDates('12h', this.getCurrentDate(), 7, 'days')
                            },
                            'mellis': {
                                id: 'mellis',
                                name: 'Mellis Vet 0,5 mg',
                                dosage: '1 comprimido',
                                frequency: 'daily',
                                schedule: 'morning',
                                startDate: this.getCurrentDate(),
                                duration: 5,
                                durationType: 'days',
                                history: [],
                                scheduledDates: this.generateScheduledDates('daily', this.getCurrentDate(), 5, 'days')
                            },
                            'hemocare': {
                                id: 'hemocare',
                                name: 'Hemocare',
                                dosage: '0,4 ml',
                                frequency: 'daily',
                                schedule: 'morning',
                                startDate: this.getCurrentDate(),
                                duration: 30,
                                durationType: 'days',
                                history: [],
                                scheduledDates: this.generateScheduledDates('daily', this.getCurrentDate(), 30, 'days')
                            },
                            'promun': {
                                id: 'promun',
                                name: 'Promun Cat Pasta',
                                dosage: '2 ml',
                                frequency: 'daily',
                                schedule: 'morning',
                                startDate: this.getCurrentDate(),
                                duration: null,
                                durationType: 'continuous',
                                history: [],
                                scheduledDates: this.generateScheduledDates('daily', this.getCurrentDate(), null, 'continuous')
                            },
                            'dipirona': {
                                id: 'dipirona',
                                name: 'Dipirona gotas',
                                dosage: '3 gotas',
                                frequency: '12h',
                                schedule: 'both',
                                startDate: this.getCurrentDate(),
                                duration: 5,
                                durationType: 'days',
                                conditional: true,
                                history: [],
                                scheduledDates: this.generateScheduledDates('12h', this.getCurrentDate(), 5, 'days')
                            },
                            'vetaglos': {
                                id: 'vetaglos',
                                name: 'Vetagl√≥s pomada',
                                dosage: 'Aplica√ß√£o t√≥pica',
                                frequency: '12h',
                                schedule: 'both',
                                startDate: this.getCurrentDate(),
                                duration: null,
                                durationType: 'continuous',
                                history: [],
                                scheduledDates: this.generateScheduledDates('12h', this.getCurrentDate(), null, 'continuous')
                            }
                        }
                    }
                };
            }
            
            init() {
                this.loadFromCache();
                this.setupEventListeners();
                this.setupTheme();
                this.updateTime();
                this.updateCacheDisplay();
                this.renderAll();
                this.startTimers();
                setInterval(() => this.updateTime(), 1000);
                setInterval(() => this.updateCacheDisplay(), 5000);
                setInterval(() => this.updateUpcomingMedications(), 1000);
            }
            
            setupTheme() {
                const themeToggle = document.getElementById('theme-toggle');
                const savedTheme = localStorage.getItem('vetmed_theme') || 'light';
                document.body.setAttribute('data-theme', savedTheme);
                
                themeToggle.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                
                themeToggle.addEventListener('click', () => {
                    const currentTheme = document.body.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    document.body.setAttribute('data-theme', newTheme);
                    themeToggle.innerHTML = newTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                    
                    localStorage.setItem('vetmed_theme', newTheme);
                });
            }
            
            setupEventListeners() {
                // Toggle de tipo de dura√ß√£o
                const durationTypeSelect = document.getElementById('new-med-duration-type');
                const daysContainer = document.getElementById('duration-days-container');
                const endDateContainer = document.getElementById('end-date-container');
                
                durationTypeSelect.addEventListener('change', function() {
                    if (this.value === 'days') {
                        daysContainer.classList.remove('hidden');
                        endDateContainer.classList.add('hidden');
                    } else if (this.value === 'end_date') {
                        daysContainer.classList.add('hidden');
                        endDateContainer.classList.remove('hidden');
                        
                        // Define data de t√©rmino padr√£o (7 dias ap√≥s hoje)
                        const endDateInput = document.getElementById('new-med-end-date');
                        const today = new Date();
                        const endDate = new Date(today);
                        endDate.setDate(today.getDate() + 7);
                        endDateInput.value = endDate.toISOString().split('T')[0];
                    } else {
                        daysContainer.classList.add('hidden');
                        endDateContainer.classList.add('hidden');
                    }
                });
                
                // Configura datas padr√£o
                const startDateInput = document.getElementById('new-med-start-date');
                startDateInput.value = this.getCurrentDate();
                
                const exportStartDate = document.getElementById('export-start-date');
                const exportEndDate = document.getElementById('export-end-date');
                const today = new Date();
                exportStartDate.value = this.formatDate(today);
                exportEndDate.value = this.formatDate(new Date(today.getFullYear(), today.getMonth() + 1, 0));
            }
            
            getCurrentDate() {
                return this.formatDate(new Date());
            }
            
            formatDate(date) {
                return date.toISOString().split('T')[0];
            }
            
            generateScheduledDates(frequency, startDate, duration, durationType) {
                const scheduledDates = [];
                const start = new Date(startDate);
                
                if (durationType === 'continuous') {
                    // Para medicamentos cont√≠nuos, gerar para os pr√≥ximos 90 dias
                    for (let i = 0; i < 90; i++) {
                        const date = new Date(start);
                        date.setDate(start.getDate() + i);
                        
                        if (frequency === 'daily') {
                            scheduledDates.push(date.toISOString().split('T')[0]);
                        } else if (frequency === '12h') {
                            scheduledDates.push(date.toISOString().split('T')[0] + '_morning');
                            scheduledDates.push(date.toISOString().split('T')[0] + '_night');
                        } else if (frequency === '48h') {
                            if (i % 2 === 0) {
                                scheduledDates.push(date.toISOString().split('T')[0]);
                            }
                        } else if (frequency === 'weekly') {
                            if (i % 7 === 0) {
                                scheduledDates.push(date.toISOString().split('T')[0]);
                            }
                        }
                    }
                } else {
                    // Para medicamentos com dura√ß√£o definida
                    const endDate = durationType === 'days' ? 
                        new Date(start.getTime() + (duration * 24 * 60 * 60 * 1000)) :
                        new Date(duration);
                    
                    let currentDate = new Date(start);
                    let dayCount = 0;
                    
                    while (currentDate <= endDate && dayCount < 365) {
                        if (frequency === 'daily') {
                            scheduledDates.push(currentDate.toISOString().split('T')[0]);
                        } else if (frequency === '12h') {
                            scheduledDates.push(currentDate.toISOString().split('T')[0] + '_morning');
                            scheduledDates.push(currentDate.toISOString().split('T')[0] + '_night');
                        } else if (frequency === '48h') {
                            if (dayCount % 2 === 0) {
                                scheduledDates.push(currentDate.toISOString().split('T')[0]);
                            }
                        } else if (frequency === 'weekly') {
                            if (dayCount % 7 === 0) {
                                scheduledDates.push(currentDate.toISOString().split('T')[0]);
                            }
                        }
                        
                        currentDate.setDate(currentDate.getDate() + 1);
                        dayCount++;
                    }
                }
                
                return scheduledDates;
            }
            
            async updateTime() {
                try {
                    const response = await fetch('https://worldtimeapi.org/api/ip');
                    const data = await response.json();
                    
                    this.timezone = data.timezone;
                    const now = new Date(data.datetime);
                    
                    document.getElementById('local-time').textContent = 
                        now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                    
                    document.getElementById('current-date').textContent = 
                        now.toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    
                } catch (error) {
                    const now = new Date();
                    document.getElementById('local-time').textContent = 
                        now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                    document.getElementById('current-date').textContent = 
                        now.toLocaleDateString('pt-BR');
                }
            }
            
            updateUpcomingMedications() {
                const container = document.getElementById('upcoming-medications-list');
                const countElement = document.getElementById('next-medication-count');
                
                const upcoming = this.getUpcomingMedications();
                container.innerHTML = '';
                
                if (upcoming.length === 0) {
                    container.innerHTML = '<p class="text-center" style="width: 100%;">Nenhuma medica√ß√£o pr√≥xima no momento.</p>';
                    countElement.textContent = 'Pr√≥ximas: 0';
                    return;
                }
                
                countElement.textContent = `Pr√≥ximas: ${upcoming.length}`;
                
                upcoming.forEach(med => {
                    const item = document.createElement('div');
                    item.className = `upcoming-item ${med.urgent ? 'urgent' : ''}`;
                    
                    const timeLeft = this.calculateTimeLeft(med.nextTime);
                    const progress = this.calculateProgress(med.nextTime);
                    
                    item.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="font-size: 1.5rem;">${med.animalIcon}</div>
                                <div>
                                    <h4 style="margin: 0;">${med.medicationName}</h4>
                                    <p style="margin: 0; font-size: 0.9rem;">${med.animalName} - ${med.dosage}</p>
                                </div>
                            </div>
                            <div style="font-size: 1.2rem; color: ${med.urgent ? 'var(--danger)' : 'var(--primary)'}">
                                ${med.timeOfDay === 'morning' ? '‚òÄÔ∏è' : 'üåô'}
                            </div>
                        </div>
                        
                        <div class="countdown-timer">${timeLeft}</div>
                        
                        <div class="progress-bar-container">
                            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 5px;">
                                <span>${med.nextTime}</span>
                                <span>${progress}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%;"></div>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(item);
                });
            }
            
            getUpcomingMedications() {
                const upcoming = [];
                const now = new Date();
                const currentTime = now.getHours() * 60 + now.getMinutes();
                
                // Hor√°rios de medica√ß√£o
                const morningStart = 7 * 60 + 30; // 07:30
                const morningEnd = 8 * 60; // 08:00
                const nightStart = 19 * 60 + 30; // 19:30
                const nightEnd = 21 * 60; // 21:00
                
                Object.values(this.animals).forEach(animal => {
                    Object.values(animal.medications).forEach(med => {
                        const today = this.getCurrentDate();
                        const todayRecords = med.history.filter(record => 
                            record.date.startsWith(today)
                        );
                        
                        // Verifica medica√ß√£o da manh√£
                        if (med.schedule === 'morning' || med.schedule === 'both') {
                            const morningDone = todayRecords.some(r => r.timeOfDay === 'morning');
                            if (!morningDone) {
                                const timeToMorning = morningStart - currentTime;
                                if (timeToMorning > 0 && timeToMorning <= 120) { // Pr√≥ximas 2 horas
                                    upcoming.push({
                                        animalName: animal.name,
                                        animalIcon: animal.icon,
                                        medicationName: med.name,
                                        dosage: med.dosage,
                                        timeOfDay: 'morning',
                                        nextTime: '07:30',
                                        urgent: timeToMorning <= 30 // Urgente se faltar menos de 30 minutos
                                    });
                                }
                            }
                        }
                        
                        // Verifica medica√ß√£o da noite
                        if (med.schedule === 'night' || med.schedule === 'both') {
                            const nightDone = todayRecords.some(r => r.timeOfDay === 'night');
                            if (!nightDone) {
                                const timeToNight = nightStart - currentTime;
                                if (timeToNight > 0 && timeToNight <= 120) { // Pr√≥ximas 2 horas
                                    upcoming.push({
                                        animalName: animal.name,
                                        animalIcon: animal.icon,
                                        medicationName: med.name,
                                        dosage: med.dosage,
                                        timeOfDay: 'night',
                                        nextTime: '19:30',
                                        urgent: timeToNight <= 30 // Urgente se faltar menos de 30 minutos
                                    });
                                }
                            }
                        }
                    });
                });
                
                // Ordena por urg√™ncia e tempo
                upcoming.sort((a, b) => {
                    if (a.urgent && !b.urgent) return -1;
                    if (!a.urgent && b.urgent) return 1;
                    return 0;
                });
                
                return upcoming.slice(0, 6); // Limita a 6
            }
            
            calculateTimeLeft(nextTime) {
                const now = new Date();
                const [hours, minutes] = nextTime.split(':').map(Number);
                const targetTime = new Date(now);
                targetTime.setHours(hours, minutes, 0, 0);
                
                if (targetTime < now) {
                    targetTime.setDate(targetTime.getDate() + 1);
                }
                
                const diff = targetTime - now;
                const hoursLeft = Math.floor(diff / (1000 * 60 * 60));
                const minutesLeft = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                return `${hoursLeft}h ${minutesLeft}m`;
            }
            
            calculateProgress(nextTime) {
                const now = new Date();
                const [targetHours, targetMinutes] = nextTime.split(':').map(Number);
                
                // Calcula progresso baseado em quanto falta para o hor√°rio
                const totalDayMinutes = 24 * 60;
                const currentMinutes = now.getHours() * 60 + now.getMinutes();
                const targetMinutesOfDay = targetHours * 60 + targetMinutes;
                
                let minutesUntilTarget = targetMinutesOfDay - currentMinutes;
                if (minutesUntilTarget < 0) {
                    minutesUntilTarget += totalDayMinutes;
                }
                
                // Progresso de 0% a 100% nas 2 horas antes do hor√°rio
                const progress = Math.max(0, Math.min(100, 100 - (minutesUntilTarget / 120) * 100));
                return Math.round(progress);
            }
            
            startTimers() {
                // Atualiza a cada minuto
                setInterval(() => {
                    this.updateUpcomingMedications();
                }, 60000);
            }
            
            renderAll() {
                this.renderAnimalCards();
                this.renderCalendar();
                this.populateAnimalSelect();
                this.populateExportAnimalSelect();
            }
            
            renderAnimalCards() {
                const container = document.getElementById('animal-cards-container');
                container.innerHTML = '';
                
                Object.values(this.animals).forEach(animal => {
                    const card = document.createElement('div');
                    card.className = 'animal-card';
                    
                    let medicationsHTML = '';
                    Object.values(animal.medications).forEach(med => {
                        const status = this.getMedicationStatus(animal.id, med.id);
                        const statusText = this.getStatusText(animal.id, med.id);
                        
                        medicationsHTML += `
                            <div class="medication-item">
                                <div class="medication-info">
                                    <h4>${med.name}</h4>
                                    <div class="medication-details">${med.dosage} - ${this.getFrequencyText(med.frequency)}</div>
                                </div>
                                <div class="medication-actions">
                                    <div class="medication-status ${status}">${statusText}</div>
                                    ${med.schedule === 'both' ? `
                                        <button class="btn btn-mark btn-small" onclick="vetSystem.toggleMedication('${animal.id}', '${med.id}', 'morning')">
                                            <i class="fas fa-sun"></i>
                                        </button>
                                        <button class="btn btn-mark btn-small" onclick="vetSystem.toggleMedication('${animal.id}', '${med.id}', 'night')">
                                            <i class="fas fa-moon"></i>
                                        </button>
                                    ` : `
                                        <button class="btn btn-mark btn-small" onclick="vetSystem.toggleMedication('${animal.id}', '${med.id}', '${med.schedule}')">
                                            <i class="fas fa-check"></i>
                                        </button>
                                    `}
                                    <button class="btn btn-unmark btn-small" onclick="vetSystem.unmarkMedication('${animal.id}', '${med.id}')">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                    <button class="btn btn-pdf btn-small" onclick="vetSystem.exportMedicationPDF('${animal.id}', '${med.id}')">
                                        <i class="fas fa-file-pdf"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    card.innerHTML = `
                        <div class="animal-header">
                            <div class="animal-icon">${animal.icon}</div>
                            <div>
                                <div class="animal-name">${animal.name}</div>
                                <span class="animal-weight">${animal.weight}</span>
                            </div>
                            <div style="margin-left: auto;">
                                <button class="btn btn-edit btn-small" onclick="vetSystem.editAnimal('${animal.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-pdf btn-small" onclick="vetSystem.exportAnimalPDF('${animal.id}')">
                                    <i class="fas fa-file-pdf"></i>
                                </button>
                            </div>
                        </div>
                        <div class="medication-list">
                            ${medicationsHTML}
                        </div>
                        <div class="controls">
                            <button class="btn btn-mark" onclick="vetSystem.markAll('${animal.id}', 'morning')">
                                <i class="fas fa-sun"></i> Marcar Manh√£
                            </button>
                            <button class="btn btn-mark" onclick="vetSystem.markAll('${animal.id}', 'night')">
                                <i class="fas fa-moon"></i> Marcar Noite
                            </button>
                            <button class="btn btn-unmark" onclick="vetSystem.unmarkAll('${animal.id}')">
                                <i class="fas fa-redo"></i> Desmarcar Todas
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(card);
                });
            }
            
            getFrequencyText(frequency) {
                const texts = {
                    'daily': '1x ao dia',
                    '12h': '12/12h',
                    '48h': 'A cada 48h',
                    'weekly': '1x por semana',
                    'custom': 'Personalizado'
                };
                return texts[frequency] || frequency;
            }
            
            getMedicationStatus(animalId, medId) {
                const animal = this.animals[animalId];
                const med = animal.medications[medId];
                const today = this.getCurrentDate();
                const todayRecords = med.history.filter(record => 
                    record.date.startsWith(today)
                );
                
                if (med.schedule === 'both') {
                    const morningDone = todayRecords.some(r => r.timeOfDay === 'morning');
                    const nightDone = todayRecords.some(r => r.timeOfDay === 'night');
                    if (morningDone && nightDone) return 'status-done';
                    if (morningDone || nightDone) return 'status-upcoming';
                } else if (todayRecords.length > 0) {
                    return 'status-done';
                }
                return 'status-pending';
            }
            
            getStatusText(animalId, medId) {
                const animal = this.animals[animalId];
                const med = animal.medications[medId];
                const today = this.getCurrentDate();
                const todayRecords = med.history.filter(record => 
                    record.date.startsWith(today)
                );
                
                if (med.schedule === 'both') {
                    const morningDone = todayRecords.some(r => r.timeOfDay === 'morning');
                    const nightDone = todayRecords.some(r => r.timeOfDay === 'night');
                    if (morningDone && nightDone) return 'Completo';
                    if (morningDone) return 'Manh√£ OK';
                    if (nightDone) return 'Noite OK';
                } else if (todayRecords.length > 0) {
                    return 'Administrado';
                }
                return 'Pendente';
            }
            
            toggleMedication(animalId, medId, timeOfDay) {
                const animal = this.animals[animalId];
                const med = animal.medications[medId];
                const today = this.getCurrentDate();
                const recordKey = med.schedule === 'both' ? `${today}_${timeOfDay}` : today;
                
                const existingIndex = med.history.findIndex(record => 
                    record.date === recordKey
                );
                
                if (existingIndex > -1) {
                    med.history.splice(existingIndex, 1);
                    showNotification(`${med.name} desmarcado!`, 'info');
                } else {
                    med.history.push({
                        date: recordKey,
                        timeOfDay: timeOfDay,
                        administered: true,
                        timestamp: new Date().toISOString()
                    });
                    showNotification(`${med.name} marcado como administrado!`);
                }
                
                this.saveToCache();
                this.renderAll();
                this.updateUpcomingMedications();
            }
            
            unmarkMedication(animalId, medId) {
                const animal = this.animals[animalId];
                const med = animal.medications[medId];
                const today = this.getCurrentDate();
                
                med.history = med.history.filter(record => 
                    !record.date.startsWith(today)
                );
                
                this.saveToCache();
                this.renderAll();
                this.updateUpcomingMedications();
                showNotification(`${med.name} desmarcado!`, 'info');
            }
            
            markAll(animalId, timeOfDay) {
                const animal = this.animals[animalId];
                const today = this.getCurrentDate();
                
                Object.keys(animal.medications).forEach(medId => {
                    const med = animal.medications[medId];
                    
                    if (med.schedule === timeOfDay || med.schedule === 'both' || 
                        (timeOfDay === 'morning' && med.schedule === 'morning') ||
                        (timeOfDay === 'night' && med.schedule === 'night')) {
                        
                        const recordKey = med.schedule === 'both' ? 
                            `${today}_${timeOfDay}` : today;
                        
                        med.history = med.history.filter(record => 
                            record.date !== recordKey
                        );
                        
                        med.history.push({
                            date: recordKey,
                            timeOfDay: timeOfDay,
                            administered: true,
                            timestamp: new Date().toISOString()
                        });
                    }
                });
                
                this.saveToCache();
                this.renderAll();
                this.updateUpcomingMedications();
                showNotification(`Todas as medica√ß√µes de ${timeOfDay === 'morning' ? 'manh√£' : 'noite'} marcadas!`);
            }
            
            unmarkAll(animalId) {
                const animal = this.animals[animalId];
                const today = this.getCurrentDate();
                
                Object.keys(animal.medications).forEach(medId => {
                    const med = animal.medications[medId];
                    med.history = med.history.filter(record => 
                        !record.date.startsWith(today)
                    );
                });
                
                this.saveToCache();
                this.renderAll();
                this.updateUpcomingMedications();
                showNotification(`Todas as medica√ß√µes desmarcadas!`, 'info');
            }
            
            renderCalendar() {
                this.renderCalendarHeaders();
                this.renderCalendarDays();
            }
            
            renderCalendarHeaders() {
                const headerContainer = document.getElementById('calendar-days-header');
                headerContainer.innerHTML = '';
                const weekdays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
                weekdays.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'calendar-day-header';
                    dayHeader.textContent = day;
                    headerContainer.appendChild(dayHeader);
                });
            }
            
            renderCalendarDays() {
                const daysContainer = document.getElementById('calendar-days');
                daysContainer.innerHTML = '';
                
                const firstDay = new Date(this.calendarYear, this.calendarMonth, 1);
                const lastDay = new Date(this.calendarYear, this.calendarMonth + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDay = firstDay.getDay();
                
                // Dias em branco no in√≠cio
                for (let i = 0; i < startingDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day';
                    daysContainer.appendChild(emptyDay);
                }
                
                // Dias do m√™s
                const today = new Date();
                const isCurrentMonth = today.getMonth() === this.calendarMonth && 
                                      today.getFullYear() === this.calendarYear;
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    
                    if (isCurrentMonth && day === today.getDate()) {
                        dayElement.classList.add('today');
                    }
                    
                    const dateStr = `${this.calendarYear}-${String(this.calendarMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    dayElement.setAttribute('data-date', dateStr);
                    dayElement.onclick = () => this.openDayModal(dateStr);
                    
                    const dayNumber = document.createElement('div');
                    dayNumber.className = 'day-number';
                    dayNumber.innerHTML = `
                        <span>${day}</span>
                        <button class="day-pdf-btn" onclick="event.stopPropagation(); vetSystem.exportDayToPDF('${dateStr}')" title="Exportar PDF do dia">
                            <i class="fas fa-file-pdf"></i>
                        </button>
                    `;
                    dayElement.appendChild(dayNumber);
                    
                    // Adiciona medica√ß√µes deste dia
                    this.addMedicationsToDay(dayElement, dateStr);
                    
                    daysContainer.appendChild(dayElement);
                }
                
                // Atualiza t√≠tulo do m√™s
                const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                                  'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                document.getElementById('current-month').textContent = 
                    `${monthNames[this.calendarMonth]} ${this.calendarYear}`;
            }
            
            addMedicationsToDay(dayElement, dateStr) {
                const dayMedications = [];
                
                Object.values(this.animals).forEach(animal => {
                    Object.values(animal.medications).forEach(med => {
                        const isScheduled = med.scheduledDates.some(scheduledDate => {
                            if (scheduledDate.includes('_')) {
                                return scheduledDate.startsWith(dateStr);
                            }
                            return scheduledDate === dateStr;
                        });
                        
                        if (isScheduled) {
                            const historyRecord = med.history.find(record => 
                                record.date.startsWith(dateStr)
                            );
                            
                            if (med.schedule === 'both') {
                                dayMedications.push({
                                    animal: animal.name,
                                    animalIcon: animal.icon,
                                    medication: med.name,
                                    dosage: med.dosage,
                                    timeOfDay: 'morning',
                                    administered: historyRecord && historyRecord.timeOfDay === 'morning'
                                });
                                
                                dayMedications.push({
                                    animal: animal.name,
                                    animalIcon: animal.icon,
                                    medication: med.name,
                                    dosage: med.dosage,
                                    timeOfDay: 'night',
                                    administered: historyRecord && historyRecord.timeOfDay === 'night'
                                });
                            } else {
                                dayMedications.push({
                                    animal: animal.name,
                                    animalIcon: animal.icon,
                                    medication: med.name,
                                    dosage: med.dosage,
                                    timeOfDay: med.schedule,
                                    administered: !!historyRecord
                                });
                            }
                        }
                    });
                });
                
                // Agrupa por animal
                const groupedByAnimal = {};
                dayMedications.forEach(med => {
                    if (!groupedByAnimal[med.animal]) {
                        groupedByAnimal[med.animal] = [];
                    }
                    groupedByAnimal[med.animal].push(med);
                });
                
                // Adiciona ao calend√°rio (m√°ximo 4 medica√ß√µes por dia)
                let medCount = 0;
                for (const animalName in groupedByAnimal) {
                    if (medCount >= 4) break;
                    
                    const animalMeds = groupedByAnimal[animalName];
                    const animalIcon = animalMeds[0].animalIcon;
                    
                    animalMeds.forEach(med => {
                        if (medCount >= 4) return;
                        
                        const medElement = document.createElement('div');
                        medElement.className = `calendar-medication medication-${med.timeOfDay}`;
                        
                        // Tooltip com informa√ß√µes detalhadas
                        const timeText = med.timeOfDay === 'morning' ? 'Manh√£ (07:30-08:00)' : 'Noite (19:30-21:00)';
                        const statusText = med.administered ? '‚úÖ Administrado' : '‚è∞ Pendente';
                        medElement.setAttribute('data-tooltip', 
                            `${animalIcon} ${animalName}\nüíä ${med.medication}\nüìã ${med.dosage}\n‚è∞ ${timeText}\n${statusText}`);
                        
                        const statusIcon = med.administered ? '‚úÖ' : '‚è∞';
                        medElement.textContent = `${animalIcon} ${statusIcon} ${med.medication.substring(0, 10)}`;
                        
                        dayElement.appendChild(medElement);
                        medCount++;
                    });
                }
                
                // Se houver mais medica√ß√µes, mostra indicador
                if (dayMedications.length > 4) {
                    const moreElement = document.createElement('div');
                    moreElement.className = 'calendar-medication';
                    moreElement.textContent = `+${dayMedications.length - 4} mais`;
                    moreElement.style.fontSize = '0.6rem';
                    moreElement.style.opacity = '0.7';
                    dayElement.appendChild(moreElement);
                }
            }
            
            openDayModal(dateStr) {
                this.selectedDay = dateStr;
                const modal = document.getElementById('dayModal');
                const date = new Date(dateStr);
                document.getElementById('modalDayTitle').textContent = 
                    `Medica√ß√µes para ${date.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}`;
                
                const dayMedications = [];
                Object.values(this.animals).forEach(animal => {
                    Object.values(animal.medications).forEach(med => {
                        const isScheduled = med.scheduledDates.some(scheduledDate => {
                            if (scheduledDate.includes('_')) {
                                return scheduledDate.startsWith(dateStr);
                            }
                            return scheduledDate === dateStr;
                        });
                        
                        if (isScheduled) {
                            const historyRecord = med.history.find(record => 
                                record.date.startsWith(dateStr)
                            );
                            
                            dayMedications.push({
                                animalId: animal.id,
                                animal: animal.name,
                                animalIcon: animal.icon,
                                medication: med.name,
                                medicationId: med.id,
                                dosage: med.dosage,
                                frequency: med.frequency,
                                timeOfDay: med.schedule,
                                administered: !!historyRecord,
                                history: med.history.filter(record => record.date.startsWith(dateStr))
                            });
                        }
                    });
                });
                
                const modalContent = document.getElementById('modalDayContent');
                modalContent.innerHTML = '';
                
                if (dayMedications.length === 0) {
                    modalContent.innerHTML = '<p class="text-center">Nenhuma medica√ß√£o agendada para este dia.</p>';
                } else {
                    dayMedications.forEach(med => {
                        const medCard = document.createElement('div');
                        medCard.className = 'medication-item';
                        medCard.style.marginBottom = '10px';
                        
                        let actionsHTML = '';
                        if (med.timeOfDay === 'both') {
                            actionsHTML = `
                                <button class="btn btn-mark btn-small" onclick="vetSystem.toggleMedicationFromModal('${dateStr}', '${med.animalId}', '${med.medicationId}', 'morning')">
                                    <i class="fas fa-sun"></i> Manh√£
                                </button>
                                <button class="btn btn-mark btn-small" onclick="vetSystem.toggleMedicationFromModal('${dateStr}', '${med.animalId}', '${med.medicationId}', 'night')">
                                    <i class="fas fa-moon"></i> Noite
                                </button>
                            `;
                        } else {
                            actionsHTML = `
                                <button class="btn btn-mark btn-small" onclick="vetSystem.toggleMedicationFromModal('${dateStr}', '${med.animalId}', '${med.medicationId}', '${med.timeOfDay}')">
                                    <i class="fas fa-check"></i> Marcar
                                </button>
                            `;
                        }
                        
                        medCard.innerHTML = `
                            <div class="medication-info">
                                <h4>${med.animalIcon} ${med.animal} - ${med.medication}</h4>
                                <div class="medication-details">
                                    ${med.dosage} - ${this.getFrequencyText(med.frequency)} - 
                                    ${med.timeOfDay === 'morning' ? 'Manh√£' : med.timeOfDay === 'night' ? 'Noite' : 'Manh√£ e Noite'}
                                </div>
                                <div class="medication-details">
                                    Status: ${med.administered ? '‚úÖ Administrado' : '‚è∞ Pendente'}
                                </div>
                            </div>
                            <div class="medication-actions">
                                ${actionsHTML}
                                <button class="btn btn-pdf btn-small" onclick="vetSystem.exportMedicationDayPDF('${dateStr}', '${med.animalId}', '${med.medicationId}')">
                                    <i class="fas fa-file-pdf"></i>
                                </button>
                            </div>
                        `;
                        modalContent.appendChild(medCard);
                    });
                }
                
                modal.style.display = 'flex';
            }
            
            toggleMedicationFromModal(dateStr, animalId, medicationId, timeOfDay) {
                const animal = this.animals[animalId];
                const med = animal.medications[medicationId];
                const recordKey = med.schedule === 'both' ? `${dateStr}_${timeOfDay}` : dateStr;
                
                const existingIndex = med.history.findIndex(record => 
                    record.date === recordKey
                );
                
                if (existingIndex > -1) {
                    med.history.splice(existingIndex, 1);
                } else {
                    med.history.push({
                        date: recordKey,
                        timeOfDay: timeOfDay,
                        administered: true,
                        timestamp: new Date().toISOString()
                    });
                }
                
                this.saveToCache();
                this.openDayModal(dateStr);
                this.renderAll();
                this.updateUpcomingMedications();
            }
            
            closeDayModal() {
                document.getElementById('dayModal').style.display = 'none';
            }
            
            openExportModal() {
                document.getElementById('exportModal').style.display = 'flex';
            }
            
            closeExportModal() {
                document.getElementById('exportModal').style.display = 'none';
            }
            
            changeMonth(delta) {
                this.calendarMonth += delta;
                
                if (this.calendarMonth > 11) {
                    this.calendarMonth = 0;
                    this.calendarYear++;
                } else if (this.calendarMonth < 0) {
                    this.calendarMonth = 11;
                    this.calendarYear--;
                }
                
                this.renderCalendar();
            }
            
            populateAnimalSelect() {
                const select = document.getElementById('med-animal-select');
                select.innerHTML = '';
                
                Object.values(this.animals).forEach(animal => {
                    const option = document.createElement('option');
                    option.value = animal.id;
                    option.textContent = `${animal.icon} ${animal.name} (${animal.weight})`;
                    select.appendChild(option);
                });
            }
            
            populateExportAnimalSelect() {
                const select = document.getElementById('export-animal-select');
                select.innerHTML = '<option value="all">Todos os animais</option>';
                
                Object.values(this.animals).forEach(animal => {
                    const option = document.createElement('option');
                    option.value = animal.id;
                    option.textContent = `${animal.icon} ${animal.name}`;
                    select.appendChild(option);
                });
            }
            
            addNewAnimal() {
                const name = document.getElementById('new-animal-name').value;
                const weight = document.getElementById('new-animal-weight').value;
                const icon = document.getElementById('new-animal-icon').value;
                
                if (!name || !weight) {
                    showNotification('Por favor, preencha todos os campos!', 'warning');
                    return;
                }
                
                const id = name.toLowerCase().replace(/[^a-z0-9]/g, '');
                
                if (this.animals[id]) {
                    showNotification('J√° existe um animal com este nome!', 'warning');
                    return;
                }
                
                this.animals[id] = {
                    id,
                    name,
                    weight,
                    icon,
                    medications: {}
                };
                
                this.saveToCache();
                this.populateAnimalSelect();
                this.populateExportAnimalSelect();
                this.renderAll();
                
                document.getElementById('new-animal-name').value = '';
                document.getElementById('new-animal-weight').value = '';
                
                showNotification(`${name} adicionado com sucesso!`);
            }
            
            addNewMedication() {
                const animalId = document.getElementById('med-animal-select').value;
                const name = document.getElementById('new-med-name').value;
                const dosage = document.getElementById('new-med-dosage').value;
                const frequency = document.getElementById('new-med-frequency').value;
                const schedule = document.getElementById('new-med-time').value;
                const startDate = document.getElementById('new-med-start-date').value;
                const durationType = document.getElementById('new-med-duration-type').value;
                
                if (!animalId || !name || !dosage || !startDate) {
                    showNotification('Por favor, preencha todos os campos obrigat√≥rios!', 'warning');
                    return;
                }
                
                const animal = this.animals[animalId];
                if (!animal) {
                    showNotification('Animal n√£o encontrado!', 'warning');
                    return;
                }
                
                let duration = null;
                let endDate = null;
                
                if (durationType === 'days') {
                    duration = parseInt(document.getElementById('new-med-duration-days').value) || 7;
                } else if (durationType === 'end_date') {
                    endDate = document.getElementById('new-med-end-date').value;
                }
                
                const medId = name.toLowerCase().replace(/[^a-z0-9]/g, '') + '_' + Date.now().toString().slice(-6);
                
                const scheduledDates = this.generateScheduledDates(frequency, startDate, duration || endDate, durationType);
                
                animal.medications[medId] = {
                    id: medId,
                    name,
                    dosage,
                    frequency,
                    schedule,
                    startDate,
                    duration: durationType === 'days' ? duration : null,
                    durationType,
                    endDate: durationType === 'end_date' ? endDate : null,
                    history: [],
                    scheduledDates
                };
                
                this.saveToCache();
                
                document.getElementById('new-med-name').value = '';
                document.getElementById('new-med-dosage').value = '';
                document.getElementById('new-med-start-date').value = '';
                
                showNotification(`${name} adicionado para ${animal.name}!`);
                
                this.renderAll();
            }
            
            saveToCache() {
                const data = {
                    animals: this.animals,
                    calendarMonth: this.calendarMonth,
                    calendarYear: this.calendarYear,
                    lastUpdated: new Date().toISOString()
                };
                
                try {
                    localStorage.setItem(this.cacheManager.appCacheKey, JSON.stringify(data));
                    this.cacheManager.updateCacheDisplay();
                } catch (e) {
                    console.error('Erro ao salvar no cache:', e);
                    showNotification('Erro ao salvar no cache! Limite de armazenamento pode ter sido atingido.', 'danger');
                }
            }
            
            loadFromCache() {
                try {
                    const cachedData = localStorage.getItem(this.cacheManager.appCacheKey);
                    
                    if (cachedData) {
                        const data = JSON.parse(cachedData);
                        this.animals = data.animals || this.animals;
                        this.calendarMonth = data.calendarMonth || new Date().getMonth();
                        this.calendarYear = data.calendarYear || new Date().getFullYear();
                    }
                } catch (e) {
                    console.error('Erro ao carregar do cache:', e);
                }
            }
            
            updateCacheDisplay() {
                this.cacheManager.updateCacheDisplay();
            }
            
            // Fun√ß√µes de exporta√ß√£o PDF
            exportDayToPDF(dateStr) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const date = new Date(dateStr || this.selectedDay);
                const title = `Medica√ß√µes para ${date.toLocaleDateString('pt-BR')}`;
                
                doc.setFontSize(18);
                doc.text(title, 14, 20);
                
                let y = 35;
                const pageHeight = doc.internal.pageSize.height;
                
                Object.values(this.animals).forEach(animal => {
                    Object.values(animal.medications).forEach(med => {
                        const isScheduled = med.scheduledDates.some(scheduledDate => {
                            if (scheduledDate.includes('_')) {
                                return scheduledDate.startsWith(dateStr || this.selectedDay);
                            }
                            return scheduledDate === (dateStr || this.selectedDay);
                        });
                        
                        if (isScheduled) {
                            const historyRecord = med.history.find(record => 
                                record.date.startsWith(dateStr || this.selectedDay)
                            );
                            
                            doc.setFontSize(12);
                            doc.text(`${animal.name} - ${med.name}`, 14, y);
                            y += 8;
                            
                            doc.setFontSize(10);
                            doc.text(`Dosagem: ${med.dosage}`, 14, y);
                            y += 5;
                            doc.text(`Frequ√™ncia: ${this.getFrequencyText(med.frequency)}`, 14, y);
                            y += 5;
                            doc.text(`Hor√°rio: ${med.schedule === 'morning' ? 'Manh√£' : med.schedule === 'night' ? 'Noite' : 'Manh√£ e Noite'}`, 14, y);
                            y += 5;
                            doc.text(`Status: ${historyRecord ? 'Administrado' : 'Pendente'}`, 14, y);
                            y += 10;
                            
                            if (y > pageHeight - 20) {
                                doc.addPage();
                                y = 20;
                            }
                        }
                    });
                });
                
                const filename = `medicacoes-${dateStr || this.selectedDay}.pdf`;
                doc.save(filename);
                showNotification(`PDF exportado: ${filename}`);
            }
            
            exportMedicationDayPDF(dateStr, animalId, medicationId) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const animal = this.animals[animalId];
                const med = animal.medications[medicationId];
                const date = new Date(dateStr);
                
                doc.setFontSize(18);
                doc.text(`Registro de Medica√ß√£o`, 14, 20);
                
                doc.setFontSize(14);
                doc.text(`Data: ${date.toLocaleDateString('pt-BR')}`, 14, 35);
                doc.text(`Animal: ${animal.name}`, 14, 45);
                doc.text(`Medica√ß√£o: ${med.name}`, 14, 55);
                doc.text(`Dosagem: ${med.dosage}`, 14, 65);
                doc.text(`Frequ√™ncia: ${this.getFrequencyText(med.frequency)}`, 14, 75);
                doc.text(`Hor√°rio: ${med.schedule === 'morning' ? 'Manh√£' : med.schedule === 'night' ? 'Noite' : 'Manh√£ e Noite'}`, 14, 85);
                
                const historyRecord = med.history.find(record => 
                    record.date.startsWith(dateStr)
                );
                doc.text(`Status: ${historyRecord ? 'Administrado' : 'Pendente'}`, 14, 95);
                
                if (historyRecord) {
                    doc.text(`Hor√°rio de administra√ß√£o: ${historyRecord.timeOfDay === 'morning' ? 'Manh√£' : 'Noite'}`, 14, 105);
                }
                
                const filename = `medicacao-${animal.name}-${med.name}-${dateStr}.pdf`;
                doc.save(filename);
                showNotification(`PDF exportado: ${filename}`);
            }
            
            exportMedicationPDF(animalId, medicationId) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const animal = this.animals[animalId];
                const med = animal.medications[medicationId];
                
                doc.setFontSize(18);
                doc.text(`Esquema de Medica√ß√£o`, 14, 20);
                
                doc.setFontSize(14);
                doc.text(`Animal: ${animal.name}`, 14, 35);
                doc.text(`Medica√ß√£o: ${med.name}`, 14, 45);
                doc.text(`Dosagem: ${med.dosage}`, 14, 55);
                doc.text(`Frequ√™ncia: ${this.getFrequencyText(med.frequency)}`, 14, 65);
                doc.text(`Hor√°rio: ${med.schedule === 'morning' ? 'Manh√£' : med.schedule === 'night' ? 'Noite' : 'Manh√£ e Noite'}`, 14, 75);
                doc.text(`Data de in√≠cio: ${new Date(med.startDate).toLocaleDateString('pt-BR')}`, 14, 85);
                
                if (med.durationType === 'days' && med.duration) {
                    doc.text(`Dura√ß√£o: ${med.duration} dias`, 14, 95);
                } else if (med.durationType === 'end_date' && med.endDate) {
                    doc.text(`Data de t√©rmino: ${new Date(med.endDate).toLocaleDateString('pt-BR')}`, 14, 95);
                } else {
                    doc.text(`Dura√ß√£o: Cont√≠nuo`, 14, 95);
                }
                
                // Hist√≥rico recente
                doc.setFontSize(12);
                doc.text(`Hist√≥rico Recente:`, 14, 110);
                
                let y = 120;
                med.history.slice(-10).reverse().forEach(record => {
                    const date = new Date(record.timestamp);
                    doc.setFontSize(10);
                    doc.text(`${date.toLocaleDateString('pt-BR')} ${date.toLocaleTimeString('pt-BR')} - ${record.timeOfDay === 'morning' ? 'Manh√£' : 'Noite'}`, 20, y);
                    y += 5;
                });
                
                const filename = `esquema-${animal.name}-${med.name}.pdf`;
                doc.save(filename);
                showNotification(`PDF exportado: ${filename}`);
            }
            
            exportAnimalPDF(animalId) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const animal = this.animals[animalId];
                
                doc.setFontSize(18);
                doc.text(`Registro Completo - ${animal.name}`, 14, 20);
                
                doc.setFontSize(14);
                doc.text(`Peso: ${animal.weight}`, 14, 35);
                
                let y = 50;
                Object.values(animal.medications).forEach(med => {
                    doc.setFontSize(12);
                    doc.text(`üíä ${med.name}`, 14, y);
                    y += 7;
                    
                    doc.setFontSize(10);
                    doc.text(`   Dosagem: ${med.dosage}`, 14, y);
                    y += 5;
                    doc.text(`   Frequ√™ncia: ${this.getFrequencyText(med.frequency)}`, 14, y);
                    y += 5;
                    doc.text(`   Hor√°rio: ${med.schedule === 'morning' ? 'Manh√£' : med.schedule === 'night' ? 'Noite' : 'Manh√£ e Noite'}`, 14, y);
                    y += 5;
                    doc.text(`   In√≠cio: ${new Date(med.startDate).toLocaleDateString('pt-BR')}`, 14, y);
                    y += 5;
                    
                    const historyCount = med.history.length;
                    doc.text(`   Administra√ß√µes registradas: ${historyCount}`, 14, y);
                    y += 10;
                });
                
                const filename = `registro-${animal.name}.pdf`;
                doc.save(filename);
                showNotification(`PDF exportado: ${filename}`);
            }
            
            exportMonthToPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                                  'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                const title = `Calend√°rio de Medica√ß√µes - ${monthNames[this.calendarMonth]} ${this.calendarYear}`;
                
                doc.setFontSize(16);
                doc.text(title, 14, 20);
                
                // Gera uma tabela com todas as medica√ß√µes do m√™s
                const tableData = [];
                const firstDay = new Date(this.calendarYear, this.calendarMonth, 1);
                const lastDay = new Date(this.calendarYear, this.calendarMonth + 1, 0);
                const daysInMonth = lastDay.getDate();
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${this.calendarYear}-${String(this.calendarMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const date = new Date(dateStr);
                    
                    Object.values(this.animals).forEach(animal => {
                        Object.values(animal.medications).forEach(med => {
                            const isScheduled = med.scheduledDates.some(scheduledDate => {
                                if (scheduledDate.includes('_')) {
                                    return scheduledDate.startsWith(dateStr);
                                }
                                return scheduledDate === dateStr;
                            });
                            
                            if (isScheduled) {
                                const historyRecord = med.history.find(record => 
                                    record.date.startsWith(dateStr)
                                );
                                
                                tableData.push([
                                    date.toLocaleDateString('pt-BR', { weekday: 'short', day: 'numeric' }),
                                    animal.name,
                                    med.name,
                                    med.dosage,
                                    med.schedule === 'morning' ? 'Manh√£' : med.schedule === 'night' ? 'Noite' : 'Ambos',
                                    historyRecord ? '‚úì' : '‚è∞'
                                ]);
                            }
                        });
                    });
                }
                
                doc.autoTable({
                    startY: 30,
                    head: [['Data', 'Animal', 'Medica√ß√£o', 'Dosagem', 'Hor√°rio', 'Status']],
                    body: tableData,
                    theme: 'grid',
                    styles: { fontSize: 8 },
                    headStyles: { fillColor: [74, 144, 226] }
                });
                
                const filename = `calendario-${monthNames[this.calendarMonth]}-${this.calendarYear}.pdf`;
                doc.save(filename);
                showNotification(`PDF exportado: ${filename}`);
            }
            
            exportMonthRangeToPDF() {
                this.openExportModal();
            }
            
            exportSelectedRangeToPDF() {
                const startDate = document.getElementById('export-start-date').value;
                const endDate = document.getElementById('export-end-date').value;
                const animalId = document.getElementById('export-animal-select').value;
                
                if (!startDate || !endDate) {
                    showNotification('Por favor, selecione as datas!', 'warning');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const start = new Date(startDate);
                const end = new Date(endDate);
                const title = `Relat√≥rio de Medica√ß√µes - ${start.toLocaleDateString('pt-BR')} a ${end.toLocaleDateString('pt-BR')}`;
                
                doc.setFontSize(16);
                doc.text(title, 14, 20);
                
                const tableData = [];
                const currentDate = new Date(start);
                
                while (currentDate <= end) {
                    const dateStr = this.formatDate(currentDate);
                    
                    const animalsToProcess = animalId === 'all' 
                        ? Object.values(this.animals) 
                        : [this.animals[animalId]].filter(Boolean);
                    
                    animalsToProcess.forEach(animal => {
                        Object.values(animal.medications).forEach(med => {
                            const isScheduled = med.scheduledDates.some(scheduledDate => {
                                if (scheduledDate.includes('_')) {
                                    return scheduledDate.startsWith(dateStr);
                                }
                                return scheduledDate === dateStr;
                            });
                            
                            if (isScheduled) {
                                const historyRecord = med.history.find(record => 
                                    record.date.startsWith(dateStr)
                                );
                                
                                tableData.push([
                                    currentDate.toLocaleDateString('pt-BR'),
                                    animal.name,
                                    med.name,
                                    med.dosage,
                                    med.schedule === 'morning' ? 'Manh√£' : med.schedule === 'night' ? 'Noite' : 'Ambos',
                                    historyRecord ? 'Administrado' : 'Pendente'
                                ]);
                            }
                        });
                    });
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                if (tableData.length === 0) {
                    doc.setFontSize(12);
                    doc.text('Nenhuma medica√ß√£o encontrada no per√≠odo selecionado.', 14, 40);
                } else {
                    doc.autoTable({
                        startY: 30,
                        head: [['Data', 'Animal', 'Medica√ß√£o', 'Dosagem', 'Hor√°rio', 'Status']],
                        body: tableData,
                        theme: 'grid',
                        styles: { fontSize: 8 },
                        headStyles: { fillColor: [74, 144, 226] }
                    });
                }
                
                const filename = `relatorio-${startDate}-a-${endDate}.pdf`;
                doc.save(filename);
                showNotification(`PDF exportado: ${filename}`);
                this.closeExportModal();
            }
            
            exportAllToPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(18);
                doc.text('Relat√≥rio Completo de Medica√ß√µes', 14, 20);
                
                let y = 35;
                Object.values(this.animals).forEach(animal => {
                    doc.setFontSize(14);
                    doc.text(`${animal.icon} ${animal.name} - ${animal.weight}`, 14, y);
                    y += 10;
                    
                    Object.values(animal.medications).forEach(med => {
                        doc.setFontSize(12);
                        doc.text(`‚Ä¢ ${med.name}: ${med.dosage}`, 20, y);
                        y += 7;
                        
                        doc.setFontSize(10);
                        doc.text(`  Frequ√™ncia: ${this.getFrequencyText(med.frequency)}`, 25, y);
                        y += 5;
                        doc.text(`  Hor√°rio: ${med.schedule === 'morning' ? 'Manh√£' : med.schedule === 'night' ? 'Noite' : 'Manh√£ e Noite'}`, 25, y);
                        y += 5;
                        doc.text(`  In√≠cio: ${new Date(med.startDate).toLocaleDateString('pt-BR')}`, 25, y);
                        y += 5;
                        
                        if (med.durationType === 'days' && med.duration) {
                            doc.text(`  Dura√ß√£o: ${med.duration} dias`, 25, y);
                            y += 5;
                        } else if (med.durationType === 'end_date' && med.endDate) {
                            doc.text(`  T√©rmino: ${new Date(med.endDate).toLocaleDateString('pt-BR')}`, 25, y);
                            y += 5;
                        } else if (med.durationType === 'continuous') {
                            doc.text(`  Dura√ß√£o: Cont√≠nuo`, 25, y);
                            y += 5;
                        }
                        
                        const historyCount = med.history.length;
                        doc.text(`  Registros: ${historyCount} administra√ß√µes`, 25, y);
                        y += 10;
                        
                        if (y > 280) {
                            doc.addPage();
                            y = 20;
                        }
                    });
                    
                    y += 10;
                });
                
                doc.save('relatorio-completo-medicacoes.pdf');
                showNotification('PDF completo exportado!');
            }
            
            exportData() {
                const data = {
                    animals: this.animals,
                    exportedAt: new Date().toISOString(),
                    version: '2.0'
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `backup-medicacao-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showNotification('Dados exportados com sucesso!');
            }
            
            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = e => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = event => {
                        try {
                            const data = JSON.parse(event.target.result);
                            
                            if (data.animals) {
                                this.animals = data.animals;
                                this.saveToCache();
                                this.populateAnimalSelect();
                                this.populateExportAnimalSelect();
                                this.renderAll();
                                this.updateUpcomingMedications();
                                showNotification('Dados importados com sucesso!');
                            }
                        } catch (error) {
                            showNotification('Erro ao importar dados! Arquivo inv√°lido.', 'danger');
                        }
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            }
            
            resetAllData() {
                if (confirm('ATEN√á√ÉO: Isso ir√° resetar TODOS os dados para os valores padr√£o. Tem certeza?')) {
                    localStorage.clear();
                    location.reload();
                }
            }
            
            editAnimal(animalId) {
                const animal = this.animals[animalId];
                if (!animal) return;
                
                const newName = prompt('Novo nome do animal:', animal.name);
                if (newName && newName.trim()) {
                    animal.name = newName.trim();
                    this.saveToCache();
                    this.renderAll();
                    showNotification('Animal atualizado com sucesso!');
                }
            }
        }

        // Fun√ß√µes globais
        const vetSystem = new VeterinarySystem();

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            if (type === 'warning') {
                notification.style.background = 'var(--warning)';
            } else if (type === 'danger') {
                notification.style.background = 'var(--danger)';
            } else if (type === 'info') {
                notification.style.background = 'var(--info)';
            } else {
                notification.style.background = 'var(--success)';
            }
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function clearAppCache() {
            vetSystem.cacheManager.clearAppCache();
            setTimeout(() => location.reload(), 1000);
        }

        function closeDayModal() {
            vetSystem.closeDayModal();
        }

        function closeExportModal() {
            vetSystem.closeExportModal();
        }

        function changeMonth(delta) {
            vetSystem.changeMonth(delta);
        }

        function exportMonthToPDF() {
            vetSystem.exportMonthToPDF();
        }

        function exportMonthRangeToPDF() {
            vetSystem.exportMonthRangeToPDF();
        }

        function exportDayToPDF(dateStr) {
            vetSystem.exportDayToPDF(dateStr);
        }

        function exportAllToPDF() {
            vetSystem.exportAllToPDF();
        }

        function addNewAnimal() {
            vetSystem.addNewAnimal();
        }

        function addNewMedication() {
            vetSystem.addNewMedication();
        }

        function exportData() {
            vetSystem.exportData();
        }

        function importData() {
            vetSystem.importData();
        }

        function resetAllData() {
            vetSystem.resetAllData();
        }

        // Inicializa o sistema quando a p√°gina carrega
        document.addEventListener('DOMContentLoaded', function() {
            vetSystem.init();
        });
    </script>
</body>
</html>
